
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Building the models &#8212; protopipe 0.5.1.dev21+g51ed745 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../_static/landing_page.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Production of DL2 data" href="DL2.html" />
    <link rel="prev" title="Data training" href="data_training.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="../index.html">
<p class="title">protopipe</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../install/index.html">
  Getting started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../usage/index.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="index.html">
  API Reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../contribute/index.html">
  Development
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../AUTHORS.html">
  Authors
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../CHANGELOG.html">
  Changelog
 </a>
</li>

    
    <li class="nav-item">
        <a class="nav-link nav-external" href="http://cccta-dataserver.in2p3.fr/data/protopipe/results/html/">Performance<i class="fas fa-external-link-alt"></i></a>
    </li>
    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-primary btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        latest  <!-- this text may get changed later by javascript -->
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
</div>

<!-- NOTE: this JS must live here (not in our global JS file) because it relies
     on being processed by Jinja before it is run (specifically for replacing
     variables reference/model_building and {'json_url': '/_static/switcher.json', 'version_match': 'latest'}.
-->

<script type="text/javascript">
// Check if corresponding page path exists in other version of docs
// and, if so, go there instead of the homepage of the other docs version
function checkPageExistsAndRedirect(event) {
    const currentFilePath = "reference/model_building.html",
          tryUrl = event.target.getAttribute("href");
    let otherDocsHomepage = tryUrl.replace(currentFilePath, "");
    $.ajax({
        type: 'HEAD',
        url: tryUrl,
        // if the page exists, go there
        success: function() {
            location.href = tryUrl;
        }
    }).fail(function() {
        location.href = otherDocsHomepage;
    });
    // this prevents the browser from following the href of the clicked node
    // (which is fine because this function takes care of redirecting)
    return false;
}

// Populate the version switcher from the JSON config file
(function () {
    $.getJSON("/_static/switcher.json", function(data, textStatus, jqXHR) {
        const currentFilePath = "reference/model_building.html";
        // create links to the corresponding page in the other docs versions
        $.each(data, function(index, entry) {
            // if no custom name specified (e.g., "latest"), use version string
            if (!("name" in entry)) {
                entry.name = entry.version;
            }
            // create the node
            const node = document.createElement("a");
            node.setAttribute("class", "list-group-item list-group-item-action py-1");
            node.textContent = `${entry.name}`;
            node.setAttribute("href", `${entry.url}${currentFilePath}`);
            // on click, AJAX calls will check if the linked page exists before
            // trying to redirect, and if not, will redirect to the homepage
            // for that version of the docs.
            node.onclick = checkPageExistsAndRedirect;
            // Add dataset values for the version and name in case people want
            // to apply CSS styling based on this information.
            node.dataset["versionName"] = entry.name;
            node.dataset["version"] = entry.version;

            $("#version_switcher_menu").append(node);
            // replace dropdown button text with the preferred display name of
            // this version, rather than using sphinx's 0.5.1.dev21+g51ed745 variable.
            // also highlight the dropdown entry for the currently-viewed
            // version's entry
            if (entry.version == "latest") {
                node.classList.add("active");
                let btn = document.getElementById("version_switcher_button");
                btn.innerText = btn.dataset["activeVersionName"] = entry.name;
                btn.dataset["activeVersion"] = entry.version;
            }
        });
    });
})();
</script>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Quick Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/cta-observatory/protopipe" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://pypi.org/project/protopipe/" rel="noopener" target="_blank" title="PyPI"><span><i class="fab fa-python"></i></span>
            <label class="sr-only">PyPI</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs..." aria-label="Search the docs..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="scripts.html">
   Scripts (
   <code class="docutils literal notranslate">
    <span class="pre">
     protopipe.scripts
    </span>
   </code>
   )
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="data_training.html">
     Data training
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Building the models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="DL2.html">
     Production of DL2 data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="optimization_cuts_IRFs.html">
     Optimized cuts and IRFs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="benchmark_script.html">
     Benchmarking
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="pipeline.html">
   Event reconstruction (
   <code class="docutils literal notranslate">
    <span class="pre">
     protopipe.pipeline
    </span>
   </code>
   )
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.pipeline.camera_radius.html">
     camera_radius
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.pipeline.effective_focal_lengths.html">
     effective_focal_lengths
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.pipeline.final_array_to_use.html">
     final_array_to_use
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.pipeline.get_camera_names.html">
     get_camera_names
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.pipeline.get_cameras_radii.html">
     get_cameras_radii
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.pipeline.load_config.html">
     load_config
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.pipeline.load_models.html">
     load_models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.pipeline.load_obj.html">
     load_obj
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.pipeline.make_argparser.html">
     make_argparser
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.pipeline.prod3b_array.html">
     prod3b_array
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.pipeline.prod5N_array.html">
     prod5N_array
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.pipeline.read_TRAINING_per_tel_type_with_images.html">
     read_TRAINING_per_tel_type_with_images
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.pipeline.read_protopipe_TRAINING_per_tel_type.html">
     read_protopipe_TRAINING_per_tel_type
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.pipeline.save_fig.html">
     save_fig
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.pipeline.save_obj.html">
     save_obj
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.pipeline.str2bool.html">
     str2bool
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.pipeline.EventPreparer.html">
     EventPreparer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.pipeline.ImageCleaner.html">
     ImageCleaner
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.pipeline.SignalHandler.html">
     SignalHandler
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.pipeline.bcolors.html">
     bcolors
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.pipeline.List.html">
     List
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.pipeline.Union.html">
     Union
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="mva.html">
   Multivariate analysis (
   <code class="docutils literal notranslate">
    <span class="pre">
     protopipe.mva
    </span>
   </code>
   )
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.mva.get_evt_model_output.html">
     get_evt_model_output
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.mva.get_evt_subarray_model_output.html">
     get_evt_subarray_model_output
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.mva.initialize_script_arguments.html">
     initialize_script_arguments
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.mva.make_cut_list.html">
     make_cut_list
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.mva.plot_distributions.html">
     plot_distributions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.mva.plot_hist.html">
     plot_hist
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.mva.plot_profile.html">
     plot_profile
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.mva.plot_roc_curve.html">
     plot_roc_curve
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.mva.prepare_data.html">
     prepare_data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.mva.save_output.html">
     save_output
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.mva.split_train_test.html">
     split_train_test
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.mva.TrainModel.html">
     TrainModel
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="perf.html">
   Performance generation (
   <code class="docutils literal notranslate">
    <span class="pre">
     protopipe.perf
    </span>
   </code>
   )
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.perf.angular_resolution.html">
     angular_resolution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.perf.energy_bias_resolution.html">
     energy_bias_resolution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.perf.initialize_script_arguments.html">
     initialize_script_arguments
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.perf.load_obj.html">
     load_obj
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.perf.percentiles.html">
     percentiles
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.perf.plot_hist.html">
     plot_hist
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.perf.read_DL2_pyirf.html">
     read_DL2_pyirf
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.perf.save_obj.html">
     save_obj
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.perf.norm.html">
     norm
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="benchmarks.html">
   Benchmarks (
   <code class="docutils literal notranslate">
    <span class="pre">
     protopipe.benchmarks
    </span>
   </code>
   )
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.add_BTEL1010_weigths_to_data.html">
     add_BTEL1010_weigths_to_data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.add_stats.html">
     add_stats
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.average_bias_of_charge_resolution.html">
     average_bias_of_charge_resolution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.calculate_RMS_around_1.html">
     calculate_RMS_around_1
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.compute_bias.html">
     compute_bias
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.compute_psf.html">
     compute_psf
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.compute_resolution.html">
     compute_resolution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.compute_weight_BTEL1010.html">
     compute_weight_BTEL1010
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.create_lookup_function.html">
     create_lookup_function
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.get_evt_subarray_model_output.html">
     get_evt_subarray_model_output
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.get_fig_size.html">
     get_fig_size
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.get_single_pixels_spectrum.html">
     get_single_pixels_spectrum
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.load_tel_id.html">
     load_tel_id
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.plot_DL1a_reco_true_correlation.html">
     plot_DL1a_reco_true_correlation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.plot_background_rate.html">
     plot_background_rate
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.plot_bias.html">
     plot_bias
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.plot_binned_mean.html">
     plot_binned_mean
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.plot_binned_median.html">
     plot_binned_median
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.plot_distributions.html">
     plot_distributions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.plot_evt_roc_curve_variation.html">
     plot_evt_roc_curve_variation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.plot_hist.html">
     plot_hist
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.plot_profile.html">
     plot_profile
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.plot_psf.html">
     plot_psf
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.plot_resolution.html">
     plot_resolution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.plot_roc_curve.html">
     plot_roc_curve
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.plot_sensitivity_from_pyirf.html">
     plot_sensitivity_from_pyirf
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.prepare_requirements.html">
     prepare_requirements
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.raise_.html">
     raise
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.string_to_boolean.html">
     string_to_boolean
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.sum_of_squares.html">
     sum_of_squares
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.BoostedDecisionTreeDiagnostic.html">
     BoostedDecisionTreeDiagnostic
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.ClassifierDiagnostic.html">
     ClassifierDiagnostic
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.ModelDiagnostic.html">
     ModelDiagnostic
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.OnlineBinnedStats.html">
     OnlineBinnedStats
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api/protopipe.benchmarks.RegressorDiagnostic.html">
     RegressorDiagnostic
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dirac.html">
   Interface to the DIRAC grid
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#energy-regressor">
   Energy regressor
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#g-h-classifier">
   g/h classifier
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                

<div class="tocsection editthispage">
    <a href="https://github.com/https://github.com/cta-observatory/https://github.com/cta-observatory/protopipe/edit/master/docs/reference/model_building.rst">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="building-the-models">
<span id="model-building"></span><h1>Building the models<a class="headerlink" href="#building-the-models" title="Permalink to this headline">#</a></h1>
<p>With <em>protopipe</em> it is possible to build estimation models for both particle
energy and gamma/hadron classification.
The base classes are defined in the <code class="docutils literal notranslate"><span class="pre">protopipe.mva</span></code> module (see <a class="reference internal" href="mva.html#mva"><span class="std std-ref">Multivariate analysis (protopipe.mva)</span></a>).</p>
<p>For both cases, building a regressor or a classifier, the script
<code class="docutils literal notranslate"><span class="pre">protopipe.scripts.build_model.py</span></code> is used.</p>
<p>The following is the help output which shows required arguments and options.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">protopipe</span><span class="o">-</span><span class="n">MODEL</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="o">--</span><span class="n">config_file</span> <span class="n">CONFIG_FILE</span> <span class="p">[</span><span class="o">--</span><span class="n">max_events</span> <span class="n">MAX_EVENTS</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">wave</span> <span class="o">|</span> <span class="o">--</span><span class="n">tail</span><span class="p">]</span>
                      <span class="p">(</span><span class="o">--</span><span class="n">cameras_from_config</span> <span class="o">|</span> <span class="o">--</span><span class="n">cameras_from_file</span> <span class="o">|</span> <span class="o">--</span><span class="n">cam_id_list</span> <span class="n">CAM_ID_LIST</span><span class="p">)</span> <span class="p">[</span><span class="o">--</span><span class="n">indir_signal</span> <span class="n">INDIR_SIGNAL</span><span class="p">]</span>
                      <span class="p">[</span><span class="o">--</span><span class="n">indir_background</span> <span class="n">INDIR_BACKGROUND</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">infile_signal</span> <span class="n">INFILE_SIGNAL</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">infile_background</span> <span class="n">INFILE_BACKGROUND</span><span class="p">]</span>
                      <span class="p">[</span><span class="o">-</span><span class="n">o</span> <span class="n">OUTDIR</span><span class="p">]</span>

<span class="n">Build</span> <span class="n">model</span> <span class="k">for</span> <span class="n">regression</span><span class="o">/</span><span class="n">classification</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">--</span><span class="n">config_file</span> <span class="n">CONFIG_FILE</span>
  <span class="o">--</span><span class="n">max_events</span> <span class="n">MAX_EVENTS</span>
                        <span class="n">maximum</span> <span class="n">number</span> <span class="n">of</span> <span class="n">events</span> <span class="n">to</span> <span class="n">use</span>
  <span class="o">--</span><span class="n">wave</span>                <span class="k">if</span> <span class="nb">set</span><span class="p">,</span> <span class="n">use</span> <span class="n">wavelet</span> <span class="n">cleaning</span>
  <span class="o">--</span><span class="n">tail</span>                <span class="k">if</span> <span class="nb">set</span><span class="p">,</span> <span class="n">use</span> <span class="n">tail</span> <span class="n">cleaning</span> <span class="p">(</span><span class="n">default</span><span class="p">),</span> <span class="n">otherwise</span> <span class="n">wavelets</span>
  <span class="o">--</span><span class="n">cameras_from_config</span>
                        <span class="n">Get</span> <span class="n">cameras</span> <span class="n">configuration</span> <span class="n">file</span> <span class="p">(</span><span class="n">Priority</span> <span class="mi">1</span><span class="p">)</span>
  <span class="o">--</span><span class="n">cameras_from_file</span>   <span class="n">Get</span> <span class="n">cameras</span> <span class="kn">from</span> <span class="nn">input</span> <span class="n">file</span> <span class="p">(</span><span class="n">Priority</span> <span class="mi">2</span><span class="p">)</span>
  <span class="o">--</span><span class="n">cam_id_list</span> <span class="n">CAM_ID_LIST</span>
                        <span class="n">Select</span> <span class="n">cameras</span> <span class="n">like</span> <span class="s1">&#39;LSTCam CHEC&#39;</span> <span class="p">(</span><span class="n">Priority</span> <span class="mi">3</span><span class="p">)</span>
  <span class="o">--</span><span class="n">indir_signal</span> <span class="n">INDIR_SIGNAL</span>
                        <span class="n">Directory</span> <span class="n">containing</span> <span class="n">the</span> <span class="n">required</span> <span class="n">SIGNAL</span> <span class="nb">input</span> <span class="n">file</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="n">read</span> <span class="kn">from</span> <span class="nn">config</span> <span class="n">file</span><span class="p">)</span>
  <span class="o">--</span><span class="n">indir_background</span> <span class="n">INDIR_BACKGROUND</span>
                        <span class="n">Directory</span> <span class="n">containing</span> <span class="n">the</span> <span class="n">required</span> <span class="n">BACKGROUND</span> <span class="nb">input</span> <span class="n">file</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="n">read</span> <span class="kn">from</span> <span class="nn">config</span> <span class="n">file</span><span class="p">)</span>
  <span class="o">--</span><span class="n">infile_signal</span> <span class="n">INFILE_SIGNAL</span>
                        <span class="n">SIGNAL</span> <span class="n">file</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="n">read</span> <span class="kn">from</span> <span class="nn">config</span> <span class="n">file</span><span class="p">)</span>
  <span class="o">--</span><span class="n">infile_background</span> <span class="n">INFILE_BACKGROUND</span>
                        <span class="n">BACKGROUND</span> <span class="n">file</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="n">read</span> <span class="kn">from</span> <span class="nn">config</span> <span class="n">file</span><span class="p">)</span>
  <span class="o">-</span><span class="n">o</span> <span class="n">OUTDIR</span><span class="p">,</span> <span class="o">--</span><span class="n">outdir</span> <span class="n">OUTDIR</span>
</pre></div>
</div>
<p>The script takes along its arguments a configuration file which depends on what
type of model needs to be built.</p>
<p>The available choices can be found under <code class="docutils literal notranslate"><span class="pre">protopipe.aux.example_config_files</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">AdaBoostRegressor.yaml</span></code> is used to train an energy regressor,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RandomForestRegressor.yaml</span></code>  is used to train an energy regressor,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RandomForestClassifier.yaml</span></code> is used to train a gamma/hadron classifier.</p></li>
</ul>
<section id="energy-regressor">
<h2>Energy regressor<a class="headerlink" href="#energy-regressor" title="Permalink to this headline">#</a></h2>
<p>To build this you will need at least one table with at least the true energy (the target)
and some event characteristics (the features) to reconstruct the energy.
This table is created in the <a class="reference internal" href="data_training.html#data-training"><span class="std std-ref">Data training</span></a> step.</p>
<p>The following is a commented example of the required configuration file
<code class="docutils literal notranslate"><span class="pre">AdaBoostRegressor.yaml</span></code> with similar options as for <code class="docutils literal notranslate"><span class="pre">RandomForestRegressor.yaml</span></code>,</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">General</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="c1"># [...] = analysis full path (on the host if you are using a container)</span><span class="w"></span>
<span class="w">  </span><span class="nt">data_dir_signal</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ANALYSES_DIRECTORY/ANALYSIS_NAME/data/TRAINING/for_energy_estimation/gamma&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">data_sig_file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TRAINING_energy_tail_gamma_merged.h5&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">outdir</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ANALYSES_DIRECTORY/ANALYSIS_NAME/estimators/energy_regressor&quot;</span><span class="w"></span>
<span class="w">  </span><span class="c1"># List of cameras to use (protopipe-MODEL help output for other options)</span><span class="w"></span>
<span class="w">  </span><span class="nt">cam_id_list</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span><span class="w"></span>

<span class="c1"># If train_fraction is 1, all the TRAINING dataset will be used to train the</span><span class="w"></span>
<span class="c1"># model and benchmarking can only be done from the benchmarking notebook</span><span class="w"></span>
<span class="c1"># TRAINING/benchmarks_DL2_to_classification.ipynb</span><span class="w"></span>
<span class="nt">Split</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">train_fraction</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.8</span><span class="w"></span>
<span class="w">  </span><span class="nt">use_same_number_of_sig_and_bkg_for_training</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span><span class="w"> </span><span class="c1"># Lowest statistics will drive the split</span><span class="w"></span>

<span class="c1"># Optimize the hyper-parameters of the estimator with a grid search</span><span class="w"></span>
<span class="c1"># If True parameters should be provided as lists</span><span class="w"></span>
<span class="c1"># If False the model used will be the one based on the chosen single-valued hyper-parameters</span><span class="w"></span>
<span class="nt">GridSearchCV</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">use</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span><span class="w"> </span><span class="c1"># True or False</span><span class="w"></span>
<span class="w">  </span><span class="c1"># if False the following two variables are irrelevant</span><span class="w"></span>
<span class="w">  </span><span class="nt">scoring</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;explained_variance&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">cv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"> </span><span class="c1"># cross-validation splitting strategy</span><span class="w"></span>
<span class="w">  </span><span class="nt">refit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class="w"> </span><span class="c1"># Refit the estimator using the best found parameters</span><span class="w"></span>
<span class="w">  </span><span class="nt">verbose</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"> </span><span class="c1"># 1,2,3,4</span><span class="w"></span>
<span class="w">  </span><span class="nt">njobs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-1</span><span class="w"> </span><span class="c1"># int or -1 (all processors)</span><span class="w"></span>

<span class="nt">Method</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;sklearn.ensemble.AdaBoostRegressor&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">target_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true_energy&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">log_10_target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class="w"> </span><span class="c1"># this makes the model use log10(target_name)</span><span class="w"></span>
<span class="w">  </span><span class="c1"># Please, see scikit-learn&#39;s API for what each parameter means</span><span class="w"></span>
<span class="w">  </span><span class="c1"># NOTE: null == None</span><span class="w"></span>
<span class="w">  </span><span class="nt">base_estimator</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;sklearn.tree.DecisionTreeRegressor&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="c1"># NOTE: here we set the parameters relevant for sklearn.tree.DecisionTreeRegressor</span><span class="w"></span>
<span class="w">      </span><span class="nt">criterion</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mse&quot;</span><span class="w"> </span><span class="c1"># &quot;mse&quot;, &quot;friedman_mse&quot;, &quot;mae&quot; or &quot;poisson&quot;</span><span class="w"></span>
<span class="w">      </span><span class="nt">splitter</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;best&quot;</span><span class="w"> </span><span class="c1"># &quot;best&quot; or &quot;random&quot;</span><span class="w"></span>
<span class="w">      </span><span class="nt">max_depth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"> </span><span class="c1"># null or integer</span><span class="w"></span>
<span class="w">      </span><span class="nt">min_samples_split</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"> </span><span class="c1"># integer or float</span><span class="w"></span>
<span class="w">      </span><span class="nt">min_samples_leaf</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"> </span><span class="c1"># int or float</span><span class="w"></span>
<span class="w">      </span><span class="nt">min_weight_fraction_leaf</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span><span class="w"> </span><span class="c1"># float</span><span class="w"></span>
<span class="w">      </span><span class="nt">max_features</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"> </span><span class="c1"># null, &quot;auto&quot;, &quot;sqrt&quot;, &quot;log2&quot;, int or float</span><span class="w"></span>
<span class="w">      </span><span class="nt">max_leaf_nodes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"> </span><span class="c1"># null or integer</span><span class="w"></span>
<span class="w">      </span><span class="nt">min_impurity_decrease</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span><span class="w"> </span><span class="c1"># float</span><span class="w"></span>
<span class="w">      </span><span class="nt">random_state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w"> </span><span class="c1"># null or integer or RandomState</span><span class="w"></span>
<span class="w">      </span><span class="nt">ccp_alpha</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span><span class="w"> </span><span class="c1"># non-negative float</span><span class="w"></span>
<span class="w">  </span><span class="nt">tuned_parameters</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">n_estimators</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50</span><span class="w"></span>
<span class="w">    </span><span class="nt">learning_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">    </span><span class="nt">loss</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;linear&quot;</span><span class="w"> </span><span class="c1"># &#39;linear&#39;, &#39;square&#39; or &#39;exponential&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nt">random_state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w"> </span><span class="c1"># int, RandomState instance or None</span><span class="w"></span>

<span class="c1"># List of the features to use to train the model</span><span class="w"></span>
<span class="c1"># You can:</span><span class="w"></span>
<span class="c1"># - comment/uncomment the ones you see here,</span><span class="w"></span>
<span class="c1"># - add new ones here if they can be evaluated with pandas.DataFrame.eval</span><span class="w"></span>
<span class="c1"># - if not you can propose modifications to protopipe.mva.utils.prepare_data</span><span class="w"></span>
<span class="nt">FeatureList</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">Basic</span><span class="p">:</span><span class="w"> </span><span class="c1"># single-named, they need to correspond to input data columns</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;h_max&quot;</span><span class="w"> </span><span class="c1"># Height of shower maximum from stereoscopic reconstruction</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;impact_dist&quot;</span><span class="w"> </span><span class="c1"># Impact parameter from stereoscopic reconstruction</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;hillas_width&quot;</span><span class="w"> </span><span class="c1"># Image Width</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;hillas_length&quot;</span><span class="w"> </span><span class="c1"># Image Length</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;concentration_pixel&quot;</span><span class="w"> </span><span class="c1"># Percentage of photo-electrons in the brightest pixel</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;leakage_intensity_width_1&quot;</span><span class="w"> </span><span class="c1"># fraction of total Intensity which is contained in the outermost pixels of the camera</span><span class="w"></span>
<span class="w">  </span><span class="nt">Derived</span><span class="p">:</span><span class="w"> </span><span class="c1"># custom evaluations of basic features that will be added to the data</span><span class="w"></span>
<span class="w">    </span><span class="c1"># column name : expression to evaluate using basic column names</span><span class="w"></span>
<span class="w">    </span><span class="nt">log10_WLS</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">log10(hillas_width*hillas_length/hillas_intensity)</span><span class="w"></span>
<span class="w">    </span><span class="nt">log10_intensity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">log10(hillas_intensity)</span><span class="w"></span>
<span class="w">    </span><span class="nt">r_origin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">(sqrt((hillas_x - az)**2 + (hillas_y - alt)**2))**2</span><span class="w"></span>
<span class="w">    </span><span class="nt">phi_origin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">arctan2(hillas_y - alt, hillas_x - az)</span><span class="w"></span>

<span class="c1"># These cuts select the input data BEFORE training</span><span class="w"></span>
<span class="nt">SigFiducialCuts</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;good_image</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">1&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;is_valid</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">True&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;hillas_intensity</span><span class="nv"> </span><span class="s">&gt;</span><span class="nv"> </span><span class="s">0&quot;</span><span class="w"></span>

<span class="nt">Diagnostic</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="c1"># Energy binning (used for reco and true energy)</span><span class="w"></span>
<span class="w">  </span><span class="nt">energy</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">nbins</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span><span class="w"></span>
<span class="w">    </span><span class="nt">min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0125</span><span class="w"></span>
<span class="w">    </span><span class="nt">max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">125</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="g-h-classifier">
<h2>g/h classifier<a class="headerlink" href="#g-h-classifier" title="Permalink to this headline">#</a></h2>
<p>To build a gamma/hadron classifier you need gamma-ray and proton tables with some
features used to discriminate between gamma and hadrons (electrons are handled later
as a contamination).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An alternative approach - yet to study - could be to train a classifier with gamma
against a background sample composed of weighted hadrons and weighted electrons.</p>
</div>
<p>The following the example provided by the example configuration file <code class="docutils literal notranslate"><span class="pre">RandomForestClassifier.yaml</span></code>,</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">General</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="c1"># [...] = your analysis full path (on the host if you are using a container)</span><span class="w"></span>
<span class="w">  </span><span class="nt">data_dir_signal</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ANALYSES_DIRECTORY/ANALYSIS_NAME/data/TRAINING/for_particle_classification/gamma&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">data_dir_background</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ANALYSES_DIRECTORY/ANALYSIS_NAME/data/TRAINING/for_particle_classification/proton&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">data_sig_file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TRAINING_classification_tail_gamma_merged.h5&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">data_bkg_file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TRAINING_classification_tail_proton_merged.h5&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">outdir</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ANALYSES_DIRECTORY/ANALYSIS_NAME/estimators/gamma_hadron_classifier&quot;</span><span class="w"></span>
<span class="w">  </span><span class="c1"># List of cameras to use (protopipe-MODEL help output for other options)</span><span class="w"></span>
<span class="w">  </span><span class="nt">cam_id_list</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span><span class="w"></span>

<span class="c1"># If train_fraction is 1.0, all the TRAINING dataset will be used to train the</span><span class="w"></span>
<span class="c1"># model and benchmarking can only be done from the benchmarking notebook</span><span class="w"></span>
<span class="c1"># TRAINING/benchmarks_DL2_to_classification.ipynb</span><span class="w"></span>
<span class="nt">Split</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">train_fraction</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.8</span><span class="w"></span>
<span class="w">  </span><span class="nt">use_same_number_of_sig_and_bkg_for_training</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span><span class="w"> </span><span class="c1"># Lowest statistics will drive the split</span><span class="w"></span>

<span class="c1"># Optimize the hyper-parameters of the estimator with a grid search</span><span class="w"></span>
<span class="c1"># If True parameters should be provided as lists (for None use [null])</span><span class="w"></span>
<span class="c1"># If False the model used will be the one based on the chosen single-valued hyper-parameters</span><span class="w"></span>
<span class="nt">GridSearchCV</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">use</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span><span class="w"> </span><span class="c1"># True or False</span><span class="w"></span>
<span class="w">  </span><span class="c1"># if False the following to variables are irrelevant</span><span class="w"></span>
<span class="w">  </span><span class="nt">scoring</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;roc_auc&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">cv</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"> </span><span class="c1"># cross-validation splitting strategy</span><span class="w"></span>
<span class="w">  </span><span class="nt">refit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class="w"> </span><span class="c1"># Refit the estimator using the best found parameters</span><span class="w"></span>
<span class="w">  </span><span class="nt">verbose</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"> </span><span class="c1"># 1,2,3,4</span><span class="w"></span>
<span class="w">  </span><span class="nt">njobs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-1</span><span class="w"> </span><span class="c1"># int or -1 (all processors)</span><span class="w"></span>

<span class="c1"># Definition of the algorithm/method used and its hyper-parameters</span><span class="w"></span>
<span class="nt">Method</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;sklearn.ensemble.RandomForestClassifier&quot;</span><span class="w"> </span><span class="c1"># DO NOT CHANGE</span><span class="w"></span>
<span class="w">  </span><span class="nt">target_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;label&quot;</span><span class="w"> </span><span class="c1"># defined between 0 and 1 (DO NOT CHANGE)</span><span class="w"></span>
<span class="w">  </span><span class="nt">tuned_parameters</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="c1"># Please, see scikit-learn&#39;s API for what each parameter means</span><span class="w"></span>
<span class="w">    </span><span class="c1"># WARNING: null (not a string) == &#39;None&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nt">n_estimators</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span><span class="w"> </span><span class="c1"># integer</span><span class="w"></span>
<span class="w">    </span><span class="nt">criterion</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;gini&quot;</span><span class="w"> </span><span class="c1"># &#39;gini&#39; or &#39;entropy&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nt">max_depth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span><span class="w"> </span><span class="c1"># null or integer</span><span class="w"></span>
<span class="w">    </span><span class="nt">min_samples_split</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"> </span><span class="c1"># integer or float</span><span class="w"></span>
<span class="w">    </span><span class="nt">min_samples_leaf</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"> </span><span class="c1"># integer or float</span><span class="w"></span>
<span class="w">    </span><span class="nt">min_weight_fraction_leaf</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span><span class="w"> </span><span class="c1"># float</span><span class="w"></span>
<span class="w">    </span><span class="nt">max_features</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"> </span><span class="c1"># &#39;auto&#39;, &#39;sqrt&#39;, &#39;log2&#39;, integer or float</span><span class="w"></span>
<span class="w">    </span><span class="nt">max_leaf_nodes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"> </span><span class="c1"># null or integer</span><span class="w"></span>
<span class="w">    </span><span class="nt">min_impurity_decrease</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span><span class="w"> </span><span class="c1"># float</span><span class="w"></span>
<span class="w">    </span><span class="nt">bootstrap</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span><span class="w"> </span><span class="c1"># True or False</span><span class="w"></span>
<span class="w">    </span><span class="nt">oob_score</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span><span class="w"> </span><span class="c1"># True or False</span><span class="w"></span>
<span class="w">    </span><span class="nt">n_jobs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"> </span><span class="c1"># null or integer</span><span class="w"></span>
<span class="w">    </span><span class="nt">random_state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w"> </span><span class="c1"># null or integer or RandomState</span><span class="w"></span>
<span class="w">    </span><span class="nt">verbose</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w"> </span><span class="c1"># integer</span><span class="w"></span>
<span class="w">    </span><span class="nt">warm_start</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span><span class="w"> </span><span class="c1"># &#39;True&#39; or &#39;False&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nt">class_weight</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"> </span><span class="c1"># &#39;balanced&#39;, &#39;balanced_subsample&#39;, null, dict or list of dicts</span><span class="w"></span>
<span class="w">    </span><span class="nt">ccp_alpha</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span><span class="w"> </span><span class="c1"># non-negative float</span><span class="w"></span>
<span class="w">    </span><span class="nt">max_samples</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"> </span><span class="c1"># null, integer or float</span><span class="w"></span>
<span class="w">  </span><span class="nt">use_proba</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class="w"> </span><span class="c1"># If True output is &#39;gammaness&#39;, else &#39;score&#39;</span><span class="w"></span>
<span class="w">  </span><span class="nt">calibrate_output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span><span class="w"> </span><span class="c1"># If True calibrate model on test data</span><span class="w"></span>

<span class="c1"># List of the features to use to train the model</span><span class="w"></span>
<span class="c1"># You can:</span><span class="w"></span>
<span class="c1"># - comment/uncomment the ones you see here,</span><span class="w"></span>
<span class="c1"># - add new ones here if they can be evaluated with pandas.DataFrame.eval</span><span class="w"></span>
<span class="c1"># - if not you can propose modifications to protopipe.mva.utils.prepare_data</span><span class="w"></span>
<span class="nt">FeatureList</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">Basic</span><span class="p">:</span><span class="w"> </span><span class="c1"># single-named, they need to correspond to input data columns</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;h_max&quot;</span><span class="w"> </span><span class="c1"># Height of shower maximum from stereoscopic reconstruction</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;impact_dist&quot;</span><span class="w"> </span><span class="c1"># Impact parameter from stereoscopic reconstruction</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;hillas_width&quot;</span><span class="w"> </span><span class="c1"># Image Width</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;hillas_length&quot;</span><span class="w"> </span><span class="c1"># Image Length</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;concentration_pixel&quot;</span><span class="w"> </span><span class="c1"># Percentage of photo-electrons in the brightest pixel</span><span class="w"></span>
<span class="w">  </span><span class="nt">Derived</span><span class="p">:</span><span class="w"> </span><span class="c1"># custom evaluations of basic features that will be added to the data</span><span class="w"></span>
<span class="w">    </span><span class="c1"># column name : expression to evaluate using basic column names</span><span class="w"></span>
<span class="w">    </span><span class="nt">log10_intensity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">log10(hillas_intensity)</span><span class="w"></span>
<span class="w">    </span><span class="nt">log10_reco_energy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">log10(reco_energy)</span><span class="w"> </span><span class="c1"># Averaged-estimated energy of the shower</span><span class="w"></span>
<span class="w">    </span><span class="nt">log10_reco_energy_tel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">log10(reco_energy_tel)</span><span class="w"> </span><span class="c1"># Estimated energy of the shower per telescope</span><span class="w"></span>

<span class="c1"># These cuts select the input data BEFORE training</span><span class="w"></span>
<span class="nt">SigFiducialCuts</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;good_image</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">1&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;is_valid</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">True&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;hillas_intensity</span><span class="nv"> </span><span class="s">&gt;</span><span class="nv"> </span><span class="s">0&quot;</span><span class="w"></span>

<span class="nt">BkgFiducialCuts</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;good_image</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">1&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;is_valid</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">True&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;hillas_intensity</span><span class="nv"> </span><span class="s">&gt;</span><span class="nv"> </span><span class="s">0&quot;</span><span class="w"></span>

<span class="nt">Diagnostic</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="c1"># Energy binning (used for reco and true energy)</span><span class="w"></span>
<span class="w">  </span><span class="nt">energy</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">nbins</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w"></span>
<span class="w">    </span><span class="nt">min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0125</span><span class="w"></span>
<span class="w">    </span><span class="nt">max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">200</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The default settings used are not yet optimised for every case.</p>
<p>They have been tuned to get reasonable performance and a good agreeement
between the training/test samples.</p>
<p>A first optimisation was reached from a step-by-step comparison against the historical pipeline
CTAMARS.</p>
</div>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="data_training.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Data training</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="DL2.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Production of DL2 data</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2020, Michele Peresano.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>