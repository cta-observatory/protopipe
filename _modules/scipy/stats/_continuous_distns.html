
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>scipy.stats._continuous_distns &#8212; protopipe 0.5.1.dev21+g51ed745 documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/landing_page.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="../../../index.html">
<p class="title">protopipe</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../install/index.html">
  Getting started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../usage/index.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../reference/index.html">
  API Reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../contribute/index.html">
  Development
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../AUTHORS.html">
  Authors
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../CHANGELOG.html">
  Changelog
 </a>
</li>

    
    <li class="nav-item">
        <a class="nav-link nav-external" href="http://cccta-dataserver.in2p3.fr/data/protopipe/results/html/">Performance<i class="fas fa-external-link-alt"></i></a>
    </li>
    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-primary btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        latest  <!-- this text may get changed later by javascript -->
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
</div>

<!-- NOTE: this JS must live here (not in our global JS file) because it relies
     on being processed by Jinja before it is run (specifically for replacing
     variables _modules/scipy/stats/_continuous_distns and {'json_url': '/_static/switcher.json', 'version_match': 'latest'}.
-->

<script type="text/javascript">
// Check if corresponding page path exists in other version of docs
// and, if so, go there instead of the homepage of the other docs version
function checkPageExistsAndRedirect(event) {
    const currentFilePath = "_modules/scipy/stats/_continuous_distns.html",
          tryUrl = event.target.getAttribute("href");
    let otherDocsHomepage = tryUrl.replace(currentFilePath, "");
    $.ajax({
        type: 'HEAD',
        url: tryUrl,
        // if the page exists, go there
        success: function() {
            location.href = tryUrl;
        }
    }).fail(function() {
        location.href = otherDocsHomepage;
    });
    // this prevents the browser from following the href of the clicked node
    // (which is fine because this function takes care of redirecting)
    return false;
}

// Populate the version switcher from the JSON config file
(function () {
    $.getJSON("/_static/switcher.json", function(data, textStatus, jqXHR) {
        const currentFilePath = "_modules/scipy/stats/_continuous_distns.html";
        // create links to the corresponding page in the other docs versions
        $.each(data, function(index, entry) {
            // if no custom name specified (e.g., "latest"), use version string
            if (!("name" in entry)) {
                entry.name = entry.version;
            }
            // create the node
            const node = document.createElement("a");
            node.setAttribute("class", "list-group-item list-group-item-action py-1");
            node.textContent = `${entry.name}`;
            node.setAttribute("href", `${entry.url}${currentFilePath}`);
            // on click, AJAX calls will check if the linked page exists before
            // trying to redirect, and if not, will redirect to the homepage
            // for that version of the docs.
            node.onclick = checkPageExistsAndRedirect;
            // Add dataset values for the version and name in case people want
            // to apply CSS styling based on this information.
            node.dataset["versionName"] = entry.name;
            node.dataset["version"] = entry.version;

            $("#version_switcher_menu").append(node);
            // replace dropdown button text with the preferred display name of
            // this version, rather than using sphinx's 0.5.1.dev21+g51ed745 variable.
            // also highlight the dropdown entry for the currently-viewed
            // version's entry
            if (entry.version == "latest") {
                node.classList.add("active");
                let btn = document.getElementById("version_switcher_button");
                btn.innerText = btn.dataset["activeVersionName"] = entry.name;
                btn.dataset["activeVersion"] = entry.version;
            }
        });
    });
})();
</script>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Quick Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/cta-observatory/protopipe" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://pypi.org/project/protopipe/" rel="noopener" target="_blank" title="PyPI"><span><i class="fab fa-python"></i></span>
            <label class="sr-only">PyPI</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs..." aria-label="Search the docs..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <h1>Source code for scipy.stats._continuous_distns</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">#</span>
<span class="c1"># Author:  Travis Oliphant  2002-2011 with contributions from</span>
<span class="c1">#          SciPy Developers 2004-2011</span>
<span class="c1">#</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">import</span> <span class="nn">ctypes</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">scipy._lib.doccer</span> <span class="kn">import</span> <span class="p">(</span><span class="n">extend_notes_in_docstring</span><span class="p">,</span>
                               <span class="n">replace_notes_in_docstring</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">scipy._lib._ccallback</span> <span class="kn">import</span> <span class="n">LowLevelCallable</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">optimize</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>
<span class="kn">import</span> <span class="nn">scipy.special</span> <span class="k">as</span> <span class="nn">sc</span>

<span class="kn">import</span> <span class="nn">scipy.special._ufuncs</span> <span class="k">as</span> <span class="nn">scu</span>
<span class="kn">from</span> <span class="nn">scipy._lib._util</span> <span class="kn">import</span> <span class="n">_lazyselect</span><span class="p">,</span> <span class="n">_lazywhere</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">_stats</span>
<span class="kn">from</span> <span class="nn">._tukeylambda_stats</span> <span class="kn">import</span> <span class="p">(</span><span class="n">tukeylambda_variance</span> <span class="k">as</span> <span class="n">_tlvar</span><span class="p">,</span>
                                 <span class="n">tukeylambda_kurtosis</span> <span class="k">as</span> <span class="n">_tlkurt</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">._distn_infrastructure</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_distribution_names</span><span class="p">,</span> <span class="n">_kurtosis</span><span class="p">,</span> <span class="n">_ncx2_cdf</span><span class="p">,</span> <span class="n">_ncx2_log_pdf</span><span class="p">,</span> <span class="n">_ncx2_pdf</span><span class="p">,</span>
    <span class="n">rv_continuous</span><span class="p">,</span> <span class="n">_skew</span><span class="p">,</span> <span class="n">_get_fixed_fit_value</span><span class="p">,</span> <span class="n">_check_shape</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">._ksstats</span> <span class="kn">import</span> <span class="n">kolmogn</span><span class="p">,</span> <span class="n">kolmognp</span><span class="p">,</span> <span class="n">kolmogni</span>
<span class="kn">from</span> <span class="nn">._constants</span> <span class="kn">import</span> <span class="p">(</span><span class="n">_XMIN</span><span class="p">,</span> <span class="n">_EULER</span><span class="p">,</span> <span class="n">_ZETA3</span><span class="p">,</span>
                         <span class="n">_SQRT_2_OVER_PI</span><span class="p">,</span> <span class="n">_LOG_SQRT_2_OVER_PI</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">scipy.stats._boost</span> <span class="k">as</span> <span class="nn">_boost</span>


<span class="k">def</span> <span class="nf">_remove_optimizer_parameters</span><span class="p">(</span><span class="n">kwds</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove the optimizer-related keyword arguments &#39;loc&#39;, &#39;scale&#39; and</span>
<span class="sd">    &#39;optimizer&#39; from `kwds`.  Then check that `kwds` is empty, and</span>
<span class="sd">    raise `TypeError(&quot;Unknown arguments: %s.&quot; % kwds)` if it is not.</span>

<span class="sd">    This function is used in the fit method of distributions that override</span>
<span class="sd">    the default method and do not use the default optimization code.</span>

<span class="sd">    `kwds` is modified in-place.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;optimizer&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kwds</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Unknown arguments: </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">kwds</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_call_super_mom</span><span class="p">(</span><span class="n">fun</span><span class="p">):</span>
    <span class="c1"># if fit method is overridden only for MLE and doesn&#39;t specify what to do</span>
    <span class="c1"># if method == &#39;mm&#39;, this decorator calls generic implementation</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;mle&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;mm&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">class</span> <span class="nc">ksone_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Kolmogorov-Smirnov one-sided test statistic distribution.</span>

<span class="sd">    This is the distribution of the one-sided Kolmogorov-Smirnov (KS)</span>
<span class="sd">    statistics :math:`D_n^+` and :math:`D_n^-`</span>
<span class="sd">    for a finite sample size ``n`` (the shape parameter).</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    kstwobign, kstwo, kstest</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    :math:`D_n^+` and :math:`D_n^-` are given by</span>

<span class="sd">    .. math::</span>

<span class="sd">        D_n^+ &amp;= \text{sup}_x (F_n(x) - F(x)),\\</span>
<span class="sd">        D_n^- &amp;= \text{sup}_x (F(x) - F_n(x)),\\</span>

<span class="sd">    where :math:`F` is a continuous CDF and :math:`F_n` is an empirical CDF.</span>
<span class="sd">    `ksone` describes the distribution under the null hypothesis of the KS test</span>
<span class="sd">    that the empirical CDF corresponds to :math:`n` i.i.d. random variates</span>
<span class="sd">    with CDF :math:`F`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Birnbaum, Z. W. and Tingey, F.H. &quot;One-sided confidence contours</span>
<span class="sd">       for probability distribution functions&quot;, The Annals of Mathematical</span>
<span class="sd">       Statistics, 22(4), pp 592-596 (1951).</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">scu</span><span class="o">.</span><span class="n">_smirnovp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">scu</span><span class="o">.</span><span class="n">_smirnovc</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">smirnov</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">scu</span><span class="o">.</span><span class="n">_smirnovci</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">smirnovi</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>


<span class="n">ksone</span> <span class="o">=</span> <span class="n">ksone_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ksone&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">kstwo_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Kolmogorov-Smirnov two-sided test statistic distribution.</span>

<span class="sd">    This is the distribution of the two-sided Kolmogorov-Smirnov (KS)</span>
<span class="sd">    statistic :math:`D_n` for a finite sample size ``n``</span>
<span class="sd">    (the shape parameter).</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    kstwobign, ksone, kstest</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    :math:`D_n` is given by</span>

<span class="sd">    .. math::</span>

<span class="sd">        D_n = \text{sup}_x |F_n(x) - F(x)|</span>

<span class="sd">    where :math:`F` is a (continuous) CDF and :math:`F_n` is an empirical CDF.</span>
<span class="sd">    `kstwo` describes the distribution under the null hypothesis of the KS test</span>
<span class="sd">    that the empirical CDF corresponds to :math:`n` i.i.d. random variates</span>
<span class="sd">    with CDF :math:`F`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Simard, R., L&#39;Ecuyer, P. &quot;Computing the Two-Sided</span>
<span class="sd">       Kolmogorov-Smirnov Distribution&quot;,  Journal of Statistical Software,</span>
<span class="sd">       Vol 39, 11, 1-18 (2011).</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_get_support</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">/</span><span class="p">(</span><span class="n">n</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">n</span><span class="p">)),</span>
                <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">kolmognp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">kolmogn</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">kolmogn</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">cdf</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">kolmogni</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">cdf</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">kolmogni</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">cdf</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="c1"># Use the pdf, (not the ppf) to compute moments</span>
<span class="n">kstwo</span> <span class="o">=</span> <span class="n">kstwo_gen</span><span class="p">(</span><span class="n">momtype</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;kstwo&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">kstwobign_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Limiting distribution of scaled Kolmogorov-Smirnov two-sided test statistic.</span>

<span class="sd">    This is the asymptotic distribution of the two-sided Kolmogorov-Smirnov</span>
<span class="sd">    statistic :math:`\sqrt{n} D_n` that measures the maximum absolute</span>
<span class="sd">    distance of the theoretical (continuous) CDF from the empirical CDF.</span>
<span class="sd">    (see `kstest`).</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    ksone, kstwo, kstest</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    :math:`\sqrt{n} D_n` is given by</span>

<span class="sd">    .. math::</span>

<span class="sd">        D_n = \text{sup}_x |F_n(x) - F(x)|</span>

<span class="sd">    where :math:`F` is a continuous CDF and :math:`F_n` is an empirical CDF.</span>
<span class="sd">    `kstwobign`  describes the asymptotic distribution (i.e. the limit of</span>
<span class="sd">    :math:`\sqrt{n} D_n`) under the null hypothesis of the KS test that the</span>
<span class="sd">    empirical CDF corresponds to i.i.d. random variates with CDF :math:`F`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Feller, W. &quot;On the Kolmogorov-Smirnov Limit Theorems for Empirical</span>
<span class="sd">       Distributions&quot;,  Ann. Math. Statist. Vol 19, 177-189 (1948).</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">scu</span><span class="o">.</span><span class="n">_kolmogp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">scu</span><span class="o">.</span><span class="n">_kolmogc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">kolmogorov</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">scu</span><span class="o">.</span><span class="n">_kolmogci</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">kolmogi</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>


<span class="n">kstwobign</span> <span class="o">=</span> <span class="n">kstwobign_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;kstwobign&#39;</span><span class="p">)</span>


<span class="c1">## Normal distribution</span>

<span class="c1"># loc = mu, scale = std</span>
<span class="c1"># Keep these implementations out of the class definition so they can be reused</span>
<span class="c1"># by other distributions.</span>
<span class="n">_norm_pdf_C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">_norm_pdf_logC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">_norm_pdf_C</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_norm_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">_norm_pdf_C</span>


<span class="k">def</span> <span class="nf">_norm_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="n">_norm_pdf_logC</span>


<span class="k">def</span> <span class="nf">_norm_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">ndtr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_norm_logcdf</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">log_ndtr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_norm_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">ndtri</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_norm_sf</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_norm_logsf</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_norm_isf</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">_norm_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">norm_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A normal continuous random variable.</span>

<span class="sd">    The location (``loc``) keyword specifies the mean.</span>
<span class="sd">    The scale (``scale``) keyword specifies the standard deviation.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `norm` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{\exp(-x^2/2)}{\sqrt{2\pi}}</span>

<span class="sd">    for a real number :math:`x`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># norm.pdf(x) = exp(-x**2/2)/sqrt(2*pi)</span>
        <span class="k">return</span> <span class="n">_norm_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_sf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_logsf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_isf</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

    <span class="nd">@_call_super_mom</span>
    <span class="nd">@replace_notes_in_docstring</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">        For the normal distribution, method of moments and maximum likelihood</span>
<span class="s2">        estimation give identical fits, and explicit formulas for the estimates</span>
<span class="s2">        are available.</span>
<span class="s2">        This function uses these explicit formulas for the maximum likelihood</span>
<span class="s2">        estimation of the normal distribution parameters, so the</span>
<span class="s2">        `optimizer` and `method` arguments are ignored.</span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>

        <span class="n">floc</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;floc&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">fscale</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fscale&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">_remove_optimizer_parameters</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># This check is for consistency with `rv_continuous.fit`.</span>
            <span class="c1"># Without this check, this function would just return the</span>
            <span class="c1"># parameters that were given.</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All parameters fixed. There is nothing to &quot;</span>
                             <span class="s2">&quot;optimize.&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;The data contains non-finite values.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">floc</span>

        <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">data</span> <span class="o">-</span> <span class="n">loc</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">fscale</span>

        <span class="k">return</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @returns Moments of standard normal distribution for integer n &gt;= 0</span>

<span class="sd">        See eq. 16 of https://arxiv.org/abs/1209.4340v2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">factorial2</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.</span>


<span class="n">norm</span> <span class="o">=</span> <span class="n">norm_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;norm&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">alpha_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;An alpha continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `alpha` ([1]_, [2]_) is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a) = \frac{1}{x^2 \Phi(a) \sqrt{2\pi}} *</span>
<span class="sd">                  \exp(-\frac{1}{2} (a-1/x)^2)</span>

<span class="sd">    where :math:`\Phi` is the normal CDF, :math:`x &gt; 0`, and :math:`a &gt; 0`.</span>

<span class="sd">    `alpha` takes ``a`` as a shape parameter.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Johnson, Kotz, and Balakrishnan, &quot;Continuous Univariate</span>
<span class="sd">           Distributions, Volume 1&quot;, Second Edition, John Wiley and Sons,</span>
<span class="sd">           p. 173 (1994).</span>
<span class="sd">    .. [2] Anthony A. Salvia, &quot;Reliability applications of the Alpha</span>
<span class="sd">           Distribution&quot;, IEEE Transactions on Reliability, Vol. R-34,</span>
<span class="sd">           No. 3, pp. 251-252 (1985).</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="c1"># alpha.pdf(x, a) = 1/(x**2*Phi(a)*sqrt(2*pi)) * exp(-1/2 * (a-1/x)**2)</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">_norm_cdf</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">_norm_pdf</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">_norm_logpdf</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">_norm_cdf</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">ndtri</span><span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">_norm_cdf</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>


<span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">anglit_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;An anglit continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `anglit` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \sin(2x + \pi/2) = \cos(2x)</span>

<span class="sd">    for :math:`-\pi/4 \le x \le \pi/4`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># anglit.pdf(x) = sin(2*x + \pi/2) = cos(2*x)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">16</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">96</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


<span class="n">anglit</span> <span class="o">=</span> <span class="n">anglit_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;anglit&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">arcsine_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;An arcsine continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `arcsine` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{1}{\pi \sqrt{x (1-x)}}</span>

<span class="sd">    for :math:`0 &lt; x &lt; 1`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># arcsine.pdf(x) = 1/(pi*sqrt(x*(1-x)))</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span><span class="o">*</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="mi">8</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.0</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="mf">0.24156447527049044468</span>


<span class="n">arcsine</span> <span class="o">=</span> <span class="n">arcsine_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;arcsine&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FitDataError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
    <span class="c1"># This exception is raised by, for example, beta_gen.fit when both floc</span>
    <span class="c1"># and fscale are fixed and there are values in the data not in the open</span>
    <span class="c1"># interval (floc, floc+fscale).</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distr</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Invalid values in `data`.  Maximum likelihood &quot;</span>
            <span class="s2">&quot;estimation with </span><span class="si">{distr!r}</span><span class="s2"> requires that </span><span class="si">{lower!r}</span><span class="s2"> &lt; &quot;</span>
            <span class="s2">&quot;(x - loc)/scale  &lt; </span><span class="si">{upper!r}</span><span class="s2"> for each x in `data`.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">distr</span><span class="o">=</span><span class="n">distr</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">upper</span><span class="p">),</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">FitSolverError</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
    <span class="c1"># This exception is raised by, for example, beta_gen.fit when</span>
    <span class="c1"># optimize.fsolve returns with ier != 1.</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesg</span><span class="p">):</span>
        <span class="n">emsg</span> <span class="o">=</span> <span class="s2">&quot;Solver for the MLE equations failed to converge: &quot;</span>
        <span class="n">emsg</span> <span class="o">+=</span> <span class="n">mesg</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">emsg</span><span class="p">,)</span>


<span class="k">def</span> <span class="nf">_beta_mle_a</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">s1</span><span class="p">):</span>
    <span class="c1"># The zeros of this function give the MLE for `a`, with</span>
    <span class="c1"># `b`, `n` and `s1` given.  `s1` is the sum of the logs of</span>
    <span class="c1"># the data. `n` is the number of data points.</span>
    <span class="n">psiab</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">-</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">psiab</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">func</span>


<span class="k">def</span> <span class="nf">_beta_mle_ab</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">):</span>
    <span class="c1"># Zeros of this function are critical points of</span>
    <span class="c1"># the maximum likelihood function.  Solving this system</span>
    <span class="c1"># for theta (which contains a and b) gives the MLE for a and b</span>
    <span class="c1"># given `n`, `s1` and `s2`.  `s1` is the sum of the logs of the data,</span>
    <span class="c1"># and `s2` is the sum of the logs of 1 - data.  `n` is the number</span>
    <span class="c1"># of data points.</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">theta</span>
    <span class="n">psiab</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">func</span> <span class="o">=</span> <span class="p">[</span><span class="n">s1</span> <span class="o">-</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">psiab</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">a</span><span class="p">)),</span>
            <span class="n">s2</span> <span class="o">-</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">psiab</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">b</span><span class="p">))]</span>
    <span class="k">return</span> <span class="n">func</span>


<span class="k">class</span> <span class="nc">beta_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A beta continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `beta` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a, b) = \frac{\Gamma(a+b) x^{a-1} (1-x)^{b-1}}</span>
<span class="sd">                          {\Gamma(a) \Gamma(b)}</span>

<span class="sd">    for :math:`0 &lt;= x &lt;= 1`, :math:`a &gt; 0`, :math:`b &gt; 0`, where</span>
<span class="sd">    :math:`\Gamma` is the gamma function (`scipy.special.gamma`).</span>

<span class="sd">    `beta` takes :math:`a` and :math:`b` as shape parameters.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1">#                     gamma(a+b) * x**(a-1) * (1-x)**(b-1)</span>
        <span class="c1"># beta.pdf(x, a, b) = ------------------------------------</span>
        <span class="c1">#                              gamma(a)*gamma(b)</span>
        <span class="k">return</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_beta_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">lPx</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlog1py</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">lPx</span> <span class="o">-=</span> <span class="n">sc</span><span class="o">.</span><span class="n">betaln</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lPx</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_beta_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_beta_sf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="c1"># See gh-14901</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;overflow encountered in _beta_isf&quot;</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_beta_isf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;overflow encountered in _beta_ppf&quot;</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_beta_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span>
            <span class="n">_boost</span><span class="o">.</span><span class="n">_beta_mean</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span>
            <span class="n">_boost</span><span class="o">.</span><span class="n">_beta_variance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span>
            <span class="n">_boost</span><span class="o">.</span><span class="n">_beta_skewness</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span>
            <span class="n">_boost</span><span class="o">.</span><span class="n">_beta_kurtosis_excess</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">_skew</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">_kurtosis</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">x</span>
            <span class="n">sk</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">)</span>
            <span class="n">ku</span> <span class="o">=</span> <span class="n">a</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ku</span> <span class="o">/=</span> <span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">ku</span> <span class="o">*=</span> <span class="mi">6</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">sk</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span> <span class="n">ku</span><span class="o">-</span><span class="n">g2</span><span class="p">]</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">fsolve</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_fitstart</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

    <span class="nd">@_call_super_mom</span>
    <span class="nd">@extend_notes_in_docstring</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">        In the special case where `method=&quot;MLE&quot;` and</span>
<span class="s2">        both `floc` and `fscale` are given, a</span>
<span class="s2">        `ValueError` is raised if any value `x` in `data` does not satisfy</span>
<span class="s2">        `floc &lt; x &lt; floc + fscale`.</span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="c1"># Override rv_continuous.fit, so we can more efficiently handle the</span>
        <span class="c1"># case where floc and fscale are given.</span>

        <span class="n">floc</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;floc&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">fscale</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fscale&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># do general fit</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="c1"># We already got these from kwds, so just pop them.</span>
        <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;floc&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fscale&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">f0</span> <span class="o">=</span> <span class="n">_get_fixed_fit_value</span><span class="p">(</span><span class="n">kwds</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;f0&#39;</span><span class="p">,</span> <span class="s1">&#39;fa&#39;</span><span class="p">,</span> <span class="s1">&#39;fix_a&#39;</span><span class="p">])</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">_get_fixed_fit_value</span><span class="p">(</span><span class="n">kwds</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="s1">&#39;fb&#39;</span><span class="p">,</span> <span class="s1">&#39;fix_b&#39;</span><span class="p">])</span>

        <span class="n">_remove_optimizer_parameters</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">f0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">f1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># This check is for consistency with `rv_continuous.fit`.</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All parameters fixed. There is nothing to &quot;</span>
                             <span class="s2">&quot;optimize.&quot;</span><span class="p">)</span>

        <span class="c1"># Special case: loc and scale are constrained, so we are fitting</span>
        <span class="c1"># just the shape parameters.  This can be done much more efficiently</span>
        <span class="c1"># than the method used in `rv_continuous.fit`.  (See the subsection</span>
        <span class="c1"># &quot;Two unknown parameters&quot; in the section &quot;Maximum likelihood&quot; of</span>
        <span class="c1"># the Wikipedia article on the Beta distribution for the formulas.)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;The data contains non-finite values.&quot;</span><span class="p">)</span>

        <span class="c1"># Normalize the data to the interval [0, 1].</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">floc</span><span class="p">)</span> <span class="o">/</span> <span class="n">fscale</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">data</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">data</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">FitDataError</span><span class="p">(</span><span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="n">floc</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">floc</span> <span class="o">+</span> <span class="n">fscale</span><span class="p">)</span>

        <span class="n">xbar</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">f0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">f1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># One of the shape parameters is fixed.</span>

            <span class="k">if</span> <span class="n">f0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># The shape parameter a is fixed, so swap the parameters</span>
                <span class="c1"># and flip the data.  We always solve for `a`.  The result</span>
                <span class="c1"># will be swapped back before returning.</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">f0</span>
                <span class="n">data</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">data</span>
                <span class="n">xbar</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">xbar</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">f1</span>

            <span class="c1"># Initial guess for a.  Use the formula for the mean of the beta</span>
            <span class="c1"># distribution, E[x] = a / (a + b), to generate a reasonable</span>
            <span class="c1"># starting point based on the mean of the data and the given</span>
            <span class="c1"># value of b.</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">xbar</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">xbar</span><span class="p">)</span>

            <span class="c1"># Compute the MLE for `a` by solving _beta_mle_a.</span>
            <span class="n">theta</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">ier</span><span class="p">,</span> <span class="n">mesg</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">fsolve</span><span class="p">(</span>
                <span class="n">_beta_mle_a</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()),</span>
                <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">ier</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FitSolverError</span><span class="p">(</span><span class="n">mesg</span><span class="o">=</span><span class="n">mesg</span><span class="p">)</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">f0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># The shape parameter a was fixed, so swap back the</span>
                <span class="c1"># parameters.</span>
                <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Neither of the shape parameters is fixed.</span>

            <span class="c1"># s1 and s2 are used in the extra arguments passed to _beta_mle_ab</span>
            <span class="c1"># by optimize.fsolve.</span>
            <span class="n">s1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">s2</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

            <span class="c1"># Use the &quot;method of moments&quot; to estimate the initial</span>
            <span class="c1"># guess for a and b.</span>
            <span class="n">fac</span> <span class="o">=</span> <span class="n">xbar</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">xbar</span><span class="p">)</span> <span class="o">/</span> <span class="n">data</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">xbar</span> <span class="o">*</span> <span class="n">fac</span>
            <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">xbar</span><span class="p">)</span> <span class="o">*</span> <span class="n">fac</span>

            <span class="c1"># Compute the MLE for a and b by solving _beta_mle_ab.</span>
            <span class="n">theta</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">ier</span><span class="p">,</span> <span class="n">mesg</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">fsolve</span><span class="p">(</span>
                <span class="n">_beta_mle_ab</span><span class="p">,</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span>
                <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">),</span>
                <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">ier</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FitSolverError</span><span class="p">(</span><span class="n">mesg</span><span class="o">=</span><span class="n">mesg</span><span class="p">)</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">theta</span>

        <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span>


<span class="n">beta</span> <span class="o">=</span> <span class="n">beta_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;beta&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">betaprime_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A beta prime continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `betaprime` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a, b) = \frac{x^{a-1} (1+x)^{-a-b}}{\beta(a, b)}</span>

<span class="sd">    for :math:`x &gt;= 0`, :math:`a &gt; 0`, :math:`b &gt; 0`, where</span>
<span class="sd">    :math:`\beta(a, b)` is the beta function (see `scipy.special.beta`).</span>

<span class="sd">    `betaprime` takes ``a`` and ``b`` as shape parameters.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="n">u2</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">u1</span> <span class="o">/</span> <span class="n">u2</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># betaprime.pdf(x, a, b) = x**(a-1) * (1+x)**(-a-b) / beta(a, b)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlog1py</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">betaln</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">betainc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="n">a</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mf">1.0</span><span class="p">),</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mf">2.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">b</span><span class="o">-</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)),</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mf">3.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">,</span>
                            <span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mf">2.0</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">b</span><span class="o">-</span><span class="mf">3.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)),</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mf">4.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">/</span>
                             <span class="p">((</span><span class="n">b</span> <span class="o">-</span> <span class="mf">4.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="mf">3.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">))),</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>


<span class="n">betaprime</span> <span class="o">=</span> <span class="n">betaprime_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;betaprime&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">bradford_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Bradford continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `bradford` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = \frac{c}{\log(1+c) (1+cx)}</span>

<span class="sd">    for :math:`0 &lt;= x &lt;= 1` and :math:`c &gt; 0`.</span>

<span class="sd">    `bradford` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># bradford.pdf(x, c) = c / (k * (1+c*x))</span>
        <span class="k">return</span> <span class="n">c</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">/</span> <span class="n">c</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">moments</span><span class="o">=</span><span class="s1">&#39;mv&#39;</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">c</span><span class="p">)</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">k</span><span class="p">)</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="p">((</span><span class="n">c</span><span class="o">+</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">k</span><span class="p">)</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;s&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">g1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">12</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="o">-</span><span class="mi">9</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="p">))</span>
            <span class="n">g1</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">6</span><span class="o">*</span><span class="n">k</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;k&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">g2</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">k</span><span class="o">-</span><span class="mi">16</span><span class="p">)</span><span class="o">+</span><span class="mi">24</span><span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span>
                  <span class="mi">6</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">k</span><span class="o">-</span><span class="mi">14</span><span class="p">)</span> <span class="o">+</span> <span class="mi">12</span><span class="o">*</span><span class="n">k</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">g2</span> <span class="o">/=</span> <span class="mi">3</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">k</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="o">/</span><span class="n">k</span><span class="p">)</span>


<span class="n">bradford</span> <span class="o">=</span> <span class="n">bradford_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;bradford&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">burr_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Burr (Type III) continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    fisk : a special case of either `burr` or `burr12` with ``d=1``</span>
<span class="sd">    burr12 : Burr Type XII distribution</span>
<span class="sd">    mielke : Mielke Beta-Kappa / Dagum distribution</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `burr` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c, d) = c d x^{-c - 1} / (1 + x^{-c})^{d + 1}</span>

<span class="sd">    for :math:`x &gt;= 0` and :math:`c, d &gt; 0`.</span>

<span class="sd">    `burr` takes :math:`c` and :math:`d` as shape parameters.</span>

<span class="sd">    This is the PDF corresponding to the third CDF given in Burr&#39;s list;</span>
<span class="sd">    specifically, it is equation (11) in Burr&#39;s paper [1]_. The distribution</span>
<span class="sd">    is also commonly referred to as the Dagum distribution [2]_. If the</span>
<span class="sd">    parameter :math:`c &lt; 1` then the mean of the distribution does not</span>
<span class="sd">    exist and if :math:`c &lt; 2` the variance does not exist [2]_.</span>
<span class="sd">    The PDF is finite at the left endpoint :math:`x = 0` if :math:`c * d &gt;= 1`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Burr, I. W. &quot;Cumulative frequency functions&quot;, Annals of</span>
<span class="sd">       Mathematical Statistics, 13(2), pp 215-232 (1942).</span>
<span class="sd">    .. [2] https://en.wikipedia.org/wiki/Dagum_distribution</span>
<span class="sd">    .. [3] Kleiber, Christian. &quot;A guide to the Dagum distributions.&quot;</span>
<span class="sd">       Modeling Income Distributions and Lorenz Curves  pp 97-117 (2008).</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Do not set _support_mask to rv_continuous._open_support_mask</span>
    <span class="c1"># Whether the left-hand endpoint is suitable for pdf evaluation is dependent</span>
    <span class="c1"># on the values of c and d: if c*d &gt;= 1, the pdf is finite, otherwise infinite.</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="c1"># burr.pdf(x, c, d) = c * d * x**(-c-1) * (1+x**(-c))**(-d-1)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">],</span>
                   <span class="k">lambda</span> <span class="n">x_</span><span class="p">,</span> <span class="n">c_</span><span class="p">,</span> <span class="n">d_</span><span class="p">:</span> <span class="n">c_</span> <span class="o">*</span> <span class="n">d_</span> <span class="o">*</span> <span class="p">(</span><span class="n">x_</span><span class="o">**</span><span class="p">(</span><span class="n">c_</span><span class="o">*</span><span class="n">d_</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x_</span><span class="o">**</span><span class="n">c_</span><span class="p">),</span>
                   <span class="n">f2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x_</span><span class="p">,</span> <span class="n">c_</span><span class="p">,</span> <span class="n">d_</span><span class="p">:</span> <span class="p">(</span><span class="n">c_</span> <span class="o">*</span> <span class="n">d_</span> <span class="o">*</span> <span class="p">(</span><span class="n">x_</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">c_</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">))</span> <span class="o">/</span>
                                            <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x_</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">c_</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span><span class="n">d_</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">))))</span>
        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">output</span><span class="p">[()]</span>
        <span class="k">return</span> <span class="n">output</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span>
            <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">],</span>
            <span class="k">lambda</span> <span class="n">x_</span><span class="p">,</span> <span class="n">c_</span><span class="p">,</span> <span class="n">d_</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c_</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">d_</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">c_</span><span class="o">*</span><span class="n">d_</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x_</span><span class="p">)</span>
                                <span class="o">-</span> <span class="p">(</span><span class="n">d_</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">x_</span><span class="o">**</span><span class="p">(</span><span class="n">c_</span><span class="p">))),</span>
            <span class="n">f2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x_</span><span class="p">,</span> <span class="n">c_</span><span class="p">,</span> <span class="n">d_</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c_</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">d_</span><span class="p">)</span>
                                     <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="o">-</span><span class="n">c_</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x_</span><span class="p">)</span>
                                     <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlog1py</span><span class="p">(</span><span class="n">d_</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">x_</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">c_</span><span class="p">))))</span>
        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">output</span><span class="p">[()]</span>
        <span class="k">return</span> <span class="n">output</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logsf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">q</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">d</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">nc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">c</span>
        <span class="c1">#ek is the kth raw moment, e1 is the mean e2-e1**2 variance etc.</span>
        <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">e3</span><span class="p">,</span> <span class="n">e4</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="n">nc</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">nc</span><span class="p">)</span> <span class="o">*</span> <span class="n">d</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">mu2_if_c</span> <span class="o">=</span> <span class="n">e2</span> <span class="o">-</span> <span class="n">mu</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">mu2_if_c</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span>
            <span class="n">c</span> <span class="o">&gt;</span> <span class="mf">3.0</span><span class="p">,</span>
            <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">e3</span><span class="p">,</span> <span class="n">mu2_if_c</span><span class="p">),</span>
            <span class="k">lambda</span> <span class="n">c</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">e3</span><span class="p">,</span> <span class="n">mu2_if_c</span><span class="p">:</span> <span class="p">(</span><span class="n">e3</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">e2</span><span class="o">*</span><span class="n">e1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">e1</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">mu2_if_c</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span>
            <span class="n">fillvalue</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span>
            <span class="n">c</span> <span class="o">&gt;</span> <span class="mf">4.0</span><span class="p">,</span>
            <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">e3</span><span class="p">,</span> <span class="n">e4</span><span class="p">,</span> <span class="n">mu2_if_c</span><span class="p">),</span>
            <span class="k">lambda</span> <span class="n">c</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">e3</span><span class="p">,</span> <span class="n">e4</span><span class="p">,</span> <span class="n">mu2_if_c</span><span class="p">:</span> <span class="p">(</span>
                <span class="p">((</span><span class="n">e4</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">e3</span><span class="o">*</span><span class="n">e1</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="n">e2</span><span class="o">*</span><span class="n">e1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">e1</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="n">mu2_if_c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">),</span>
            <span class="n">fillvalue</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mu</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">mu2</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">g1</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">g2</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">__munp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
            <span class="n">nc</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">*</span> <span class="n">n</span> <span class="o">/</span> <span class="n">c</span>
            <span class="k">return</span> <span class="n">d</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">nc</span><span class="p">,</span> <span class="n">d</span> <span class="o">+</span> <span class="n">nc</span><span class="p">)</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">((</span><span class="n">c</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">d</span> <span class="o">==</span> <span class="n">d</span><span class="p">),</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span>
                          <span class="k">lambda</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">__munp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>


<span class="n">burr</span> <span class="o">=</span> <span class="n">burr_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;burr&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">burr12_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Burr (Type XII) continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    fisk : a special case of either `burr` or `burr12` with ``d=1``</span>
<span class="sd">    burr : Burr Type III distribution</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `burr` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c, d) = c d x^{c-1} / (1 + x^c)^{d + 1}</span>

<span class="sd">    for :math:`x &gt;= 0` and :math:`c, d &gt; 0`.</span>

<span class="sd">    `burr12` takes ``c`` and ``d`` as shape parameters for :math:`c`</span>
<span class="sd">    and :math:`d`.</span>

<span class="sd">    This is the PDF corresponding to the twelfth CDF given in Burr&#39;s list;</span>
<span class="sd">    specifically, it is equation (20) in Burr&#39;s paper [1]_.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    The Burr type 12 distribution is also sometimes referred to as</span>
<span class="sd">    the Singh-Maddala distribution from NIST [2]_.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Burr, I. W. &quot;Cumulative frequency functions&quot;, Annals of</span>
<span class="sd">       Mathematical Statistics, 13(2), pp 215-232 (1942).</span>

<span class="sd">    .. [2] https://www.itl.nist.gov/div898/software/dataplot/refman2/auxillar/b12pdf.htm</span>

<span class="sd">    .. [3] &quot;Burr distribution&quot;,</span>
<span class="sd">       https://en.wikipedia.org/wiki/Burr_distribution</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="c1"># burr12.pdf(x, c, d) = c * d * x**(c-1) * (1+x**(c))**(-d-1)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlog1py</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">**</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logsf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="n">c</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logsf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlog1py</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">,</span> <span class="n">x</span><span class="o">**</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="c1"># The following is an implementation of</span>
        <span class="c1">#   ((1 - q)**(-1.0/d) - 1)**(1.0/c)</span>
        <span class="c1"># that does a better job handling small values of q.</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">d</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">nc</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">*</span> <span class="n">n</span> <span class="o">/</span> <span class="n">c</span>
        <span class="k">return</span> <span class="n">d</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">nc</span><span class="p">,</span> <span class="n">d</span> <span class="o">-</span> <span class="n">nc</span><span class="p">)</span>


<span class="n">burr12</span> <span class="o">=</span> <span class="n">burr12_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;burr12&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">fisk_gen</span><span class="p">(</span><span class="n">burr_gen</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Fisk continuous random variable.</span>

<span class="sd">    The Fisk distribution is also known as the log-logistic distribution.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    burr</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `fisk` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = c x^{-c-1} (1 + x^{-c})^{-2}</span>

<span class="sd">    for :math:`x &gt;= 0` and :math:`c &gt; 0`.</span>

<span class="sd">    `fisk` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    `fisk` is a special case of `burr` or `burr12` with ``d=1``.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># fisk.pdf(x, c) = c * x**(-c-1) * (1 + x**(-c))**(-2)</span>
        <span class="k">return</span> <span class="n">burr</span><span class="o">.</span><span class="n">_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">burr</span><span class="o">.</span><span class="n">_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">burr</span><span class="o">.</span><span class="n">_sf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># fisk.pdf(x, c) = c * x**(-c-1) * (1 + x**(-c))**(-2)</span>
        <span class="k">return</span> <span class="n">burr</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">burr</span><span class="o">.</span><span class="n">_logcdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">burr</span><span class="o">.</span><span class="n">_logsf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">burr</span><span class="o">.</span><span class="n">_ppf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">burr</span><span class="o">.</span><span class="n">_munp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">burr</span><span class="o">.</span><span class="n">_stats</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>


<span class="n">fisk</span> <span class="o">=</span> <span class="n">fisk_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;fisk&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">cauchy_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Cauchy continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `cauchy` is</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{1}{\pi (1 + x^2)}</span>

<span class="sd">    for a real number :math:`x`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># cauchy.pdf(x) = 1 / (pi * (1 + x**2))</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">q</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Initialize ML guesses using quartiles instead of moments.</span>
        <span class="n">p25</span><span class="p">,</span> <span class="n">p50</span><span class="p">,</span> <span class="n">p75</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">p50</span><span class="p">,</span> <span class="p">(</span><span class="n">p75</span> <span class="o">-</span> <span class="n">p25</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>


<span class="n">cauchy</span> <span class="o">=</span> <span class="n">cauchy_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;cauchy&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">chi_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A chi continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `chi` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, k) = \frac{1}{2^{k/2-1} \Gamma \left( k/2 \right)}</span>
<span class="sd">                   x^{k-1} \exp \left( -x^2/2 \right)</span>

<span class="sd">    for :math:`x &gt;= 0` and :math:`k &gt; 0` (degrees of freedom, denoted ``df``</span>
<span class="sd">    in the implementation). :math:`\Gamma` is the gamma function</span>
<span class="sd">    (`scipy.special.gamma`).</span>

<span class="sd">    Special cases of `chi` are:</span>

<span class="sd">        - ``chi(1, loc, scale)`` is equivalent to `halfnorm`</span>
<span class="sd">        - ``chi(2, 0, scale)`` is equivalent to `rayleigh`</span>
<span class="sd">        - ``chi(3, 0, scale)`` is equivalent to `maxwell`</span>

<span class="sd">    `chi` takes ``df`` as a shape parameter.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">chi2</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="c1">#                   x**(df-1) * exp(-x**2/2)</span>
        <span class="c1"># chi.pdf(x, df) =  -------------------------</span>
        <span class="c1">#                   2**(df/2-1) * gamma(df/2)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">df</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="mf">.5</span><span class="o">*</span><span class="n">df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">l</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">df</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mf">.5</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="mf">.5</span><span class="o">*</span><span class="n">df</span><span class="p">,</span> <span class="mf">.5</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincc</span><span class="p">(</span><span class="mf">.5</span><span class="o">*</span><span class="n">df</span><span class="p">,</span> <span class="mf">.5</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="mf">.5</span><span class="o">*</span><span class="n">df</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gammainccinv</span><span class="p">(</span><span class="mf">.5</span><span class="o">*</span><span class="n">df</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">df</span><span class="o">/</span><span class="mf">2.0</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">df</span><span class="o">/</span><span class="mf">2.0</span><span class="p">))</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">df</span> <span class="o">-</span> <span class="n">mu</span><span class="o">*</span><span class="n">mu</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">mu</span><span class="o">**</span><span class="mf">3.0</span> <span class="o">+</span> <span class="n">mu</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">df</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">mu2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">))</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">df</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">df</span><span class="p">)</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">mu</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">mu</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">df</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">mu2</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>


<span class="n">chi</span> <span class="o">=</span> <span class="n">chi_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;chi&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">chi2_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A chi-squared continuous random variable.</span>

<span class="sd">    For the noncentral chi-square distribution, see `ncx2`.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    ncx2</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `chi2` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, k) = \frac{1}{2^{k/2} \Gamma \left( k/2 \right)}</span>
<span class="sd">                   x^{k/2-1} \exp \left( -x/2 \right)</span>

<span class="sd">    for :math:`x &gt; 0`  and :math:`k &gt; 0` (degrees of freedom, denoted ``df``</span>
<span class="sd">    in the implementation).</span>

<span class="sd">    `chi2` takes ``df`` as a shape parameter.</span>

<span class="sd">    The chi-squared distribution is a special case of the gamma</span>
<span class="sd">    distribution, with gamma parameters ``a = df/2``, ``loc = 0`` and</span>
<span class="sd">    ``scale = 2``.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">chisquare</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="c1"># chi2.pdf(x, df) = 1 / (2*gamma(df/2)) * (x/2)**(df/2-1) * exp(-x/2)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">df</span><span class="o">/</span><span class="mf">2.</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="o">/</span><span class="mf">2.</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">df</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">df</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">chdtr</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">chdtrc</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">chdtri</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="n">df</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">df</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">df</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">df</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="mf">12.0</span><span class="o">/</span><span class="n">df</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>


<span class="n">chi2</span> <span class="o">=</span> <span class="n">chi2_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;chi2&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">cosine_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A cosine continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The cosine distribution is an approximation to the normal distribution.</span>
<span class="sd">    The probability density function for `cosine` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{1}{2\pi} (1+\cos(x))</span>

<span class="sd">    for :math:`-\pi \le x \le \pi`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># cosine.pdf(x) = 1/(2*pi) * (1+cos(x))</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">scu</span><span class="o">.</span><span class="n">_cosine_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">scu</span><span class="o">.</span><span class="n">_cosine_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">scu</span><span class="o">.</span><span class="n">_cosine_invcdf</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">scu</span><span class="o">.</span><span class="n">_cosine_invcdf</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">3.0</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.0</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">4</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">5.0</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">-</span><span class="mf">1.0</span>


<span class="n">cosine</span> <span class="o">=</span> <span class="n">cosine_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">dgamma_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A double gamma continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `dgamma` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a) = \frac{1}{2\Gamma(a)} |x|^{a-1} \exp(-|x|)</span>

<span class="sd">    for a real number :math:`x` and :math:`a &gt; 0`. :math:`\Gamma` is the</span>
<span class="sd">    gamma function (`scipy.special.gamma`).</span>

<span class="sd">    `dgamma` takes ``a`` as a shape parameter for :math:`a`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">gm</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gm</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">u</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="c1"># dgamma.pdf(x, a) = 1 / (2*gamma(a)) * abs(x)**(a-1) * exp(-abs(x))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">a</span><span class="p">))</span><span class="o">*</span><span class="n">ax</span><span class="o">**</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">ax</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span> <span class="o">-</span> <span class="n">ax</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">fac</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="n">fac</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">-</span><span class="n">fac</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">+</span><span class="n">fac</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainccinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">fac</span><span class="p">,</span> <span class="o">-</span><span class="n">fac</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mf">3.0</span><span class="p">)</span><span class="o">/</span><span class="n">mu2</span><span class="o">-</span><span class="mf">3.0</span>


<span class="n">dgamma</span> <span class="o">=</span> <span class="n">dgamma_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;dgamma&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">dweibull_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A double Weibull continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `dweibull` is given by</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = c / 2 |x|^{c-1} \exp(-|x|^c)</span>

<span class="sd">    for a real number :math:`x` and :math:`c &gt; 0`.</span>

<span class="sd">    `dweibull` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">weibull_min</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">w</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">u</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># dweibull.pdf(x, c) = c / 2 * abs(x)**(c-1) * exp(-abs(x)**c)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">Px</span> <span class="o">=</span> <span class="n">c</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">ax</span><span class="o">**</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">ax</span><span class="o">**</span><span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Px</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span> <span class="o">-</span> <span class="n">ax</span><span class="o">**</span><span class="n">c</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">Cx1</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">Cx1</span><span class="p">,</span> <span class="n">Cx1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">fac</span><span class="p">),</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">fac</span><span class="p">,</span> <span class="o">-</span><span class="n">fac</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">n</span> <span class="o">/</span> <span class="n">c</span><span class="p">)</span>

    <span class="c1"># since we know that all odd moments are zeros, return them at once.</span>
    <span class="c1"># returning Nones from _stats makes the public stats call _munp</span>
    <span class="c1"># so overall we&#39;re saving one or two gamma function evaluations here.</span>
    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span>


<span class="n">dweibull</span> <span class="o">=</span> <span class="n">dweibull_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;dweibull&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">expon_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;An exponential continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `expon` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \exp(-x)</span>

<span class="sd">    for :math:`x \ge 0`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    A common parameterization for `expon` is in terms of the rate parameter</span>
<span class="sd">    ``lambda``, such that ``pdf = lambda * exp(-lambda * x)``. This</span>
<span class="sd">    parameterization corresponds to using ``scale = 1 / lambda``.</span>

<span class="sd">    The exponential distribution is a special case of the gamma</span>
<span class="sd">    distributions, with gamma shape parameter ``a = 1``.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">standard_exponential</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># expon.pdf(x) = exp(-x)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">x</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">x</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">6.0</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span>

    <span class="nd">@_call_super_mom</span>
    <span class="nd">@replace_notes_in_docstring</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">        When `method=&#39;MLE&#39;`,</span>
<span class="s2">        this function uses explicit formulas for the maximum likelihood</span>
<span class="s2">        estimation of the exponential distribution parameters, so the</span>
<span class="s2">        `optimizer`, `loc` and `scale` keyword arguments are</span>
<span class="s2">        ignored.</span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Too many arguments.&quot;</span><span class="p">)</span>

        <span class="n">floc</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;floc&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">fscale</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fscale&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">_remove_optimizer_parameters</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># This check is for consistency with `rv_continuous.fit`.</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All parameters fixed. There is nothing to &quot;</span>
                             <span class="s2">&quot;optimize.&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;The data contains non-finite values.&quot;</span><span class="p">)</span>

        <span class="n">data_min</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># ML estimate of the location is the minimum of the data.</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">data_min</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">floc</span>
            <span class="k">if</span> <span class="n">data_min</span> <span class="o">&lt;</span> <span class="n">loc</span><span class="p">:</span>
                <span class="c1"># There are values that are less than the specified loc.</span>
                <span class="k">raise</span> <span class="n">FitDataError</span><span class="p">(</span><span class="s2">&quot;expon&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="n">floc</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># ML estimate of the scale is the shifted mean.</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">loc</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">fscale</span>

        <span class="c1"># We expect the return values to be floating point, so ensure it</span>
        <span class="c1"># by explicitly converting to float.</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">loc</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>


<span class="n">expon</span> <span class="o">=</span> <span class="n">expon_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;expon&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">exponnorm_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;An exponentially modified Normal continuous random variable.</span>

<span class="sd">    Also known as the exponentially modified Gaussian distribution [1]_.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `exponnorm` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, K) = \frac{1}{2K} \exp\left(\frac{1}{2 K^2} - x / K \right)</span>
<span class="sd">                  \text{erfc}\left(-\frac{x - 1/K}{\sqrt{2}}\right)</span>

<span class="sd">    where :math:`x` is a real number and :math:`K &gt; 0`.</span>

<span class="sd">    It can be thought of as the sum of a standard normal random variable</span>
<span class="sd">    and an independent exponentially distributed random variable with rate</span>
<span class="sd">    ``1/K``.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    An alternative parameterization of this distribution (for example, in</span>
<span class="sd">    the Wikpedia article [1]_) involves three parameters, :math:`\mu`,</span>
<span class="sd">    :math:`\lambda` and :math:`\sigma`.</span>

<span class="sd">    In the present parameterization this corresponds to having ``loc`` and</span>
<span class="sd">    ``scale`` equal to :math:`\mu` and :math:`\sigma`, respectively, and</span>
<span class="sd">    shape parameter :math:`K = 1/(\sigma\lambda)`.</span>

<span class="sd">    .. versionadded:: 0.16.0</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Exponentially modified Gaussian distribution, Wikipedia,</span>
<span class="sd">           https://en.wikipedia.org/wiki/Exponentially_modified_Gaussian_distribution</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">expval</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">standard_exponential</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="n">K</span>
        <span class="n">gval</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">expval</span> <span class="o">+</span> <span class="n">gval</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">K</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
        <span class="n">invK</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">K</span>
        <span class="n">exparg</span> <span class="o">=</span> <span class="n">invK</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">invK</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">exparg</span> <span class="o">+</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">invK</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
        <span class="n">invK</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">K</span>
        <span class="n">expval</span> <span class="o">=</span> <span class="n">invK</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">invK</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">logprod</span> <span class="o">=</span> <span class="n">expval</span> <span class="o">+</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">invK</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logprod</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
        <span class="n">invK</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">K</span>
        <span class="n">expval</span> <span class="o">=</span> <span class="n">invK</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">invK</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">logprod</span> <span class="o">=</span> <span class="n">expval</span> <span class="o">+</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">invK</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logprod</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
        <span class="n">K2</span> <span class="o">=</span> <span class="n">K</span> <span class="o">*</span> <span class="n">K</span>
        <span class="n">opK2</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">K2</span>
        <span class="n">skw</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">K</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">opK2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">krt</span> <span class="o">=</span> <span class="mf">6.0</span> <span class="o">*</span> <span class="n">K2</span> <span class="o">*</span> <span class="n">K2</span> <span class="o">*</span> <span class="n">opK2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">K</span><span class="p">,</span> <span class="n">opK2</span><span class="p">,</span> <span class="n">skw</span><span class="p">,</span> <span class="n">krt</span>


<span class="n">exponnorm</span> <span class="o">=</span> <span class="n">exponnorm_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;exponnorm&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">exponweib_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;An exponentiated Weibull continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    weibull_min, numpy.random.Generator.weibull</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `exponweib` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a, c) = a c [1-\exp(-x^c)]^{a-1} \exp(-x^c) x^{c-1}</span>

<span class="sd">    and its cumulative distribution function is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        F(x, a, c) = [1-\exp(-x^c)]^a</span>

<span class="sd">    for :math:`x &gt; 0`, :math:`a &gt; 0`, :math:`c &gt; 0`.</span>

<span class="sd">    `exponweib` takes :math:`a` and :math:`c` as shape parameters:</span>

<span class="sd">    * :math:`a` is the exponentiation parameter,</span>
<span class="sd">      with the special case :math:`a=1` corresponding to the</span>
<span class="sd">      (non-exponentiated) Weibull distribution `weibull_min`.</span>
<span class="sd">    * :math:`c` is the shape parameter of the non-exponentiated Weibull law.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    https://en.wikipedia.org/wiki/Exponentiated_Weibull_distribution</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># exponweib.pdf(x, a, c) =</span>
        <span class="c1">#     a * c * (1-exp(-x**c))**(a-1) * exp(-x**c)*x**(c-1)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">negxc</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="n">c</span>
        <span class="n">exm1c</span> <span class="o">=</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">negxc</span><span class="p">)</span>
        <span class="n">logp</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">exm1c</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">negxc</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">logp</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">exm1c</span> <span class="o">=</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">exm1c</span><span class="o">**</span><span class="n">a</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">a</span><span class="p">)))</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>


<span class="n">exponweib</span> <span class="o">=</span> <span class="n">exponweib_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;exponweib&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">exponpow_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;An exponential power continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `exponpow` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, b) = b x^{b-1} \exp(1 + x^b - \exp(x^b))</span>

<span class="sd">    for :math:`x \ge 0`, :math:`b &gt; 0`.  Note that this is a different</span>
<span class="sd">    distribution from the exponential power distribution that is also known</span>
<span class="sd">    under the names &quot;generalized normal&quot; or &quot;generalized Gaussian&quot;.</span>

<span class="sd">    `exponpow` takes ``b`` as a shape parameter for :math:`b`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    http://www.math.wm.edu/~leemis/chart/UDR/PDFs/Exponentialpower.pdf</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># exponpow.pdf(x, b) = b * x**(b-1) * exp(1 + x**b - exp(x**b))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">xb</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="n">b</span>
        <span class="n">f</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">xb</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">xb</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">)),</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">b</span><span class="p">)</span>


<span class="n">exponpow</span> <span class="o">=</span> <span class="n">exponpow_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;exponpow&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">fatiguelife_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A fatigue-life (Birnbaum-Saunders) continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `fatiguelife` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = \frac{x+1}{2c\sqrt{2\pi x^3}} \exp(-\frac{(x-1)^2}{2x c^2})</span>

<span class="sd">    for :math:`x &gt;= 0` and :math:`c &gt; 0`.</span>

<span class="sd">    `fatiguelife` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] &quot;Birnbaum-Saunders distribution&quot;,</span>
<span class="sd">           https://en.wikipedia.org/wiki/Birnbaum-Saunders_distribution</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">z</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">x2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">t</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># fatiguelife.pdf(x, c) =</span>
        <span class="c1">#     (x+1) / (2*c*sqrt(2*pi*x**3)) * exp(-(x-1)**2/(2*x*c**2))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span>
                <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">ndtri</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tmp</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_sf</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">ndtri</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tmp</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># NB: the formula for kurtosis in wikipedia seems to have an error:</span>
        <span class="c1"># it&#39;s 40, not 41. At least it disagrees with the one from Wolfram</span>
        <span class="c1"># Alpha.  And the latter one, below, passes the tests, while the wiki</span>
        <span class="c1"># one doesn&#39;t So far I didn&#39;t have the guts to actually check the</span>
        <span class="c1"># coefficients from the expressions for the raw moments.</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="n">c</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">c2</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="mf">1.0</span>
        <span class="n">den</span> <span class="o">=</span> <span class="mf">5.0</span> <span class="o">*</span> <span class="n">c2</span> <span class="o">+</span> <span class="mf">4.0</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">c2</span><span class="o">*</span><span class="n">den</span> <span class="o">/</span> <span class="mf">4.0</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="mi">11</span><span class="o">*</span><span class="n">c2</span> <span class="o">+</span> <span class="mf">6.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">den</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">c2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">93</span><span class="o">*</span><span class="n">c2</span> <span class="o">+</span> <span class="mf">40.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">den</span><span class="o">**</span><span class="mf">2.0</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>


<span class="n">fatiguelife</span> <span class="o">=</span> <span class="n">fatiguelife_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;fatiguelife&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">foldcauchy_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A folded Cauchy continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `foldcauchy` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = \frac{1}{\pi (1+(x-c)^2)} + \frac{1}{\pi (1+(x+c)^2)}</span>

<span class="sd">    for :math:`x \ge 0`.</span>

<span class="sd">    `foldcauchy` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cauchy</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                              <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># foldcauchy.pdf(x, c) = 1/(pi*(1+(x-c)**2)) + 1/(pi*(1+(x+c)**2))</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">c</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>


<span class="n">foldcauchy</span> <span class="o">=</span> <span class="n">foldcauchy_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;foldcauchy&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">f_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;An F continuous random variable.</span>

<span class="sd">    For the noncentral F distribution, see `ncf`.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    ncf</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `f` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, df_1, df_2) = \frac{df_2^{df_2/2} df_1^{df_1/2} x^{df_1 / 2-1}}</span>
<span class="sd">                                {(df_2+df_1 x)^{(df_1+df_2)/2}</span>
<span class="sd">                                 B(df_1/2, df_2/2)}</span>

<span class="sd">    for :math:`x &gt; 0`.</span>

<span class="sd">    `f` takes ``dfn`` and ``dfd`` as shape parameters.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">):</span>
        <span class="c1">#                      df2**(df2/2) * df1**(df1/2) * x**(df1/2-1)</span>
        <span class="c1"># F.pdf(x, df1, df2) = --------------------------------------------</span>
        <span class="c1">#                      (df2+df1*x)**((df1+df2)/2) * B(df1/2, df2/2)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">dfn</span>
        <span class="n">m</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">dfd</span>
        <span class="n">lPx</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
               <span class="o">-</span> <span class="p">(((</span><span class="n">n</span><span class="o">+</span><span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">n</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">betaln</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">m</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">lPx</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">fdtr</span><span class="p">(</span><span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">fdtrc</span><span class="p">(</span><span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">fdtri</span><span class="p">(</span><span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">):</span>
        <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">*</span> <span class="n">dfn</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">*</span> <span class="n">dfd</span>
        <span class="n">v2_2</span><span class="p">,</span> <span class="n">v2_4</span><span class="p">,</span> <span class="n">v2_6</span><span class="p">,</span> <span class="n">v2_8</span> <span class="o">=</span> <span class="n">v2</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">v2</span> <span class="o">-</span> <span class="mf">4.</span><span class="p">,</span> <span class="n">v2</span> <span class="o">-</span> <span class="mf">6.</span><span class="p">,</span> <span class="n">v2</span> <span class="o">-</span> <span class="mf">8.</span>

        <span class="n">mu</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span>
            <span class="n">v2</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">v2_2</span><span class="p">),</span>
            <span class="k">lambda</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v2_2</span><span class="p">:</span> <span class="n">v2</span> <span class="o">/</span> <span class="n">v2_2</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

        <span class="n">mu2</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span>
            <span class="n">v2</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v2_2</span><span class="p">,</span> <span class="n">v2_4</span><span class="p">),</span>
            <span class="k">lambda</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v2_2</span><span class="p">,</span> <span class="n">v2_4</span><span class="p">:</span>
            <span class="mi">2</span> <span class="o">*</span> <span class="n">v2</span> <span class="o">*</span> <span class="n">v2</span> <span class="o">*</span> <span class="p">(</span><span class="n">v1</span> <span class="o">+</span> <span class="n">v2_2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">v1</span> <span class="o">*</span> <span class="n">v2_2</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">v2_4</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

        <span class="n">g1</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span>
            <span class="n">v2</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">,</span> <span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2_2</span><span class="p">,</span> <span class="n">v2_4</span><span class="p">,</span> <span class="n">v2_6</span><span class="p">),</span>
            <span class="k">lambda</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2_2</span><span class="p">,</span> <span class="n">v2_4</span><span class="p">,</span> <span class="n">v2_6</span><span class="p">:</span>
            <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">v1</span> <span class="o">+</span> <span class="n">v2_2</span><span class="p">)</span> <span class="o">/</span> <span class="n">v2_6</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v2_4</span> <span class="o">/</span> <span class="p">(</span><span class="n">v1</span> <span class="o">*</span> <span class="p">(</span><span class="n">v1</span> <span class="o">+</span> <span class="n">v2_2</span><span class="p">))),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">g1</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">8.</span><span class="p">)</span>

        <span class="n">g2</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span>
            <span class="n">v2</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">,</span> <span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="n">v2_6</span><span class="p">,</span> <span class="n">v2_8</span><span class="p">),</span>
            <span class="k">lambda</span> <span class="n">g1</span><span class="p">,</span> <span class="n">v2_6</span><span class="p">,</span> <span class="n">v2_8</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span> <span class="o">+</span> <span class="n">g1</span> <span class="o">*</span> <span class="n">g1</span> <span class="o">*</span> <span class="n">v2_6</span><span class="p">)</span> <span class="o">/</span> <span class="n">v2_8</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">*=</span> <span class="mf">3.</span> <span class="o">/</span> <span class="mf">2.</span>

        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>


<span class="n">f</span> <span class="o">=</span> <span class="n">f_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;f&#39;</span><span class="p">)</span>


<span class="c1">## Folded Normal</span>
<span class="c1">##   abs(Z) where (Z is normal with mu=L and std=S so that c=abs(L)/S)</span>
<span class="c1">##</span>
<span class="c1">##  note: regress docs have scale parameter correct, but first parameter</span>
<span class="c1">##    he gives is a shape parameter A = c * scale</span>

<span class="c1">##  Half-normal is folded normal with shape-parameter c=0.</span>

<span class="k">class</span> <span class="nc">foldnorm_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A folded normal continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `foldnorm` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = \sqrt{2/\pi} cosh(c x) \exp(-\frac{x^2+c^2}{2})</span>

<span class="sd">    for :math:`c \ge 0`.</span>

<span class="sd">    `foldnorm` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">c</span> <span class="o">&gt;=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">random_state</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># foldnormal.pdf(x, c) = sqrt(2/pi) * cosh(c*x) * exp(-(x**2+c**2)/2)</span>
        <span class="k">return</span> <span class="n">_norm_pdf</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">_norm_pdf</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># Regina C. Elandt, Technometrics 3, 551 (1961)</span>
        <span class="c1"># https://www.jstor.org/stable/1266561</span>
        <span class="c1">#</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="n">c</span>
        <span class="n">expfac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">c2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

        <span class="n">mu</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="n">expfac</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">erf</span><span class="p">(</span><span class="n">c</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">c2</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">mu</span><span class="o">*</span><span class="n">mu</span>

        <span class="n">g1</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">mu</span><span class="o">*</span><span class="n">mu</span><span class="o">*</span><span class="n">mu</span> <span class="o">-</span> <span class="n">c2</span><span class="o">*</span><span class="n">mu</span> <span class="o">-</span> <span class="n">expfac</span><span class="p">)</span>
        <span class="n">g1</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">mu2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>

        <span class="n">g2</span> <span class="o">=</span> <span class="n">c2</span> <span class="o">*</span> <span class="p">(</span><span class="n">c2</span> <span class="o">+</span> <span class="mf">6.</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">+</span> <span class="mf">8.</span><span class="o">*</span><span class="n">expfac</span><span class="o">*</span><span class="n">mu</span>
        <span class="n">g2</span> <span class="o">+=</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">c2</span> <span class="o">-</span> <span class="mf">3.</span><span class="p">)</span> <span class="o">-</span> <span class="mf">3.</span> <span class="o">*</span> <span class="n">mu</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">mu</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">g2</span> <span class="o">/</span> <span class="n">mu2</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">-</span> <span class="mf">3.</span>

        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>


<span class="n">foldnorm</span> <span class="o">=</span> <span class="n">foldnorm_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;foldnorm&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">weibull_min_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Weibull minimum continuous random variable.</span>

<span class="sd">    The Weibull Minimum Extreme Value distribution, from extreme value theory</span>
<span class="sd">    (Fisher-Gnedenko theorem), is also often simply called the Weibull</span>
<span class="sd">    distribution. It arises as the limiting distribution of the rescaled</span>
<span class="sd">    minimum of iid random variables.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    weibull_max, numpy.random.Generator.weibull, exponweib</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `weibull_min` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = c x^{c-1} \exp(-x^c)</span>

<span class="sd">    for :math:`x &gt; 0`, :math:`c &gt; 0`.</span>

<span class="sd">    `weibull_min` takes ``c`` as a shape parameter for :math:`c`.</span>
<span class="sd">    (named :math:`k` in Wikipedia article and :math:`a` in</span>
<span class="sd">    ``numpy.random.weibull``).  Special shape values are :math:`c=1` and</span>
<span class="sd">    :math:`c=2` where Weibull distribution reduces to the `expon` and</span>
<span class="sd">    `rayleigh` distributions respectively.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    https://en.wikipedia.org/wiki/Weibull_distribution</span>

<span class="sd">    https://en.wikipedia.org/wiki/Fisher-Tippett-Gnedenko_theorem</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># weibull_min.pdf(x, c) = c * x**(c-1) * exp(-x**c)</span>
        <span class="k">return</span> <span class="n">c</span><span class="o">*</span><span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">),</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">_EULER</span> <span class="o">/</span> <span class="n">c</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">_EULER</span> <span class="o">+</span> <span class="mi">1</span>


<span class="n">weibull_min</span> <span class="o">=</span> <span class="n">weibull_min_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;weibull_min&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">weibull_max_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Weibull maximum continuous random variable.</span>

<span class="sd">    The Weibull Maximum Extreme Value distribution, from extreme value theory</span>
<span class="sd">    (Fisher-Gnedenko theorem), is the limiting distribution of rescaled</span>
<span class="sd">    maximum of iid random variables. This is the distribution of -X</span>
<span class="sd">    if X is from the `weibull_min` function.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    weibull_min</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `weibull_max` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = c (-x)^{c-1} \exp(-(-x)^c)</span>

<span class="sd">    for :math:`x &lt; 0`, :math:`c &gt; 0`.</span>

<span class="sd">    `weibull_max` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    https://en.wikipedia.org/wiki/Weibull_distribution</span>

<span class="sd">    https://en.wikipedia.org/wiki/Fisher-Tippett-Gnedenko_theorem</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># weibull_max.pdf(x, c) = c * (-x)**(c-1) * exp(-(-x)**c)</span>
        <span class="k">return</span> <span class="n">c</span><span class="o">*</span><span class="nb">pow</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="nb">pow</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">sgn</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sgn</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">sgn</span> <span class="o">*</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">_EULER</span> <span class="o">/</span> <span class="n">c</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">_EULER</span> <span class="o">+</span> <span class="mi">1</span>


<span class="n">weibull_max</span> <span class="o">=</span> <span class="n">weibull_max_gen</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;weibull_max&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">genlogistic_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A generalized logistic continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `genlogistic` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = c \frac{\exp(-x)}</span>
<span class="sd">                         {(1 + \exp(-x))^{c+1}}</span>

<span class="sd">    for :math:`x &gt;= 0`, :math:`c &gt; 0`.</span>

<span class="sd">    `genlogistic` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># genlogistic.pdf(x, c) = c * exp(-x) / (1 + exp(-x))**(c+1)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># Two mathematically equivalent expressions for log(pdf(x, c)):</span>
        <span class="c1">#     log(pdf(x, c)) = log(c) - x - (c + 1)*log(1 + exp(-x))</span>
        <span class="c1">#                    = log(c) + c*x - (c + 1)*log(1 + exp(x))</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">absx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">mult</span><span class="o">*</span><span class="n">absx</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">absx</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">Cx</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Cx</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vals</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">_EULER</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">6.0</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">zeta</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">zeta</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">_ZETA3</span>
        <span class="n">g1</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">mu2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">4</span><span class="o">/</span><span class="mf">15.0</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">zeta</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">/=</span> <span class="n">mu2</span><span class="o">**</span><span class="mf">2.0</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>


<span class="n">genlogistic</span> <span class="o">=</span> <span class="n">genlogistic_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;genlogistic&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">genpareto_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A generalized Pareto continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `genpareto` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = (1 + c x)^{-1 - 1/c}</span>

<span class="sd">    defined for :math:`x \ge 0` if :math:`c \ge 0`, and for</span>
<span class="sd">    :math:`0 \le x \le -1/c` if :math:`c &lt; 0`.</span>

<span class="sd">    `genpareto` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    For :math:`c=0`, `genpareto` reduces to the exponential</span>
<span class="sd">    distribution, `expon`:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, 0) = \exp(-x)</span>

<span class="sd">    For :math:`c=-1`, `genpareto` is uniform on ``[0, 1]``:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, -1) = 1</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_support</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="p">,),</span>
                       <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">c</span><span class="p">,</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># genpareto.pdf(x, c) = (1 + c * x)**(-1 - 1/c)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">((</span><span class="n">x</span> <span class="o">==</span> <span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span>
                          <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">xlog1py</span><span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">c</span><span class="p">,</span>
                          <span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">inv_boxcox1p</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">inv_boxcox</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">((</span><span class="n">x</span> <span class="o">==</span> <span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span>
                          <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">c</span><span class="p">,</span>
                          <span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">boxcox1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">boxcox</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">moments</span><span class="o">=</span><span class="s1">&#39;mv&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;m&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="p">,),</span>
                           <span class="k">lambda</span> <span class="n">xi</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">xi</span><span class="p">),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;v&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="p">,),</span>
                           <span class="k">lambda</span> <span class="n">xi</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">xi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">xi</span><span class="p">),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;s&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="p">,),</span>
                           <span class="k">lambda</span> <span class="n">xi</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">xi</span><span class="p">)</span> <span class="o">/</span>
                                      <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">xi</span><span class="p">),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;k&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="p">,),</span>
                           <span class="k">lambda</span> <span class="n">xi</span><span class="p">:</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">xi</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">xi</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span>
                                      <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">xi</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">xi</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">k</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">__munp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ki</span><span class="p">,</span> <span class="n">cnk</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">sc</span><span class="o">.</span><span class="n">comb</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">)):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">val</span> <span class="o">+</span> <span class="n">cnk</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">ki</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">c</span> <span class="o">*</span> <span class="n">ki</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">val</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">c</span><span class="p">)</span> <span class="o">**</span> <span class="n">n</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="p">,),</span>
                          <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">__munp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span>
                          <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.</span> <span class="o">+</span> <span class="n">c</span>


<span class="n">genpareto</span> <span class="o">=</span> <span class="n">genpareto_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;genpareto&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">genexpon_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A generalized exponential continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `genexpon` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a, b, c) = (a + b (1 - \exp(-c x)))</span>
<span class="sd">                        \exp(-a x - b x + \frac{b}{c}  (1-\exp(-c x)))</span>

<span class="sd">    for :math:`x \ge 0`, :math:`a, b, c &gt; 0`.</span>

<span class="sd">    `genexpon` takes :math:`a`, :math:`b` and :math:`c` as shape parameters.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    H.K. Ryu, &quot;An Extension of Marshall and Olkin&#39;s Bivariate Exponential</span>
<span class="sd">    Distribution&quot;, Journal of the American Statistical Association, 1993.</span>

<span class="sd">    N. Balakrishnan, &quot;The Exponential Distribution: Theory, Methods and</span>
<span class="sd">    Applications&quot;, Asit P. Basu.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># genexpon.pdf(x, a, b, c) = (a + b * (1 - exp(-c*x))) * \</span>
        <span class="c1">#                            exp(-a*x - b*x + b/c * (1-exp(-c*x)))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">)))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="o">-</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span>
                                                <span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">))</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">)))</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">))</span><span class="o">/</span><span class="n">c</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">((</span><span class="o">-</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">))</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="o">-</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">))</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>


<span class="n">genexpon</span> <span class="o">=</span> <span class="n">genexpon_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;genexpon&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">genextreme_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A generalized extreme value continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    gumbel_r</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    For :math:`c=0`, `genextreme` is equal to `gumbel_r`.</span>
<span class="sd">    The probability density function for `genextreme` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = \begin{cases}</span>
<span class="sd">                    \exp(-\exp(-x)) \exp(-x)              &amp;\text{for } c = 0\\</span>
<span class="sd">                    \exp(-(1-c x)^{1/c}) (1-c x)^{1/c-1}  &amp;\text{for }</span>
<span class="sd">                                                            x \le 1/c, c &gt; 0</span>
<span class="sd">                  \end{cases}</span>


<span class="sd">    Note that several sources and software packages use the opposite</span>
<span class="sd">    convention for the sign of the shape parameter :math:`c`.</span>

<span class="sd">    `genextreme` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_support</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">_XMIN</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="n">_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">_XMIN</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span>

    <span class="k">def</span> <span class="nf">_loglogcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">((</span><span class="n">x</span> <span class="o">==</span> <span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span>
                          <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># genextreme.pdf(x, c) =</span>
        <span class="c1">#     exp(-exp(-x))*exp(-x),                    for c==0</span>
        <span class="c1">#     exp(-(1-c*x)**(1/c))*(1-c*x)**(1/c-1),    for x \le 1/c, c &gt; 0</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">cx</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">((</span><span class="n">x</span> <span class="o">==</span> <span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">logex2</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">cx</span><span class="p">)</span>
        <span class="n">logpex2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loglogcdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="n">pex2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logpex2</span><span class="p">)</span>
        <span class="c1"># Handle special cases</span>
        <span class="n">np</span><span class="o">.</span><span class="n">putmask</span><span class="p">(</span><span class="n">logpex2</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">logpdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">cx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">cx</span> <span class="o">==</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span>
                          <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span>
                          <span class="o">-</span><span class="n">pex2</span><span class="o">+</span><span class="n">logpex2</span><span class="o">-</span><span class="n">logex2</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">putmask</span><span class="p">(</span><span class="n">logpdf</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">logpdf</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loglogcdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logcdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logcdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">((</span><span class="n">x</span> <span class="o">==</span> <span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span>
                          <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">c</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">((</span><span class="n">x</span> <span class="o">==</span> <span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span>
                          <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">c</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">g3</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">g4</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">g2mg12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-7</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0</span><span class="o">/</span><span class="mf">6.0</span><span class="p">,</span> <span class="n">g2</span><span class="o">-</span><span class="n">g1</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="n">gam2k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-7</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mf">2.0</span><span class="o">/</span><span class="mf">6.0</span><span class="p">,</span>
                         <span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">c</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">))</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-14</span>
        <span class="n">gamk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">,</span> <span class="o">-</span><span class="n">_EULER</span><span class="p">,</span> <span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

        <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="o">-</span><span class="n">gamk</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">g1</span><span class="o">**</span><span class="mf">2.0</span><span class="o">*</span><span class="n">gam2k</span><span class="p">)</span>

        <span class="c1"># skewness</span>
        <span class="n">sk1</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span>
                         <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g3</span><span class="p">,</span> <span class="n">g2mg12</span><span class="p">),</span>
                         <span class="k">lambda</span> <span class="n">c</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g3</span><span class="p">,</span> <span class="n">g2gm12</span><span class="p">:</span>
                             <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">g3</span> <span class="o">+</span> <span class="p">(</span><span class="n">g2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">g2mg12</span><span class="p">)</span><span class="o">*</span><span class="n">g1</span><span class="p">)</span><span class="o">/</span><span class="n">g2mg12</span><span class="o">**</span><span class="mf">1.5</span><span class="p">,</span>
                         <span class="n">fillvalue</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">sk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">eps</span><span class="o">**</span><span class="mf">0.29</span><span class="p">,</span> <span class="mi">12</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="n">_ZETA3</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">sk1</span><span class="p">)</span>

        <span class="c1"># kurtosis</span>
        <span class="n">ku1</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span>
                         <span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g3</span><span class="p">,</span> <span class="n">g4</span><span class="p">,</span> <span class="n">g2mg12</span><span class="p">),</span>
                         <span class="k">lambda</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g3</span><span class="p">,</span> <span class="n">g4</span><span class="p">,</span> <span class="n">g2mg12</span><span class="p">:</span>
                             <span class="p">(</span><span class="n">g4</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">g3</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">g2</span> <span class="o">+</span> <span class="n">g2mg12</span><span class="p">)</span><span class="o">*</span><span class="n">g1</span><span class="p">)</span><span class="o">*</span><span class="n">g1</span><span class="p">)</span><span class="o">/</span><span class="n">g2mg12</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
                         <span class="n">fillvalue</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">ku</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">eps</span><span class="p">)</span><span class="o">**</span><span class="mf">0.23</span><span class="p">,</span> <span class="mf">12.0</span><span class="o">/</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">ku1</span><span class="o">-</span><span class="mf">3.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">sk</span><span class="p">,</span> <span class="n">ku</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># This is better than the default shape of (1,).</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">_skew</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">g</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_fitstart</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,))</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="n">sc</span><span class="o">.</span><span class="n">comb</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">k</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">n</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_EULER</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>


<span class="n">genextreme</span> <span class="o">=</span> <span class="n">genextreme_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;genextreme&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_digammainv</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Inverse of the digamma function (real positive arguments only).</span>

<span class="sd">    This function is used in the `fit` method of `gamma_gen`.</span>
<span class="sd">    The function uses either optimize.fsolve or optimize.newton</span>
<span class="sd">    to solve `sc.digamma(x) - y = 0`.  There is probably room for</span>
<span class="sd">    improvement, but currently it works over a wide range of y:</span>

<span class="sd">    &gt;&gt;&gt; rng = np.random.default_rng()</span>
<span class="sd">    &gt;&gt;&gt; y = 64*rng.standard_normal(1000000)</span>
<span class="sd">    &gt;&gt;&gt; y.min(), y.max()</span>
<span class="sd">    (-311.43592651416662, 351.77388222276869)</span>
<span class="sd">    &gt;&gt;&gt; x = [_digammainv(t) for t in y]</span>
<span class="sd">    &gt;&gt;&gt; np.abs(sc.digamma(x) - y).max()</span>
<span class="sd">    1.1368683772161603e-13</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_em</span> <span class="o">=</span> <span class="mf">0.5772156649015328606065120</span>
    <span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">digamma</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span>
    <span class="k">if</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">0.125</span><span class="p">:</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="c1"># Some experimentation shows that newton reliably converges</span>
            <span class="c1"># must faster than fsolve in this y range.  For larger y,</span>
            <span class="c1"># newton sometimes fails to converge.</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">newton</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">value</span>
    <span class="k">elif</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">y</span><span class="o">/</span><span class="mf">2.332</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.08661</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="o">-</span><span class="n">y</span> <span class="o">-</span> <span class="n">_em</span><span class="p">)</span>

    <span class="n">value</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">ier</span><span class="p">,</span> <span class="n">mesg</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">fsolve</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="mf">1e-11</span><span class="p">,</span>
                                             <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ier</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;_digammainv: fsolve failed, y = </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">y</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


<span class="c1">## Gamma (Use MATLAB and MATHEMATICA (b=theta=scale, a=alpha=shape) definition)</span>

<span class="c1">## gamma(a, loc, scale)  with a an integer is the Erlang distribution</span>
<span class="c1">## gamma(1, loc, scale)  is the Exponential distribution</span>
<span class="c1">## gamma(df/2, 0, 2) is the chi2 distribution with df degrees of freedom.</span>

<span class="k">class</span> <span class="nc">gamma_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A gamma continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    erlang, expon</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `gamma` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a) = \frac{x^{a-1} e^{-x}}{\Gamma(a)}</span>

<span class="sd">    for :math:`x \ge 0`, :math:`a &gt; 0`. Here :math:`\Gamma(a)` refers to the</span>
<span class="sd">    gamma function.</span>

<span class="sd">    `gamma` takes ``a`` as a shape parameter for :math:`a`.</span>

<span class="sd">    When :math:`a` is an integer, `gamma` reduces to the Erlang</span>
<span class="sd">    distribution, and when :math:`a=1` to the exponential distribution.</span>

<span class="sd">    Gamma distributions are sometimes parameterized with two variables,</span>
<span class="sd">    with a probability density function of:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, \alpha, \beta) = \frac{\beta^\alpha x^{\alpha - 1} e^{-\beta x }}{\Gamma(\alpha)}</span>

<span class="sd">    Note that this parameterization is equivalent to the above, with</span>
<span class="sd">    ``scale = 1 / beta``.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">standard_gamma</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="c1"># gamma.pdf(x, a) = x**(a-1) * exp(-x) / gamma(a)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainccinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="mf">6.0</span><span class="o">/</span><span class="n">a</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># The skewness of the gamma distribution is `2 / np.sqrt(a)`.</span>
        <span class="c1"># We invert that to estimate the shape `a` using the skewness</span>
        <span class="c1"># of the data.  The formula is regularized with 1e-8 in the</span>
        <span class="c1"># denominator to allow for degenerate data where the skewness</span>
        <span class="c1"># is close to 0.</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1e-8</span> <span class="o">+</span> <span class="n">_skew</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_fitstart</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,))</span>

    <span class="nd">@extend_notes_in_docstring</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">        When the location is fixed by using the argument `floc`</span>
<span class="s2">        and `method=&#39;MLE&#39;`, this</span>
<span class="s2">        function uses explicit formulas or solves a simpler numerical</span>
<span class="s2">        problem than the full ML optimization problem.  So in that case,</span>
<span class="s2">        the `optimizer`, `loc` and `scale` arguments are ignored.</span>
<span class="s2">        </span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">floc</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;floc&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;mle&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;mm&#39;</span><span class="p">:</span>
            <span class="c1"># loc is not fixed.  Use the default fit method.</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="c1"># We already have this value, so just pop it from kwds.</span>
        <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;floc&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">f0</span> <span class="o">=</span> <span class="n">_get_fixed_fit_value</span><span class="p">(</span><span class="n">kwds</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;f0&#39;</span><span class="p">,</span> <span class="s1">&#39;fa&#39;</span><span class="p">,</span> <span class="s1">&#39;fix_a&#39;</span><span class="p">])</span>
        <span class="n">fscale</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fscale&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">_remove_optimizer_parameters</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span>

        <span class="c1"># Special case: loc is fixed.</span>

        <span class="k">if</span> <span class="n">f0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># This check is for consistency with `rv_continuous.fit`.</span>
            <span class="c1"># Without this check, this function would just return the</span>
            <span class="c1"># parameters that were given.</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All parameters fixed. There is nothing to &quot;</span>
                             <span class="s2">&quot;optimize.&quot;</span><span class="p">)</span>

        <span class="c1"># Fixed location is handled by shifting the data.</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;The data contains non-finite values.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">data</span> <span class="o">&lt;=</span> <span class="n">floc</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">FitDataError</span><span class="p">(</span><span class="s2">&quot;gamma&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="n">floc</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">floc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Don&#39;t do the subtraction in-place, because `data` might be a</span>
            <span class="c1"># view of the input array.</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">floc</span>
        <span class="n">xbar</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="c1"># Three cases to handle:</span>
        <span class="c1"># * shape and scale both free</span>
        <span class="c1"># * shape fixed, scale free</span>
        <span class="c1"># * shape free, scale fixed</span>

        <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># scale is free</span>
            <span class="k">if</span> <span class="n">f0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># shape is fixed</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">f0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># shape and scale are both free.</span>
                <span class="c1"># The MLE for the shape parameter `a` is the solution to:</span>
                <span class="c1"># np.log(a) - sc.digamma(a) - np.log(xbar) +</span>
                <span class="c1">#                             np.log(data).mean() = 0</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">xbar</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">digamma</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">s</span>
                <span class="n">aest</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="n">s</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">s</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">24</span><span class="o">*</span><span class="n">s</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">12</span><span class="o">*</span><span class="n">s</span><span class="p">)</span>
                <span class="n">xa</span> <span class="o">=</span> <span class="n">aest</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">0.4</span><span class="p">)</span>
                <span class="n">xb</span> <span class="o">=</span> <span class="n">aest</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mf">0.4</span><span class="p">)</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">brentq</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">xb</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># The MLE for the scale parameter is just the data mean</span>
            <span class="c1"># divided by the shape parameter.</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">xbar</span> <span class="o">/</span> <span class="n">a</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># scale is fixed, shape is free</span>
            <span class="c1"># The MLE for the shape parameter `a` is the solution to:</span>
            <span class="c1"># sc.digamma(a) - np.log(data).mean() + np.log(fscale) = 0</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">fscale</span><span class="p">)</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">_digammainv</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">fscale</span>

        <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">scale</span>


<span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;gamma&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">erlang_gen</span><span class="p">(</span><span class="n">gamma_gen</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An Erlang continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    gamma</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The Erlang distribution is a special case of the Gamma distribution, with</span>
<span class="sd">    the shape parameter `a` an integer.  Note that this restriction is not</span>
<span class="sd">    enforced by `erlang`. It will, however, generate a warning the first time</span>
<span class="sd">    a non-integer value is used for the shape parameter.</span>

<span class="sd">    Refer to `gamma` for examples.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="n">allint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">allint</span><span class="p">:</span>
            <span class="c1"># An Erlang distribution shouldn&#39;t really have a non-integer</span>
            <span class="c1"># shape parameter, so warn the user.</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s1">&#39;The shape parameter of the erlang distribution &#39;</span>
                <span class="s1">&#39;has been given a non-integer value </span><span class="si">%r</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">,),</span>
                <span class="ne">RuntimeWarning</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># Override gamma_gen_fitstart so that an integer initial value is</span>
        <span class="c1"># used.  (Also regularize the division, to avoid issues when</span>
        <span class="c1"># _skew(data) is 0 or close to 0.)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">4.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1e-8</span> <span class="o">+</span> <span class="n">_skew</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">gamma_gen</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_fitstart</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,))</span>

    <span class="c1"># Trivial override of the fit method, so we can monkey-patch its</span>
    <span class="c1"># docstring.</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fit</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">:</span>
        <span class="n">fit</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="p">(</span><span class="n">rv_continuous</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">+</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Notes</span>
<span class="sd">            -----</span>
<span class="sd">            The Erlang distribution is generally defined to have integer values</span>
<span class="sd">            for the shape parameter.  This is not enforced by the `erlang` class.</span>
<span class="sd">            When fitting the distribution, it will generally return a non-integer</span>
<span class="sd">            value for the shape parameter.  By using the keyword argument</span>
<span class="sd">            `f0=&lt;integer&gt;`, the fit method can be constrained to fit the data to</span>
<span class="sd">            a specific integer shape parameter.</span>
<span class="sd">            &quot;&quot;&quot;</span><span class="p">)</span>


<span class="n">erlang</span> <span class="o">=</span> <span class="n">erlang_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;erlang&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">gengamma_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A generalized gamma continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    gamma, invgamma, weibull_min</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `gengamma` is ([1]_):</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a, c) = \frac{|c| x^{c a-1} \exp(-x^c)}{\Gamma(a)}</span>

<span class="sd">    for :math:`x \ge 0`, :math:`a &gt; 0`, and :math:`c \ne 0`.</span>
<span class="sd">    :math:`\Gamma` is the gamma function (`scipy.special.gamma`).</span>

<span class="sd">    `gengamma` takes :math:`a` and :math:`c` as shape parameters.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] E.W. Stacy, &quot;A Generalization of the Gamma Distribution&quot;,</span>
<span class="sd">       Annals of Mathematical Statistics, Vol 33(3), pp. 1187--1192.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="n">c</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">xc</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="n">c</span>
        <span class="n">val1</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">xc</span><span class="p">)</span>
        <span class="n">val2</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">xc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">standard_gamma</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">xc</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="n">c</span>
        <span class="n">val1</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">xc</span><span class="p">)</span>
        <span class="n">val2</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">xc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">val2</span><span class="p">,</span> <span class="n">val1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">val1</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
        <span class="n">val2</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainccinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">val1</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
        <span class="n">val2</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainccinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">val2</span><span class="p">,</span> <span class="n">val1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># Pochhammer symbol: sc.pocha,n) = gamma(a+n)/gamma(a)</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">poch</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">n</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">val</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="o">*</span><span class="n">val</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>


<span class="n">gengamma</span> <span class="o">=</span> <span class="n">gengamma_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;gengamma&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">genhalflogistic_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A generalized half-logistic continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `genhalflogistic` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = \frac{2 (1 - c x)^{1/(c-1)}}{[1 + (1 - c x)^{1/c}]^2}</span>

<span class="sd">    for :math:`0 \le x \le 1/c`, and :math:`c &gt; 0`.</span>

<span class="sd">    `genhalflogistic` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_get_support</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">c</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># genhalflogistic.pdf(x, c) =</span>
        <span class="c1">#    2 * (1-c*x)**(1/c-1) / (1+(1-c*x)**(1/c))**2</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">c</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
        <span class="n">tmp0</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">**</span><span class="p">(</span><span class="n">limit</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">tmp2</span> <span class="o">=</span> <span class="n">tmp0</span><span class="o">*</span><span class="n">tmp</span>
        <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">tmp0</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">tmp2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">c</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
        <span class="n">tmp2</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">**</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">tmp2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">tmp2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">((</span><span class="mf">1.0</span><span class="o">-</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


<span class="n">genhalflogistic</span> <span class="o">=</span> <span class="n">genhalflogistic_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;genhalflogistic&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">genhyperbolic_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A generalized hyperbolic continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    t, norminvgauss, geninvgauss, laplace, cauchy</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `genhyperbolic` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, p, a, b) =</span>
<span class="sd">            \frac{(a^2 - b^2)^{p/2}}</span>
<span class="sd">            {\sqrt{2\pi}a^{p-0.5}</span>
<span class="sd">            K_p\Big(\sqrt{a^2 - b^2}\Big)}</span>
<span class="sd">            e^{bx} \times \frac{K_{p - 1/2}</span>
<span class="sd">            (a \sqrt{1 + x^2})}</span>
<span class="sd">            {(\sqrt{1 + x^2})^{1/2 - p}}</span>

<span class="sd">    for :math:`x, p \in ( - \infty; \infty)`,</span>
<span class="sd">    :math:`|b| &lt; a` if :math:`p \ge 0`,</span>
<span class="sd">    :math:`|b| \le a` if :math:`p &lt; 0`.</span>
<span class="sd">    :math:`K_{p}(.)` denotes the modified Bessel function of the second</span>
<span class="sd">    kind and order :math:`p` (`scipy.special.kn`)</span>

<span class="sd">    `genhyperbolic` takes ``p`` as a tail parameter,</span>
<span class="sd">    ``a`` as a shape parameter,</span>
<span class="sd">    ``b`` as a skewness parameter.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    The original parameterization of the Generalized Hyperbolic Distribution</span>
<span class="sd">    is found in [1]_ as follows</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, \lambda, \alpha, \beta, \delta, \mu) =</span>
<span class="sd">           \frac{(\gamma/\delta)^\lambda}{\sqrt{2\pi}K_\lambda(\delta \gamma)}</span>
<span class="sd">           e^{\beta (x - \mu)} \times \frac{K_{\lambda - 1/2}</span>
<span class="sd">           (\alpha \sqrt{\delta^2 + (x - \mu)^2})}</span>
<span class="sd">           {(\sqrt{\delta^2 + (x - \mu)^2} / \alpha)^{1/2 - \lambda}}</span>

<span class="sd">    for :math:`x \in ( - \infty; \infty)`,</span>
<span class="sd">    :math:`\gamma := \sqrt{\alpha^2 - \beta^2}`,</span>
<span class="sd">    :math:`\lambda, \mu \in ( - \infty; \infty)`,</span>
<span class="sd">    :math:`\delta \ge 0, |\beta| &lt; \alpha` if :math:`\lambda \ge 0`,</span>
<span class="sd">    :math:`\delta &gt; 0, |\beta| \le \alpha` if :math:`\lambda &lt; 0`.</span>

<span class="sd">    The location-scale-based parameterization implemented in</span>
<span class="sd">    SciPy is based on [2]_, where :math:`a = \alpha\delta`,</span>
<span class="sd">    :math:`b = \beta\delta`, :math:`p = \lambda`,</span>
<span class="sd">    :math:`scale=\delta` and :math:`loc=\mu`</span>

<span class="sd">    Moments are implemented based on [3]_ and [4]_.</span>

<span class="sd">    For the distributions that are a special case such as Student&#39;s t,</span>
<span class="sd">    it is not recommended to rely on the implementation of genhyperbolic.</span>
<span class="sd">    To avoid potential numerical problems and for performance reasons,</span>
<span class="sd">    the methods of the specific distributions should be used.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] O. Barndorff-Nielsen, &quot;Hyperbolic Distributions and Distributions</span>
<span class="sd">       on Hyperbolae&quot;, Scandinavian Journal of Statistics, Vol. 5(3),</span>
<span class="sd">       pp. 151-157, 1978. https://www.jstor.org/stable/4615705</span>

<span class="sd">    .. [2] Eberlein E., Prause K. (2002) The Generalized Hyperbolic Model:</span>
<span class="sd">        Financial Derivatives and Risk Measures. In: Geman H., Madan D.,</span>
<span class="sd">        Pliska S.R., Vorst T. (eds) Mathematical Finance - Bachelier</span>
<span class="sd">        Congress 2000. Springer Finance. Springer, Berlin, Heidelberg.</span>
<span class="sd">        :doi:`10.1007/978-3-662-12429-1_12`</span>

<span class="sd">    .. [3] Scott, David J, Würtz, Diethelm, Dong, Christine and Tran,</span>
<span class="sd">       Thanh Tam, (2009), Moments of the generalized hyperbolic</span>
<span class="sd">       distribution, MPRA Paper, University Library of Munich, Germany,</span>
<span class="sd">       https://EconPapers.repec.org/RePEc:pra:mprapa:19081.</span>

<span class="sd">    .. [4] E. Eberlein and E. A. von Hammerstein. Generalized hyperbolic</span>
<span class="sd">       and inverse Gaussian distributions: Limiting cases and approximation</span>
<span class="sd">       of processes. FDM Preprint 80, April 2003. University of Freiburg.</span>
<span class="sd">       https://freidok.uni-freiburg.de/fedora/objects/freidok:7974/datastreams/FILE1/content</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># kve instead of kv works better for large values of p</span>
        <span class="c1"># and smaller values of sqrt(a^2  - b^2)</span>
        <span class="nd">@np</span><span class="o">.</span><span class="n">vectorize</span>
        <span class="k">def</span> <span class="nf">_logpdf_single</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_stats</span><span class="o">.</span><span class="n">genhyperbolic_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_logpdf_single</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># kve instead of kv works better for large values of p</span>
        <span class="c1"># and smaller values of sqrt(a^2  - b^2)</span>
        <span class="nd">@np</span><span class="o">.</span><span class="n">vectorize</span>
        <span class="k">def</span> <span class="nf">_pdf_single</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_stats</span><span class="o">.</span><span class="n">genhyperbolic_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_pdf_single</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>

        <span class="nd">@np</span><span class="o">.</span><span class="n">vectorize</span>
        <span class="k">def</span> <span class="nf">_cdf_single</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
            <span class="n">user_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span> <span class="nb">float</span>
                <span class="p">)</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">)</span>
            <span class="n">llc</span> <span class="o">=</span> <span class="n">LowLevelCallable</span><span class="o">.</span><span class="n">from_cython</span><span class="p">(</span>
                <span class="n">_stats</span><span class="p">,</span> <span class="s1">&#39;_genhyperbolic_pdf&#39;</span><span class="p">,</span> <span class="n">user_data</span>
                <span class="p">)</span>

            <span class="n">t1</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">llc</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">t1</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Infinite values encountered in scipy.special.kve. &quot;</span>
                       <span class="s2">&quot;Values replaced by NaN to avoid incorrect results.&quot;</span><span class="p">)</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">t1</span>

        <span class="k">return</span> <span class="n">_cdf_single</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># note: X = b * V + sqrt(V) * X  has a</span>
        <span class="c1"># generalized hyperbolic distribution</span>
        <span class="c1"># if X is standard normal and V is</span>
        <span class="c1"># geninvgauss(p = p, b = t2, loc = loc, scale = t3)</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c1"># b in the GIG</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="c1"># scale in the GIG</span>
        <span class="n">t3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">gig</span> <span class="o">=</span> <span class="n">geninvgauss</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span>
            <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span>
            <span class="n">b</span><span class="o">=</span><span class="n">t2</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">t3</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
            <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span>
            <span class="p">)</span>
        <span class="n">normst</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">b</span> <span class="o">*</span> <span class="n">gig</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">gig</span><span class="p">)</span> <span class="o">*</span> <span class="n">normst</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># https://mpra.ub.uni-muenchen.de/19081/1/MPRA_paper_19081.pdf</span>
        <span class="c1"># https://freidok.uni-freiburg.de/fedora/objects/freidok:7974/datastreams/FILE1/content</span>
        <span class="c1"># standardized moments</span>
        <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">integers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="c1"># make integers perpendicular to existing dimensions</span>
        <span class="n">integers</span> <span class="o">=</span> <span class="n">integers</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">integers</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
        <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">b3</span><span class="p">,</span> <span class="n">b4</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">integers</span><span class="p">,</span> <span class="n">t1</span><span class="p">)</span>
        <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">r3</span><span class="p">,</span> <span class="n">r4</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span> <span class="o">/</span> <span class="n">b0</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">b3</span><span class="p">,</span> <span class="n">b4</span><span class="p">)]</span>

        <span class="n">m</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">t2</span> <span class="o">*</span> <span class="n">r1</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">t2</span> <span class="o">*</span> <span class="n">r1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span>
            <span class="p">(</span><span class="n">r2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">m3e</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span>
            <span class="p">(</span><span class="n">r3</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">b2</span> <span class="o">*</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">b0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
             <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">+</span>
            <span class="mi">3</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span>
            <span class="p">(</span><span class="n">r2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">m3e</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">m4e</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span>
            <span class="p">(</span><span class="n">r4</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">b3</span> <span class="o">*</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">b0</span><span class="p">,</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
             <span class="mi">6</span> <span class="o">*</span> <span class="n">b2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">b0</span><span class="p">,</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span>
             <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="o">+</span>
            <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span>
            <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">r3</span> <span class="o">-</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">b2</span> <span class="o">*</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">b0</span><span class="p">,</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
             <span class="mi">6</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">+</span>
            <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">r2</span>
        <span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">m4e</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span>

        <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">k</span>


<span class="n">genhyperbolic</span> <span class="o">=</span> <span class="n">genhyperbolic_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;genhyperbolic&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">gompertz_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Gompertz (or truncated Gumbel) continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `gompertz` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = c \exp(x) \exp(-c (e^x-1))</span>

<span class="sd">    for :math:`x \ge 0`, :math:`c &gt; 0`.</span>

<span class="sd">    `gompertz` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># gompertz.pdf(x, c) = c * exp(x) * exp(-c*(exp(x)-1))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span> <span class="o">-</span> <span class="n">c</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">c</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">c</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">expn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>


<span class="n">gompertz</span> <span class="o">=</span> <span class="n">gompertz_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;gompertz&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_average_with_log_weights</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">logweights</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">logweights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">logweights</span><span class="p">)</span>
    <span class="n">maxlogw</span> <span class="o">=</span> <span class="n">logweights</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logweights</span> <span class="o">-</span> <span class="n">maxlogw</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">gumbel_r_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A right-skewed Gumbel continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    gumbel_l, gompertz, genextreme</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `gumbel_r` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \exp(-(x + e^{-x}))</span>

<span class="sd">    The Gumbel distribution is sometimes referred to as a type I Fisher-Tippett</span>
<span class="sd">    distribution.  It is also related to the extreme value distribution,</span>
<span class="sd">    log-Weibull and Gompertz distributions.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># gumbel_r.pdf(x) = exp(-(x + exp(-x)))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_EULER</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">6.0</span><span class="p">,</span> <span class="mi">12</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">_ZETA3</span><span class="p">,</span> <span class="mf">12.0</span><span class="o">/</span><span class="mi">5</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># https://en.wikipedia.org/wiki/Gumbel_distribution</span>
        <span class="k">return</span> <span class="n">_EULER</span> <span class="o">+</span> <span class="mf">1.</span>

    <span class="nd">@_call_super_mom</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span> <span class="o">=</span> <span class="n">_check_fit_input_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
                                                         <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

        <span class="c1"># if user has provided `floc` or `fscale`, fall back on super fit</span>
        <span class="c1"># method. This scenario is not suitable for solving a system of</span>
        <span class="c1"># equations</span>
        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="c1"># rv_continuous provided guesses</span>
        <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fitstart</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="c1"># account for user provided guesses</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="p">)</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>

        <span class="c1"># By the method of maximum likelihood, the estimators of the</span>
        <span class="c1"># location and scale are the roots of the equation defined in</span>
        <span class="c1"># `func` and the value of the expression for `loc` that follows.</span>
        <span class="c1"># Source: Statistical Distributions, 3rd Edition. Evans, Hastings,</span>
        <span class="c1"># and Peacock (2000), Page 101</span>

        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="n">sdata</span> <span class="o">=</span> <span class="o">-</span><span class="n">data</span> <span class="o">/</span> <span class="n">scale</span>
            <span class="n">wavg</span> <span class="o">=</span> <span class="n">_average_with_log_weights</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">logweights</span><span class="o">=</span><span class="n">sdata</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">wavg</span> <span class="o">-</span> <span class="n">scale</span>

        <span class="n">soln</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">data</span><span class="p">,),</span>
                             <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;xtol&#39;</span><span class="p">:</span> <span class="mf">1e-14</span><span class="p">})</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">soln</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="o">-</span><span class="n">scale</span> <span class="o">*</span> <span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">logsumexp</span><span class="p">(</span><span class="o">-</span><span class="n">data</span><span class="o">/</span><span class="n">scale</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span>


<span class="n">gumbel_r</span> <span class="o">=</span> <span class="n">gumbel_r_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;gumbel_r&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">gumbel_l_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A left-skewed Gumbel continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    gumbel_r, gompertz, genextreme</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `gumbel_l` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \exp(x - e^x)</span>

<span class="sd">    The Gumbel distribution is sometimes referred to as a type I Fisher-Tippett</span>
<span class="sd">    distribution.  It is also related to the extreme value distribution,</span>
<span class="sd">    log-Weibull and Gompertz distributions.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># gumbel_l.pdf(x) = exp(x - exp(x))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">_EULER</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">6.0</span><span class="p">,</span> \
               <span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">_ZETA3</span><span class="p">,</span> <span class="mf">12.0</span><span class="o">/</span><span class="mi">5</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_EULER</span> <span class="o">+</span> <span class="mf">1.</span>

    <span class="nd">@_call_super_mom</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="c1"># The fit method of `gumbel_r` can be used for this distribution with</span>
        <span class="c1"># small modifications. The process to do this is</span>
        <span class="c1"># 1. pass the sign negated data into `gumbel_r.fit`</span>
        <span class="c1"># 2. negate the sign of the resulting location, leaving the scale</span>
        <span class="c1">#    unmodified.</span>
        <span class="c1"># `gumbel_r.fit` holds necessary input checks.</span>

        <span class="n">loc_r</span><span class="p">,</span> <span class="n">scale_r</span><span class="p">,</span> <span class="o">=</span> <span class="n">gumbel_r</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="n">loc_r</span><span class="p">,</span> <span class="n">scale_r</span><span class="p">)</span>


<span class="n">gumbel_l</span> <span class="o">=</span> <span class="n">gumbel_l_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;gumbel_l&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">halfcauchy_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Half-Cauchy continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `halfcauchy` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{2}{\pi (1 + x^2)}</span>

<span class="sd">    for :math:`x \ge 0`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># halfcauchy.pdf(x) = 2 / (pi * (1 + x**2))</span>
        <span class="k">return</span> <span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>


<span class="n">halfcauchy</span> <span class="o">=</span> <span class="n">halfcauchy_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;halfcauchy&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">halflogistic_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A half-logistic continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `halflogistic` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{ 2 e^{-x} }{ (1+e^{-x})^2 }</span>
<span class="sd">             = \frac{1}{2} \text{sech}(x/2)^2</span>

<span class="sd">    for :math:`x \ge 0`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># halflogistic.pdf(x) = 2 * exp(-x) / (1+exp(-x))**2</span>
        <span class="c1">#                     = 1/2 * sech(x/2)**2</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctanh</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">3.0</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">9</span><span class="o">*</span><span class="n">_ZETA3</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">7</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">4</span> <span class="o">/</span> <span class="mf">15.0</span>
        <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">n</span><span class="p">))</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">zeta</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


<span class="n">halflogistic</span> <span class="o">=</span> <span class="n">halflogistic_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;halflogistic&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">halfnorm_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A half-normal continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `halfnorm` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \sqrt{2/\pi} \exp(-x^2 / 2)</span>

<span class="sd">    for :math:`x &gt;= 0`.</span>

<span class="sd">    `halfnorm` is a special case of `chi` with ``df=1``.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">random_state</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># halfnorm.pdf(x) = sqrt(2/pi) * exp(-x**2/2)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="mf">2.0</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mf">1.0</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">ndtri</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
                <span class="mi">1</span><span class="o">-</span><span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">4</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span><span class="p">,</span>
                <span class="mi">8</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span>


<span class="n">halfnorm</span> <span class="o">=</span> <span class="n">halfnorm_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;halfnorm&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">hypsecant_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A hyperbolic secant continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `hypsecant` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{1}{\pi} \text{sech}(x)</span>

<span class="sd">    for a real number :math:`x`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># hypsecant.pdf(x) = 1/pi * sech(x)</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">q</span><span class="o">/</span><span class="mf">2.0</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>


<span class="n">hypsecant</span> <span class="o">=</span> <span class="n">hypsecant_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;hypsecant&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">gausshyper_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Gauss hypergeometric continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `gausshyper` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a, b, c, z) = C x^{a-1} (1-x)^{b-1} (1+zx)^{-c}</span>

<span class="sd">    for :math:`0 \le x \le 1`, :math:`a &gt; 0`, :math:`b &gt; 0`, :math:`z &gt; -1`,</span>
<span class="sd">    and :math:`C = \frac{1}{B(a, b) F[2, 1](c, a; a+b; -z)}`.</span>
<span class="sd">    :math:`F[2, 1]` is the Gauss hypergeometric function</span>
<span class="sd">    `scipy.special.hyp2f1`.</span>

<span class="sd">    `gausshyper` takes :math:`a`, :math:`b`, :math:`c` and :math:`z` as shape</span>
<span class="sd">    parameters.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Armero, C., and M. J. Bayarri. &quot;Prior Assessments for Prediction in</span>
<span class="sd">           Queues.&quot; *Journal of the Royal Statistical Society*. Series D (The</span>
<span class="sd">           Statistician) 43, no. 1 (1994): 139-53. doi:10.2307/2348939</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="c1"># z &gt; -1 per gh-10134</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="n">c</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">z</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="c1"># gausshyper.pdf(x, a, b, c, z) =</span>
        <span class="c1">#   C * x**(a-1) * (1-x)**(b-1) * (1+z*x)**(-c)</span>
        <span class="n">Cinv</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">hyp2f1</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">z</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">Cinv</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">z</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="n">c</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="n">sc</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">hyp2f1</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="o">+</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="n">n</span><span class="p">,</span> <span class="o">-</span><span class="n">z</span><span class="p">)</span>
        <span class="n">den</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">hyp2f1</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">z</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fac</span><span class="o">*</span><span class="n">num</span> <span class="o">/</span> <span class="n">den</span>


<span class="n">gausshyper</span> <span class="o">=</span> <span class="n">gausshyper_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;gausshyper&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">invgamma_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;An inverted gamma continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `invgamma` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a) = \frac{x^{-a-1}}{\Gamma(a)} \exp(-\frac{1}{x})</span>

<span class="sd">    for :math:`x &gt;= 0`, :math:`a &gt; 0`. :math:`\Gamma` is the gamma function</span>
<span class="sd">    (`scipy.special.gamma`).</span>

<span class="sd">    `invgamma` takes ``a`` as a shape parameter for :math:`a`.</span>

<span class="sd">    `invgamma` is a special case of `gengamma` with ``c=-1``, and it is a</span>
<span class="sd">    different parameterization of the scaled inverse chi-squared distribution.</span>
<span class="sd">    Specifically, if the scaled inverse chi-squared distribution is</span>
<span class="sd">    parameterized with degrees of freedom :math:`\nu` and scaling parameter</span>
<span class="sd">    :math:`\tau^2`, then it can be modeled using `invgamma` with</span>
<span class="sd">    ``a=`` :math:`\nu/2` and ``scale=`` :math:`\nu \tau^2/2`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="c1"># invgamma.pdf(x, a) = x**(-a-1) / gamma(a) * exp(-1/x)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">x</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainccinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">moments</span><span class="o">=</span><span class="s1">&#39;mvsk&#39;</span><span class="p">):</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,),</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,),</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

        <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;s&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">g1</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span>
                <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,),</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">4.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">3.</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;k&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">g2</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span>
                <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,),</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">6.</span> <span class="o">*</span> <span class="p">(</span><span class="mf">5.</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">11.</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">3.</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">4.</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>


<span class="n">invgamma</span> <span class="o">=</span> <span class="n">invgamma_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;invgamma&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">invgauss_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;An inverse Gaussian continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `invgauss` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, \mu) = \frac{1}{\sqrt{2 \pi x^3}}</span>
<span class="sd">                    \exp(-\frac{(x-\mu)^2}{2 x \mu^2})</span>

<span class="sd">    for :math:`x &gt;= 0` and :math:`\mu &gt; 0`.</span>

<span class="sd">    `invgauss` takes ``mu`` as a shape parameter for :math:`\mu`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">wald</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="c1"># invgauss.pdf(x, mu) =</span>
        <span class="c1">#                  1 / sqrt(2*pi*x**3) * exp(-(x-mu)**2/(2*x*mu**2))</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mf">3.0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span><span class="o">/</span><span class="n">mu</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span><span class="o">/</span><span class="n">mu</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>

    <span class="c1"># approach adapted from equations in</span>
    <span class="c1"># https://journal.r-project.org/archive/2016-1/giner-smyth.pdf,</span>
    <span class="c1"># not R code. see gh-13616</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">fac</span> <span class="o">*</span> <span class="p">((</span><span class="n">x</span> <span class="o">/</span> <span class="n">mu</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="o">-</span><span class="n">fac</span> <span class="o">*</span> <span class="p">((</span><span class="n">x</span> <span class="o">/</span> <span class="n">mu</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">_norm_logsf</span><span class="p">(</span><span class="n">fac</span> <span class="o">*</span> <span class="p">((</span><span class="n">x</span> <span class="o">/</span> <span class="n">mu</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="o">-</span><span class="n">fac</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">mu</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logsf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logcdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu</span><span class="o">**</span><span class="mf">3.0</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mu</span><span class="p">),</span> <span class="mi">15</span><span class="o">*</span><span class="n">mu</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;mle&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="n">wald_gen</span> <span class="ow">or</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;mm&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="n">data</span><span class="p">,</span> <span class="n">fshape_s</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span> <span class="o">=</span> <span class="n">_check_fit_input_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
                                                                   <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Source: Statistical Distributions, 3rd Edition. Evans, Hastings,</span>
<span class="sd">        and Peacock (2000), Page 121. Their shape parameter is equivilent to</span>
<span class="sd">        SciPy&#39;s with the conversion `fshape_s = fshape / scale`.</span>

<span class="sd">        MLE formulas are not used in 3 condtions:</span>
<span class="sd">        - `loc` is not fixed</span>
<span class="sd">        - `mu` is fixed</span>
<span class="sd">        These cases fall back on the superclass fit method.</span>
<span class="sd">        - `loc` is fixed but translation results in negative data raises</span>
<span class="sd">          a `FitDataError`.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">fshape_s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">floc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">FitDataError</span><span class="p">(</span><span class="s2">&quot;invgauss&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">floc</span>
            <span class="n">fshape_n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fscale</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">data</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span> <span class="n">fshape_n</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">fshape_s</span> <span class="o">=</span> <span class="n">fshape_n</span> <span class="o">/</span> <span class="n">fscale</span>
        <span class="k">return</span> <span class="n">fshape_s</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span>


<span class="n">invgauss</span> <span class="o">=</span> <span class="n">invgauss_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;invgauss&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">geninvgauss_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Generalized Inverse Gaussian continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `geninvgauss` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, p, b) = x^{p-1} \exp(-b (x + 1/x) / 2) / (2 K_p(b))</span>

<span class="sd">    where `x &gt; 0`, and the parameters `p, b` satisfy `b &gt; 0` ([1]_).</span>
<span class="sd">    :math:`K_p` is the modified Bessel function of second kind of order `p`</span>
<span class="sd">    (`scipy.special.kv`).</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    The inverse Gaussian distribution `stats.invgauss(mu)` is a special case of</span>
<span class="sd">    `geninvgauss` with `p = -1/2`, `b = 1 / mu` and `scale = mu`.</span>

<span class="sd">    Generating random variates is challenging for this distribution. The</span>
<span class="sd">    implementation is based on [2]_.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] O. Barndorff-Nielsen, P. Blaesild, C. Halgreen, &quot;First hitting time</span>
<span class="sd">       models for the generalized inverse gaussian distribution&quot;,</span>
<span class="sd">       Stochastic Processes and their Applications 7, pp. 49--54, 1978.</span>

<span class="sd">    .. [2] W. Hoermann and J. Leydold, &quot;Generating generalized inverse Gaussian</span>
<span class="sd">       random variates&quot;, Statistics and Computing, 24(4), p. 547--557, 2014.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="n">p</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># kve instead of kv works better for large values of b</span>
        <span class="c1"># warn if kve produces infinite values and replace by nan</span>
        <span class="c1"># otherwise c = -inf and the results are often incorrect</span>
        <span class="nd">@np</span><span class="o">.</span><span class="n">vectorize</span>
        <span class="k">def</span> <span class="nf">logpdf_single</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_stats</span><span class="o">.</span><span class="n">geninvgauss_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

        <span class="n">z</span> <span class="o">=</span> <span class="n">logpdf_single</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Infinite values encountered in scipy.special.kve(p, b). &quot;</span>
                   <span class="s2">&quot;Values replaced by NaN to avoid incorrect results.&quot;</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">z</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># relying on logpdf avoids overflow of x**(p-1) for large x and p</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_support</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

        <span class="nd">@np</span><span class="o">.</span><span class="n">vectorize</span>
        <span class="k">def</span> <span class="nf">_cdf_single</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="n">p</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">args</span>
            <span class="n">user_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span> <span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">)</span>
            <span class="n">llc</span> <span class="o">=</span> <span class="n">LowLevelCallable</span><span class="o">.</span><span class="n">from_cython</span><span class="p">(</span><span class="n">_stats</span><span class="p">,</span> <span class="s1">&#39;_geninvgauss_pdf&#39;</span><span class="p">,</span>
                                               <span class="n">user_data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">llc</span><span class="p">,</span> <span class="n">_a</span><span class="p">,</span> <span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">_cdf_single</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logquasipdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># log of the quasi-density (w/o normalizing constant) used in _rvs</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span>
                          <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                          <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># if p and b are scalar, use _rvs_scalar, otherwise need to create</span>
        <span class="c1"># output by iterating over parameters</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs_scalar</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs_scalar</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">b</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># When this method is called, size will be a (possibly empty)</span>
            <span class="c1"># tuple of integers.  It will not be None; if `size=None` is passed</span>
            <span class="c1"># to `rvs()`, size will be the empty tuple ().</span>

            <span class="n">p</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="c1"># p and b now have the same shape.</span>

            <span class="c1"># `shp` is the shape of the blocks of random variates that are</span>
            <span class="c1"># generated for each combination of parameters associated with</span>
            <span class="c1"># broadcasting p and b.</span>
            <span class="c1"># bc is a tuple the same lenth as size.  The values</span>
            <span class="c1"># in bc are bools.  If bc[j] is True, it means that</span>
            <span class="c1"># entire axis is filled in for a given combination of the</span>
            <span class="c1"># broadcast arguments.</span>
            <span class="n">shp</span><span class="p">,</span> <span class="n">bc</span> <span class="o">=</span> <span class="n">_check_shape</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

            <span class="c1"># `numsamples` is the total number of variates to be generated</span>
            <span class="c1"># for each combination of the input arguments.</span>
            <span class="n">numsamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shp</span><span class="p">))</span>

            <span class="c1"># `out` is the array to be returned.  It is filled in in the</span>
            <span class="c1"># loop below.</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

            <span class="n">it</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">([</span><span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span>
                           <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;multi_index&#39;</span><span class="p">],</span>
                           <span class="n">op_flags</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;readonly&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;readonly&#39;</span><span class="p">]])</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">it</span><span class="o">.</span><span class="n">finished</span><span class="p">:</span>
                <span class="c1"># Convert the iterator&#39;s multi_index into an index into the</span>
                <span class="c1"># `out` array where the call to _rvs_scalar() will be stored.</span>
                <span class="c1"># Where bc is True, we use a full slice; otherwise we use the</span>
                <span class="c1"># index value from it.multi_index.  len(it.multi_index) might</span>
                <span class="c1"># be less than len(bc), and in that case we want to align these</span>
                <span class="c1"># two sequences to the right, so the loop variable j runs from</span>
                <span class="c1"># -len(size) to 0.  This doesn&#39;t cause an IndexError, as</span>
                <span class="c1"># bc[j] will be True in those cases where it.multi_index[j]</span>
                <span class="c1"># would cause an IndexError.</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">it</span><span class="o">.</span><span class="n">multi_index</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">bc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">else</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
                            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">size</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
                <span class="n">out</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs_scalar</span><span class="p">(</span><span class="n">it</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">it</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">numsamples</span><span class="p">,</span>
                                            <span class="n">random_state</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shp</span><span class="p">)</span>
                <span class="n">it</span><span class="o">.</span><span class="n">iternext</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="p">():</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">_rvs_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">numsamples</span><span class="p">,</span> <span class="n">random_state</span><span class="p">):</span>
        <span class="c1"># following [2], the quasi-pdf is used instead of the pdf for the</span>
        <span class="c1"># generation of rvs</span>
        <span class="n">invert_res</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">numsamples</span><span class="p">):</span>
            <span class="n">numsamples</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># note: if X is geninvgauss(p, b), then 1/X is geninvgauss(-p, b)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="o">-</span><span class="n">p</span>
            <span class="n">invert_res</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

        <span class="c1"># determine method to be used following [2]</span>
        <span class="n">ratio_unif</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># ratio of uniforms with mode shift below</span>
            <span class="n">mode_shift</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">b</span> <span class="o">&gt;=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">):</span>
            <span class="c1"># ratio of uniforms without mode shift below</span>
            <span class="n">mode_shift</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># new algorithm in [2]</span>
            <span class="n">ratio_unif</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># prepare sampling of rvs</span>
        <span class="n">size1d</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">numsamples</span><span class="p">))</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">size1d</span><span class="p">)</span>  <span class="c1"># number of rvs needed, reshape upon return</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="n">simulated</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">ratio_unif</span><span class="p">:</span>
            <span class="c1"># use ratio of uniforms method</span>
            <span class="k">if</span> <span class="n">mode_shift</span><span class="p">:</span>
                <span class="n">a2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span> <span class="o">-</span> <span class="n">m</span>
                <span class="n">a1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="c1"># find roots of x**3 + a2*x**2 + a1*x + m (Cardano&#39;s formula)</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">-</span> <span class="n">a2</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span>
                <span class="n">q1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a2</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="mi">27</span> <span class="o">-</span> <span class="n">a2</span> <span class="o">*</span> <span class="n">a1</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">m</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="o">-</span><span class="n">q1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">27</span> <span class="o">/</span> <span class="n">p1</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">s1</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span> <span class="o">*</span> <span class="n">p1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">root1</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">a2</span> <span class="o">/</span> <span class="mi">3</span>
                <span class="n">root2</span> <span class="o">=</span> <span class="o">-</span><span class="n">s1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">a2</span> <span class="o">/</span> <span class="mi">3</span>
                <span class="c1"># root3 = s1 * np.cos(phi / 3 - np.pi / 3) - a2 / 3</span>

                <span class="c1"># if g is the quasipdf, rescale: g(x) / g(m) which we can write</span>
                <span class="c1"># as exp(log(g(x)) - log(g(m))). This is important</span>
                <span class="c1"># since for large values of p and b, g cannot be evaluated.</span>
                <span class="c1"># denote the rescaled quasipdf by h</span>
                <span class="n">lm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logquasipdf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
                <span class="n">d1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logquasipdf</span><span class="p">(</span><span class="n">root1</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">lm</span>
                <span class="n">d2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logquasipdf</span><span class="p">(</span><span class="n">root2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">lm</span>
                <span class="c1"># compute the bounding rectangle w.r.t. h. Note that</span>
                <span class="c1"># np.exp(0.5*d1) = np.sqrt(g(root1)/g(m)) = np.sqrt(h(root1))</span>
                <span class="n">vmin</span> <span class="o">=</span> <span class="p">(</span><span class="n">root1</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">d1</span><span class="p">)</span>
                <span class="n">vmax</span> <span class="o">=</span> <span class="p">(</span><span class="n">root2</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">d2</span><span class="p">)</span>
                <span class="n">umax</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># umax = sqrt(h(m)) = 1</span>

                <span class="n">logqpdf</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logquasipdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">lm</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">m</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># ratio of uniforms without mode shift</span>
                <span class="c1"># compute np.sqrt(quasipdf(m))</span>
                <span class="n">umax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_logquasipdf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
                <span class="n">xplus</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="n">b</span>
                <span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="c1"># compute xplus * np.sqrt(quasipdf(xplus))</span>
                <span class="n">vmax</span> <span class="o">=</span> <span class="n">xplus</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logquasipdf</span><span class="p">(</span><span class="n">xplus</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
                <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">logqpdf</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logquasipdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">vmin</span> <span class="o">&gt;=</span> <span class="n">vmax</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;vmin must be smaller than vmax.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">umax</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;umax must be positive.&quot;</span><span class="p">)</span>

            <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="n">simulated</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">simulated</span>
                <span class="c1"># simulate uniform rvs on [0, umax] and [vmin, vmax]</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">umax</span> <span class="o">*</span> <span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">vmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">vmax</span> <span class="o">-</span> <span class="n">vmin</span><span class="p">)</span> <span class="o">*</span> <span class="n">v</span>
                <span class="n">rvs</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="n">u</span> <span class="o">+</span> <span class="n">c</span>
                <span class="c1"># rewrite acceptance condition u**2 &lt;= pdf(rvs) by taking logs</span>
                <span class="n">accept</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">logqpdf</span><span class="p">(</span><span class="n">rvs</span><span class="p">))</span>
                <span class="n">num_accept</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">accept</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">num_accept</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">x</span><span class="p">[</span><span class="n">simulated</span><span class="p">:(</span><span class="n">simulated</span> <span class="o">+</span> <span class="n">num_accept</span><span class="p">)]</span> <span class="o">=</span> <span class="n">rvs</span><span class="p">[</span><span class="n">accept</span><span class="p">]</span>
                    <span class="n">simulated</span> <span class="o">+=</span> <span class="n">num_accept</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">simulated</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">N</span> <span class="o">&gt;=</span> <span class="mi">50000</span><span class="p">):</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Not a single random variate could be generated &quot;</span>
                           <span class="s2">&quot;in </span><span class="si">{}</span><span class="s2"> attempts. Sampling does not appear to &quot;</span>
                           <span class="s2">&quot;work for the provided parameters.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">N</span><span class="p">))</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># use new algorithm in [2]</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">b</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span>
            <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">x0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">b</span><span class="p">))</span>
            <span class="n">k1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logquasipdf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
            <span class="n">A1</span> <span class="o">=</span> <span class="n">k1</span> <span class="o">*</span> <span class="n">x0</span>
            <span class="k">if</span> <span class="n">x0</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">b</span><span class="p">:</span>
                <span class="n">k2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">A2</span> <span class="o">=</span> <span class="n">k2</span> <span class="o">*</span> <span class="p">((</span><span class="mi">2</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="n">p</span> <span class="o">-</span> <span class="n">x0</span><span class="o">**</span><span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="n">p</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">A2</span> <span class="o">=</span> <span class="n">k2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">k2</span><span class="p">,</span> <span class="n">A2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
            <span class="n">k3</span> <span class="o">=</span> <span class="n">xs</span><span class="o">**</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">A3</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">k3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">xs</span> <span class="o">*</span> <span class="n">b</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">A1</span> <span class="o">+</span> <span class="n">A2</span> <span class="o">+</span> <span class="n">A3</span>

            <span class="c1"># [2]: rejection constant is &lt; 2.73; so expected runtime is finite</span>
            <span class="k">while</span> <span class="n">simulated</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">simulated</span>
                <span class="n">h</span><span class="p">,</span> <span class="n">rvs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="c1"># simulate uniform rvs on [x1, x2] and [0, y2]</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                <span class="n">cond1</span> <span class="o">=</span> <span class="n">v</span> <span class="o">&lt;=</span> <span class="n">A1</span>
                <span class="n">cond2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">cond1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">v</span> <span class="o">&lt;=</span> <span class="n">A1</span> <span class="o">+</span> <span class="n">A2</span><span class="p">)</span>
                <span class="n">cond3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">cond1</span> <span class="o">|</span> <span class="n">cond2</span><span class="p">)</span>
                <span class="c1"># subdomain (0, x0)</span>
                <span class="n">rvs</span><span class="p">[</span><span class="n">cond1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="n">cond1</span><span class="p">]</span> <span class="o">/</span> <span class="n">A1</span>
                <span class="n">h</span><span class="p">[</span><span class="n">cond1</span><span class="p">]</span> <span class="o">=</span> <span class="n">k1</span>
                <span class="c1"># subdomain (x0, 2 / b)</span>
                <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">rvs</span><span class="p">[</span><span class="n">cond2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x0</span><span class="o">**</span><span class="n">p</span> <span class="o">+</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">cond2</span><span class="p">]</span> <span class="o">-</span> <span class="n">A1</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span> <span class="o">/</span> <span class="n">k2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">p</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rvs</span><span class="p">[</span><span class="n">cond2</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">v</span><span class="p">[</span><span class="n">cond2</span><span class="p">]</span> <span class="o">-</span> <span class="n">A1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
                <span class="n">h</span><span class="p">[</span><span class="n">cond2</span><span class="p">]</span> <span class="o">=</span> <span class="n">k2</span> <span class="o">*</span> <span class="n">rvs</span><span class="p">[</span><span class="n">cond2</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="c1"># subdomain (xs, infinity)</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">xs</span> <span class="o">*</span> <span class="n">b</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">cond3</span><span class="p">]</span> <span class="o">-</span> <span class="n">A1</span> <span class="o">-</span> <span class="n">A2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k3</span><span class="p">)</span>
                <span class="n">rvs</span><span class="p">[</span><span class="n">cond3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">/</span> <span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
                <span class="n">h</span><span class="p">[</span><span class="n">cond3</span><span class="p">]</span> <span class="o">=</span> <span class="n">k3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">rvs</span><span class="p">[</span><span class="n">cond3</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="c1"># apply rejection method</span>
                <span class="n">accept</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">u</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logquasipdf</span><span class="p">(</span><span class="n">rvs</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
                <span class="n">num_accept</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">accept</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">num_accept</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">x</span><span class="p">[</span><span class="n">simulated</span><span class="p">:(</span><span class="n">simulated</span> <span class="o">+</span> <span class="n">num_accept</span><span class="p">)]</span> <span class="o">=</span> <span class="n">rvs</span><span class="p">[</span><span class="n">accept</span><span class="p">]</span>
                    <span class="n">simulated</span> <span class="o">+=</span> <span class="n">num_accept</span>

        <span class="n">rvs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">size1d</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">invert_res</span><span class="p">:</span>
            <span class="n">rvs</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">rvs</span>
        <span class="k">return</span> <span class="n">rvs</span>

    <span class="k">def</span> <span class="nf">_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># distinguish cases to avoid catastrophic cancellation (see [2])</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">b</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">))</span> <span class="o">/</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">kve</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">kve</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">inf_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">denom</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inf_vals</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Infinite values encountered in the moment calculation &quot;</span>
                   <span class="s2">&quot;involving scipy.special.kve. Values replaced by NaN to &quot;</span>
                   <span class="s2">&quot;avoid incorrect results.&quot;</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
            <span class="n">m</span><span class="p">[</span><span class="o">~</span><span class="n">inf_vals</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span><span class="p">[</span><span class="o">~</span><span class="n">inf_vals</span><span class="p">]</span> <span class="o">/</span> <span class="n">denom</span><span class="p">[</span><span class="o">~</span><span class="n">inf_vals</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">num</span> <span class="o">/</span> <span class="n">denom</span>
        <span class="k">return</span> <span class="n">m</span>


<span class="n">geninvgauss</span> <span class="o">=</span> <span class="n">geninvgauss_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;geninvgauss&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">norminvgauss_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Normal Inverse Gaussian continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `norminvgauss` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a, b) = \frac{a \, K_1(a \sqrt{1 + x^2})}{\pi \sqrt{1 + x^2}} \,</span>
<span class="sd">                     \exp(\sqrt{a^2 - b^2} + b x)</span>

<span class="sd">    where :math:`x` is a real number, the parameter :math:`a` is the tail</span>
<span class="sd">    heaviness and :math:`b` is the asymmetry parameter satisfying</span>
<span class="sd">    :math:`a &gt; 0` and :math:`|b| &lt;= a`.</span>
<span class="sd">    :math:`K_1` is the modified Bessel function of second kind</span>
<span class="sd">    (`scipy.special.k1`).</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    A normal inverse Gaussian random variable `Y` with parameters `a` and `b`</span>
<span class="sd">    can be expressed as a normal mean-variance mixture:</span>
<span class="sd">    `Y = b * V + sqrt(V) * X` where `X` is `norm(0,1)` and `V` is</span>
<span class="sd">    `invgauss(mu=1/sqrt(a**2 - b**2))`. This representation is used</span>
<span class="sd">    to generate random variates.</span>

<span class="sd">    Another common parametrization of the distribution (see Equation 2.1 in</span>
<span class="sd">    [2]_) is given by the following expression of the pdf:</span>

<span class="sd">    .. math::</span>

<span class="sd">        g(x, \alpha, \beta, \delta, \mu) =</span>
<span class="sd">        \frac{\alpha\delta K_1\left(\alpha\sqrt{\delta^2 + (x - \mu)^2}\right)}</span>
<span class="sd">        {\pi \sqrt{\delta^2 + (x - \mu)^2}} \,</span>
<span class="sd">        e^{\delta \sqrt{\alpha^2 - \beta^2} + \beta (x - \mu)}</span>

<span class="sd">    In SciPy, this corresponds to</span>
<span class="sd">    `a = alpha * delta, b = beta * delta, loc = mu, scale=delta`.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] O. Barndorff-Nielsen, &quot;Hyperbolic Distributions and Distributions on</span>
<span class="sd">           Hyperbolae&quot;, Scandinavian Journal of Statistics, Vol. 5(3),</span>
<span class="sd">           pp. 151-157, 1978.</span>

<span class="sd">    .. [2] O. Barndorff-Nielsen, &quot;Normal Inverse Gaussian Distributions and</span>
<span class="sd">           Stochastic Volatility Modelling&quot;, Scandinavian Journal of</span>
<span class="sd">           Statistics, Vol. 24, pp. 1-13, 1997.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">fac1</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>
        <span class="n">sq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>  <span class="c1"># reduce overflows</span>
        <span class="k">return</span> <span class="n">fac1</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">k1e</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">sq</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="n">a</span><span class="o">*</span><span class="n">sq</span><span class="p">)</span> <span class="o">/</span> <span class="n">sq</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># note: X = b * V + sqrt(V) * X is norminvgaus(a,b) if X is standard</span>
        <span class="c1"># normal and V is invgauss(mu=1/sqrt(a**2 - b**2))</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ig</span> <span class="o">=</span> <span class="n">invgauss</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">gamma</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">b</span> <span class="o">*</span> <span class="n">ig</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ig</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                                               <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">b</span> <span class="o">/</span> <span class="n">gamma</span>
        <span class="n">variance</span> <span class="o">=</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">gamma</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">skewness</span> <span class="o">=</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">b</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">gamma</span><span class="p">))</span>
        <span class="n">kurtosis</span> <span class="o">=</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">gamma</span>
        <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">skewness</span><span class="p">,</span> <span class="n">kurtosis</span>


<span class="n">norminvgauss</span> <span class="o">=</span> <span class="n">norminvgauss_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;norminvgauss&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">invweibull_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">u</span><span class="sd">&quot;&quot;&quot;An inverted Weibull continuous random variable.</span>

<span class="sd">    This distribution is also known as the Fréchet distribution or the</span>
<span class="sd">    type II extreme value distribution.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `invweibull` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = c x^{-c-1} \\exp(-x^{-c})</span>

<span class="sd">    for :math:`x &gt; 0`, :math:`c &gt; 0`.</span>

<span class="sd">    `invweibull` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    F.R.S. de Gusmao, E.M.M Ortega and G.M. Cordeiro, &quot;The generalized inverse</span>
<span class="sd">    Weibull distribution&quot;, Stat. Papers, vol. 52, pp. 591-619, 2011.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># invweibull.pdf(x, c) = c * x**(-c-1) * exp(-x**(-c))</span>
        <span class="n">xc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">xc2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">)</span>
        <span class="n">xc2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">xc2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">c</span> <span class="o">*</span> <span class="n">xc1</span> <span class="o">*</span> <span class="n">xc2</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">xc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">xc1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">n</span> <span class="o">/</span> <span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">+</span><span class="n">_EULER</span> <span class="o">+</span> <span class="n">_EULER</span> <span class="o">/</span> <span class="n">c</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># invweibull requires c &gt; 1 for the first moment to exist, so use 2.0</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span><span class="p">,)</span> <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">args</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">invweibull_gen</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_fitstart</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>


<span class="n">invweibull</span> <span class="o">=</span> <span class="n">invweibull_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;invweibull&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">johnsonsb_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Johnson SB continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    johnsonsu</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `johnsonsb` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a, b) = \frac{b}{x(1-x)}  \phi(a + b \log \frac{x}{1-x} )</span>

<span class="sd">    where :math:`x`, :math:`a`, and :math:`b` are real scalars; :math:`b &gt; 0`</span>
<span class="sd">    and :math:`x \in [0,1]`.  :math:`\phi` is the pdf of the normal</span>
<span class="sd">    distribution.</span>

<span class="sd">    `johnsonsb` takes :math:`a` and :math:`b` as shape parameters.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># johnsonsb.pdf(x, a, b) = b / (x*(1-x)) * phi(a + b * log(x/(1-x)))</span>
        <span class="n">trm</span> <span class="o">=</span> <span class="n">_norm_pdf</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">x</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">b</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">))</span><span class="o">*</span><span class="n">trm</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">x</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">_norm_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span><span class="p">)))</span>


<span class="n">johnsonsb</span> <span class="o">=</span> <span class="n">johnsonsb_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;johnsonsb&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">johnsonsu_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Johnson SU continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    johnsonsb</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `johnsonsu` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a, b) = \frac{b}{\sqrt{x^2 + 1}}</span>
<span class="sd">                     \phi(a + b \log(x + \sqrt{x^2 + 1}))</span>

<span class="sd">    where :math:`x`, :math:`a`, and :math:`b` are real scalars; :math:`b &gt; 0`.</span>
<span class="sd">    :math:`\phi` is the pdf of the normal distribution.</span>

<span class="sd">    `johnsonsu` takes :math:`a` and :math:`b` as shape parameters.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># johnsonsu.pdf(x, a, b) = b / sqrt(x**2 + 1) *</span>
        <span class="c1">#                          phi(a + b * log(x + sqrt(x**2 + 1)))</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span>
        <span class="n">trm</span> <span class="o">=</span> <span class="n">_norm_pdf</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x2</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">b</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x2</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="n">trm</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">((</span><span class="n">_norm_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span>


<span class="n">johnsonsu</span> <span class="o">=</span> <span class="n">johnsonsu_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;johnsonsu&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">laplace_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Laplace continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `laplace` is</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{1}{2} \exp(-|x|)</span>

<span class="sd">    for a real number :math:`x`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">laplace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># laplace.pdf(x) = 1/2 * exp(-abs(x))</span>
        <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">over</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">),</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># By symmetry...</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">q</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="c1"># By symmetry...</span>
        <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>

    <span class="nd">@_call_super_mom</span>
    <span class="nd">@replace_notes_in_docstring</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">        This function uses explicit formulas for the maximum likelihood</span>
<span class="s2">        estimation of the Laplace distribution parameters, so the keyword</span>
<span class="s2">        arguments `loc`, `scale`, and `optimizer` are ignored.</span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span> <span class="o">=</span> <span class="n">_check_fit_input_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
                                                         <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

        <span class="c1"># Source: Statistical Distributions, 3rd Edition. Evans, Hastings,</span>
        <span class="c1"># and Peacock (2000), Page 124</span>

        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">floc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fscale</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">floc</span><span class="p">)))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span>


<span class="n">laplace</span> <span class="o">=</span> <span class="n">laplace_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;laplace&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">laplace_asymmetric_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;An asymmetric Laplace continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    laplace : Laplace distribution</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `laplace_asymmetric` is</span>

<span class="sd">    .. math::</span>

<span class="sd">       f(x, \kappa) &amp;= \frac{1}{\kappa+\kappa^{-1}}\exp(-x\kappa),\quad x\ge0\\</span>
<span class="sd">                    &amp;= \frac{1}{\kappa+\kappa^{-1}}\exp(x/\kappa),\quad x&lt;0\\</span>

<span class="sd">    for :math:`-\infty &lt; x &lt; \infty`, :math:`\kappa &gt; 0`.</span>

<span class="sd">    `laplace_asymmetric` takes ``kappa`` as a shape parameter for</span>
<span class="sd">    :math:`\kappa`. For :math:`\kappa = 1`, it is identical to a</span>
<span class="sd">    Laplace distribution.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] &quot;Asymmetric Laplace distribution&quot;, Wikipedia</span>
<span class="sd">            https://en.wikipedia.org/wiki/Asymmetric_Laplace_distribution</span>

<span class="sd">    .. [2] Kozubowski TJ and Podgórski K. A Multivariate and</span>
<span class="sd">           Asymmetric Generalization of Laplace Distribution,</span>
<span class="sd">           Computational Statistics 15, 531--540 (2000).</span>
<span class="sd">           :doi:`10.1007/PL00022717`</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">kappa</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="n">kapinv</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">kappa</span>
        <span class="n">lPx</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">kappa</span><span class="p">,</span> <span class="n">kapinv</span><span class="p">)</span>
        <span class="n">lPx</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">kappa</span><span class="o">+</span><span class="n">kapinv</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lPx</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="n">kapinv</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">kappa</span>
        <span class="n">kappkapinv</span> <span class="o">=</span> <span class="n">kappa</span><span class="o">+</span><span class="n">kapinv</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">kappa</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">kapinv</span><span class="o">/</span><span class="n">kappkapinv</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">kapinv</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">kappa</span><span class="o">/</span><span class="n">kappkapinv</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="n">kapinv</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">kappa</span>
        <span class="n">kappkapinv</span> <span class="o">=</span> <span class="n">kappa</span><span class="o">+</span><span class="n">kapinv</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">kappa</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">kapinv</span><span class="o">/</span><span class="n">kappkapinv</span><span class="p">),</span>
                        <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">kapinv</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">kappa</span><span class="o">/</span><span class="n">kappkapinv</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="n">kapinv</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">kappa</span>
        <span class="n">kappkapinv</span> <span class="o">=</span> <span class="n">kappa</span><span class="o">+</span><span class="n">kapinv</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q</span> <span class="o">&gt;=</span> <span class="n">kappa</span><span class="o">/</span><span class="n">kappkapinv</span><span class="p">,</span>
                        <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span><span class="o">*</span><span class="n">kappkapinv</span><span class="o">*</span><span class="n">kappa</span><span class="p">)</span><span class="o">*</span><span class="n">kapinv</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">kappkapinv</span><span class="o">/</span><span class="n">kappa</span><span class="p">)</span><span class="o">*</span><span class="n">kappa</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="n">kapinv</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">kappa</span>
        <span class="n">kappkapinv</span> <span class="o">=</span> <span class="n">kappa</span><span class="o">+</span><span class="n">kapinv</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q</span> <span class="o">&lt;=</span> <span class="n">kapinv</span><span class="o">/</span><span class="n">kappkapinv</span><span class="p">,</span>
                        <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">kappkapinv</span><span class="o">*</span><span class="n">kappa</span><span class="p">)</span><span class="o">*</span><span class="n">kapinv</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span><span class="o">*</span><span class="n">kappkapinv</span><span class="o">/</span><span class="n">kappa</span><span class="p">)</span><span class="o">*</span><span class="n">kappa</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="n">kapinv</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">kappa</span>
        <span class="n">mn</span> <span class="o">=</span> <span class="n">kapinv</span> <span class="o">-</span> <span class="n">kappa</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">kapinv</span><span class="o">*</span><span class="n">kapinv</span> <span class="o">+</span> <span class="n">kappa</span><span class="o">*</span><span class="n">kappa</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mf">1.5</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="mf">6.0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mn</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">kappa</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">kappa</span><span class="p">)</span>


<span class="n">laplace_asymmetric</span> <span class="o">=</span> <span class="n">laplace_asymmetric_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;laplace_asymmetric&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_check_fit_input_parameters</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">floc</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;floc&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">fscale</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fscale&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">num_shapes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span> <span class="k">if</span> <span class="n">dist</span><span class="o">.</span><span class="n">shapes</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">fshape_keys</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fshapes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># user has many options for fixing the shape, so here we standardize it</span>
    <span class="c1"># into &#39;f&#39; + the number of the shape.</span>
    <span class="c1"># Adapted from `_reduce_func` in `_distn_infrastructure.py`:</span>
    <span class="k">if</span> <span class="n">dist</span><span class="o">.</span><span class="n">shapes</span><span class="p">:</span>
        <span class="n">shapes</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">shapes</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;f&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span> <span class="o">+</span> <span class="n">s</span><span class="p">,</span> <span class="s1">&#39;fix_&#39;</span> <span class="o">+</span> <span class="n">s</span><span class="p">]</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">_get_fixed_fit_value</span><span class="p">(</span><span class="n">kwds</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
            <span class="n">fshape_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">fshapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">kwds</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

    <span class="c1"># determine if there are any unknown arguments in kwds</span>
    <span class="n">known_keys</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;loc&#39;</span><span class="p">,</span> <span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="s1">&#39;optimizer&#39;</span><span class="p">,</span> <span class="s1">&#39;method&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;floc&#39;</span><span class="p">,</span> <span class="s1">&#39;fscale&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">fshape_keys</span><span class="p">}</span>
    <span class="n">unknown_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">known_keys</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">unknown_keys</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown keyword arguments: </span><span class="si">{</span><span class="n">unknown_keys</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">num_shapes</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Too many positional arguments.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span><span class="p">,</span> <span class="o">*</span><span class="n">fshapes</span><span class="p">}:</span>
        <span class="c1"># This check is for consistency with `rv_continuous.fit`.</span>
        <span class="c1"># Without this check, this function would just return the</span>
        <span class="c1"># parameters that were given.</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;All parameters fixed. There is nothing to &quot;</span>
                           <span class="s2">&quot;optimize.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;The data contains non-finite values.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">fshapes</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">levy_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Levy continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    levy_stable, levy_l</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `levy` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{1}{\sqrt{2\pi x^3}} \exp\left(-\frac{1}{2x}\right)</span>

<span class="sd">    for :math:`x &gt;= 0`.</span>

<span class="sd">    This is the same as the Levy-stable distribution with :math:`a=1/2` and</span>
<span class="sd">    :math:`b=1`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># levy.pdf(x) = 1 / (x * sqrt(2*pi*x)) * exp(-1/(2*x))</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># Equivalent to 2*norm.sf(np.sqrt(1/x))</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">erfc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">/</span> <span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">erf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">/</span> <span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="c1"># Equivalent to 1.0/(norm.isf(q/2)**2) or 0.5/(erfcinv(q)**2)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">ndtri</span><span class="p">(</span><span class="n">q</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">val</span> <span class="o">*</span> <span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>


<span class="n">levy</span> <span class="o">=</span> <span class="n">levy_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;levy&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">levy_l_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A left-skewed Levy continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    levy, levy_stable</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `levy_l` is:</span>

<span class="sd">    .. math::</span>
<span class="sd">        f(x) = \frac{1}{|x| \sqrt{2\pi |x|}} \exp{ \left(-\frac{1}{2|x|} \right)}</span>

<span class="sd">    for :math:`x &lt;= 0`.</span>

<span class="sd">    This is the same as the Levy-stable distribution with :math:`a=1/2` and</span>
<span class="sd">    :math:`b=-1`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># levy_l.pdf(x) = 1 / (abs(x) * sqrt(2*pi*abs(x))) * exp(-1/(2*abs(x)))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">ax</span><span class="p">)</span><span class="o">/</span><span class="n">ax</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ax</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ax</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_norm_sf</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ax</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">_norm_ppf</span><span class="p">((</span><span class="n">q</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">val</span> <span class="o">*</span> <span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">_norm_isf</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>


<span class="n">levy_l</span> <span class="o">=</span> <span class="n">levy_l_gen</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;levy_l&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">levy_stable_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Levy-stable continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    levy, levy_l</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The distribution for `levy_stable` has characteristic function:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \varphi(t, \alpha, \beta, c, \mu) =</span>
<span class="sd">        e^{it\mu -|ct|^{\alpha}(1-i\beta \operatorname{sign}(t)\Phi(\alpha, t))}</span>

<span class="sd">    where:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \Phi = \begin{cases}</span>
<span class="sd">                \tan \left({\frac {\pi \alpha }{2}}\right)&amp;\alpha \neq 1\\</span>
<span class="sd">                -{\frac {2}{\pi }}\log |t|&amp;\alpha =1</span>
<span class="sd">                \end{cases}</span>

<span class="sd">    The probability density function for `levy_stable` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{1}{2\pi}\int_{-\infty}^\infty \varphi(t)e^{-ixt}\,dt</span>

<span class="sd">    where :math:`-\infty &lt; t &lt; \infty`. This integral does not have a known closed form.</span>

<span class="sd">    For evaluation of pdf we use either Zolotarev :math:`S_0` parameterization with integration,</span>
<span class="sd">    direct integration of standard parameterization of characteristic function or FFT of</span>
<span class="sd">    characteristic function. If set to other than None and if number of points is greater than</span>
<span class="sd">    ``levy_stable.pdf_fft_min_points_threshold`` (defaults to None) we use FFT otherwise we use one</span>
<span class="sd">    of the other methods.</span>

<span class="sd">    The default method is &#39;best&#39; which uses Zolotarev&#39;s method if alpha = 1 and integration of</span>
<span class="sd">    characteristic function otherwise. The default method can be changed by setting</span>
<span class="sd">    ``levy_stable.pdf_default_method`` to either &#39;zolotarev&#39;, &#39;quadrature&#39; or &#39;best&#39;.</span>

<span class="sd">    To increase accuracy of FFT calculation one can specify ``levy_stable.pdf_fft_grid_spacing``</span>
<span class="sd">    (defaults to 0.001) and ``pdf_fft_n_points_two_power`` (defaults to a value that covers the</span>
<span class="sd">    input range * 4). Setting ``pdf_fft_n_points_two_power`` to 16 should be sufficiently accurate</span>
<span class="sd">    in most cases at the expense of CPU time.</span>

<span class="sd">    For evaluation of cdf we use Zolatarev :math:`S_0` parameterization with integration or integral of</span>
<span class="sd">    the pdf FFT interpolated spline. The settings affecting FFT calculation are the same as</span>
<span class="sd">    for pdf calculation. Setting the threshold to ``None`` (default) will disable FFT. For cdf</span>
<span class="sd">    calculations the Zolatarev method is superior in accuracy, so FFT is disabled by default.</span>

<span class="sd">    Fitting estimate uses quantile estimation method in [MC]. MLE estimation of parameters in</span>
<span class="sd">    fit method uses this quantile estimate initially. Note that MLE doesn&#39;t always converge if</span>
<span class="sd">    using FFT for pdf calculations; so it&#39;s best that ``pdf_fft_min_points_threshold`` is left unset.</span>

<span class="sd">    .. warning::</span>

<span class="sd">        For pdf calculations implementation of Zolatarev is unstable for values where alpha = 1 and</span>
<span class="sd">        beta != 0. In this case the quadrature method is recommended. FFT calculation is also</span>
<span class="sd">        considered experimental.</span>

<span class="sd">        For cdf calculations FFT calculation is considered experimental. Use Zolatarev&#39;s method</span>
<span class="sd">        instead (default).</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [MC] McCulloch, J., 1986. Simple consistent estimators of stable distribution parameters.</span>
<span class="sd">       Communications in Statistics - Simulation and Computation 15, 11091136.</span>
<span class="sd">    .. [MS] Mittnik, S.T. Rachev, T. Doganoglu, D. Chenyao, 1999. Maximum likelihood estimation</span>
<span class="sd">       of stable Paretian models, Mathematical and Computer Modelling, Volume 29, Issue 10,</span>
<span class="sd">       1999, Pages 275-293.</span>
<span class="sd">    .. [BS] Borak, S., Hardle, W., Rafal, W. 2005. Stable distributions, Economic Risk.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">alpha1func</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">TH</span><span class="p">,</span> <span class="n">aTH</span><span class="p">,</span> <span class="n">bTH</span><span class="p">,</span> <span class="n">cosTH</span><span class="p">,</span> <span class="n">tanTH</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">bTH</span><span class="p">)</span><span class="o">*</span><span class="n">tanTH</span>
                            <span class="o">-</span> <span class="n">beta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">W</span><span class="o">*</span><span class="n">cosTH</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">bTH</span><span class="p">)))</span>

        <span class="k">def</span> <span class="nf">beta0func</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">TH</span><span class="p">,</span> <span class="n">aTH</span><span class="p">,</span> <span class="n">bTH</span><span class="p">,</span> <span class="n">cosTH</span><span class="p">,</span> <span class="n">tanTH</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">W</span><span class="o">/</span><span class="p">(</span><span class="n">cosTH</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">aTH</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">TH</span><span class="p">))</span> <span class="o">*</span>
                    <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">aTH</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">aTH</span><span class="p">)</span><span class="o">*</span><span class="n">tanTH</span><span class="p">)</span><span class="o">/</span><span class="n">W</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">alpha</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">otherwise</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">TH</span><span class="p">,</span> <span class="n">aTH</span><span class="p">,</span> <span class="n">bTH</span><span class="p">,</span> <span class="n">cosTH</span><span class="p">,</span> <span class="n">tanTH</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
            <span class="c1"># alpha is not 1 and beta is not 0</span>
            <span class="n">val0</span> <span class="o">=</span> <span class="n">beta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">th0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">val0</span><span class="p">)</span><span class="o">/</span><span class="n">alpha</span>
            <span class="n">val3</span> <span class="o">=</span> <span class="n">W</span><span class="o">/</span><span class="p">(</span><span class="n">cosTH</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">th0</span> <span class="o">+</span> <span class="n">TH</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">TH</span><span class="p">))</span>
            <span class="n">res3</span> <span class="o">=</span> <span class="n">val3</span><span class="o">*</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">aTH</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">aTH</span><span class="p">)</span><span class="o">*</span><span class="n">tanTH</span> <span class="o">-</span>
                          <span class="n">val0</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">aTH</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">aTH</span><span class="p">)</span><span class="o">*</span><span class="n">tanTH</span><span class="p">))</span><span class="o">/</span><span class="n">W</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">alpha</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">res3</span>

        <span class="k">def</span> <span class="nf">alphanot1func</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">TH</span><span class="p">,</span> <span class="n">aTH</span><span class="p">,</span> <span class="n">bTH</span><span class="p">,</span> <span class="n">cosTH</span><span class="p">,</span> <span class="n">tanTH</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">beta</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
                             <span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">TH</span><span class="p">,</span> <span class="n">aTH</span><span class="p">,</span> <span class="n">bTH</span><span class="p">,</span> <span class="n">cosTH</span><span class="p">,</span> <span class="n">tanTH</span><span class="p">,</span> <span class="n">W</span><span class="p">),</span>
                             <span class="n">beta0func</span><span class="p">,</span> <span class="n">f2</span><span class="o">=</span><span class="n">otherwise</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">res</span>

        <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="n">TH</span> <span class="o">=</span> <span class="n">uniform</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                         <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">expon</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="n">aTH</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="n">TH</span>
        <span class="n">bTH</span> <span class="o">=</span> <span class="n">beta</span><span class="o">*</span><span class="n">TH</span>
        <span class="n">cosTH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">TH</span><span class="p">)</span>
        <span class="n">tanTH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">TH</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">alpha</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>
                         <span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">TH</span><span class="p">,</span> <span class="n">aTH</span><span class="p">,</span> <span class="n">bTH</span><span class="p">,</span> <span class="n">cosTH</span><span class="p">,</span> <span class="n">tanTH</span><span class="p">,</span> <span class="n">W</span><span class="p">),</span>
                         <span class="n">alpha1func</span><span class="p">,</span> <span class="n">f2</span><span class="o">=</span><span class="n">alphanot1func</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">beta</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">beta</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_cf</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="n">Phi</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">alpha</span> <span class="o">!=</span> <span class="mi">1</span> <span class="k">else</span> <span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">beta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">Phi</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">t</span><span class="p">)))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_pdf_from_cf_with_fft</span><span class="p">(</span><span class="n">cf</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">9</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates pdf from cf using fft. Using region around 0 with N=2**q points</span>
<span class="sd">        separated by distance h. As suggested by [MS].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">N</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">q</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">density</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(((</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">cf</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">h</span><span class="o">/</span><span class="n">N</span><span class="p">))</span><span class="o">/</span><span class="n">h</span><span class="o">/</span><span class="n">N</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">h</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_pdf_single_value_best</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">alpha</span> <span class="o">!=</span> <span class="mf">1.</span> <span class="ow">or</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">==</span> <span class="mf">1.</span> <span class="ow">and</span> <span class="n">beta</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">levy_stable_gen</span><span class="o">.</span><span class="n">_pdf_single_value_zolotarev</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">levy_stable_gen</span><span class="o">.</span><span class="n">_pdf_single_value_cf_integrate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_pdf_single_value_cf_integrate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="n">cf</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">levy_stable_gen</span><span class="o">.</span><span class="n">_cf</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">t</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">cf</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1000</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_pdf_single_value_zolotarev</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate pdf using Zolotarev&#39;s methods as detailed in [BS].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">zeta</span> <span class="o">=</span> <span class="o">-</span><span class="n">beta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">alpha</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">alpha</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">zeta</span>  <span class="c1"># convert to S_0 parameterization</span>
            <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="o">-</span><span class="n">zeta</span><span class="p">)</span><span class="o">/</span><span class="n">alpha</span>

            <span class="k">def</span> <span class="nf">V</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="n">xi</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">alpha</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> \
                                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">xi</span><span class="o">+</span><span class="n">theta</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="n">alpha</span><span class="o">/</span><span class="p">(</span><span class="n">alpha</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> \
                                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="n">xi</span><span class="o">+</span><span class="p">(</span><span class="n">alpha</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">theta</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">x0</span> <span class="o">&gt;</span> <span class="n">zeta</span><span class="p">:</span>
                <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
                    <span class="k">return</span> <span class="p">(</span><span class="n">V</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">(</span><span class="n">x0</span><span class="o">-</span><span class="n">zeta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">alpha</span><span class="o">/</span><span class="p">(</span><span class="n">alpha</span><span class="o">-</span><span class="mi">1</span><span class="p">))))</span>

                <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">g</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">g</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>

                <span class="c1"># spare calculating integral on null set</span>
                <span class="c1"># use isclose as macos has fp differences</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="o">-</span><span class="n">xi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-014</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-014</span><span class="p">):</span>
                    <span class="k">return</span> <span class="mf">0.</span>

                <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>
                    <span class="n">intg_max</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">minimize_scalar</span><span class="p">(</span><span class="k">lambda</span> <span class="n">theta</span><span class="p">:</span> <span class="o">-</span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">bounds</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">xi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">intg_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="c1"># windows quadpack less forgiving with points out of bounds</span>
                    <span class="k">if</span> <span class="n">intg_max</span><span class="o">.</span><span class="n">success</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">intg_max</span><span class="o">.</span><span class="n">fun</span><span class="p">)</span>\
                            <span class="ow">and</span> <span class="n">intg_max</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">xi</span> <span class="ow">and</span> <span class="n">intg_max</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
                        <span class="n">intg_kwargs</span><span class="p">[</span><span class="s2">&quot;points&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">intg_max</span><span class="o">.</span><span class="n">x</span><span class="p">]</span>
                    <span class="n">intg</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">-</span><span class="n">xi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">**</span><span class="n">intg_kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">return</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">intg</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">alpha</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x0</span><span class="o">-</span><span class="n">zeta</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">x0</span> <span class="o">==</span> <span class="n">zeta</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">zeta</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">levy_stable_gen</span><span class="o">.</span><span class="n">_pdf_single_value_zolotarev</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="o">-</span><span class="n">beta</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># since location zero, no need to reposition x for S_0 parameterization</span>
            <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span>
            <span class="k">if</span> <span class="n">beta</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Density calculation unstable for alpha=1 and beta!=0.&#39;</span> <span class="o">+</span>
                              <span class="s1">&#39; Use quadrature method instead.&#39;</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>

                <span class="k">def</span> <span class="nf">V</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
                    <span class="n">expr_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">beta</span><span class="o">*</span><span class="n">theta</span>
                    <span class="k">return</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">expr_1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">expr_1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

                <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">/</span> <span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="n">V</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

                <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">g</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">g</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>

                <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>
                    <span class="n">intg_max</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">minimize_scalar</span><span class="p">(</span><span class="k">lambda</span> <span class="n">theta</span><span class="p">:</span> <span class="o">-</span><span class="n">f</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">bounds</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">intg</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">fixed_quad</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">intg_max</span><span class="o">.</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">integrate</span><span class="o">.</span><span class="n">fixed_quad</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">intg_max</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">return</span> <span class="n">intg</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_cdf_single_value_zolotarev</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate cdf using Zolotarev&#39;s methods as detailed in [BS].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">zeta</span> <span class="o">=</span> <span class="o">-</span><span class="n">beta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">alpha</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">alpha</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">zeta</span>  <span class="c1"># convert to S_0 parameterization</span>
            <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="o">-</span><span class="n">zeta</span><span class="p">)</span><span class="o">/</span><span class="n">alpha</span>

            <span class="k">def</span> <span class="nf">V</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="n">xi</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">alpha</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> \
                                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">xi</span><span class="o">+</span><span class="n">theta</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="n">alpha</span><span class="o">/</span><span class="p">(</span><span class="n">alpha</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> \
                                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="n">xi</span><span class="o">+</span><span class="p">(</span><span class="n">alpha</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">theta</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">x0</span> <span class="o">&gt;</span> <span class="n">zeta</span><span class="p">:</span>
                <span class="n">c_1</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">alpha</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">.5</span> <span class="o">-</span> <span class="n">xi</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>

                <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
                    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">(</span><span class="n">x0</span> <span class="o">-</span> <span class="n">zeta</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">V</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">z</span><span class="o">**</span><span class="p">(</span><span class="n">alpha</span><span class="o">/</span><span class="p">(</span><span class="n">alpha</span><span class="o">-</span><span class="mi">1</span><span class="p">))))</span>

                <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>
                    <span class="c1"># spare calculating integral on null set</span>
                    <span class="c1"># use isclose as macos has fp differences</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="o">-</span><span class="n">xi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-014</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-014</span><span class="p">):</span>
                        <span class="n">intg</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">intg</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">-</span><span class="n">xi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">return</span> <span class="n">c_1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">intg</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="k">elif</span> <span class="n">x0</span> <span class="o">==</span> <span class="n">zeta</span><span class="p">:</span>
                <span class="k">return</span> <span class="mf">.5</span> <span class="o">-</span> <span class="n">xi</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">levy_stable_gen</span><span class="o">.</span><span class="n">_cdf_single_value_zolotarev</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="o">-</span><span class="n">beta</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># since location zero, no need to reposition x for S_0 parameterization</span>
            <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span>
            <span class="k">if</span> <span class="n">beta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

                <span class="k">def</span> <span class="nf">V</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
                    <span class="n">expr_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">beta</span><span class="o">*</span><span class="n">theta</span>
                    <span class="k">return</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">expr_1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">expr_1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

                <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>
                    <span class="n">expr_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">beta</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
                    <span class="n">int_1</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="k">lambda</span> <span class="n">theta</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">expr_1</span> <span class="o">*</span> <span class="n">V</span><span class="p">(</span><span class="n">theta</span><span class="p">)),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">return</span> <span class="n">int_1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="k">elif</span> <span class="n">beta</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="mf">.5</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">levy_stable_gen</span><span class="o">.</span><span class="n">_cdf_single_value_zolotarev</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">beta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">,:]</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>

        <span class="n">data_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">data_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_in</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>

        <span class="n">pdf_default_method_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;pdf_default_method&#39;</span><span class="p">,</span> <span class="s1">&#39;best&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pdf_default_method_name</span> <span class="o">==</span> <span class="s1">&#39;best&#39;</span><span class="p">:</span>
            <span class="n">pdf_single_value_method</span> <span class="o">=</span> <span class="n">levy_stable_gen</span><span class="o">.</span><span class="n">_pdf_single_value_best</span>
        <span class="k">elif</span> <span class="n">pdf_default_method_name</span> <span class="o">==</span> <span class="s1">&#39;zolotarev&#39;</span><span class="p">:</span>
            <span class="n">pdf_single_value_method</span> <span class="o">=</span> <span class="n">levy_stable_gen</span><span class="o">.</span><span class="n">_pdf_single_value_zolotarev</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pdf_single_value_method</span> <span class="o">=</span> <span class="n">levy_stable_gen</span><span class="o">.</span><span class="n">_pdf_single_value_cf_integrate</span>

        <span class="n">fft_min_points_threshold</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;pdf_fft_min_points_threshold&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">fft_grid_spacing</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;pdf_fft_grid_spacing&#39;</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">)</span>
        <span class="n">fft_n_points_two_power</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;pdf_fft_n_points_two_power&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># group data in unique arrays of alpha, beta pairs</span>
        <span class="n">uniq_param_pairs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="nb">list</span><span class="p">({</span><span class="nb">tuple</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span>
                                           <span class="n">data_in</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]}))</span>
        <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">uniq_param_pairs</span><span class="p">:</span>
            <span class="n">data_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">data_in</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="n">pair</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">data_subset</span> <span class="o">=</span> <span class="n">data_in</span><span class="p">[</span><span class="n">data_mask</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">fft_min_points_threshold</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_subset</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">fft_min_points_threshold</span><span class="p">:</span>
                <span class="n">data_out</span><span class="p">[</span><span class="n">data_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pdf_single_value_method</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_alpha</span><span class="p">,</span> <span class="n">_beta</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">_x</span><span class="p">,</span> <span class="n">_alpha</span><span class="p">,</span> <span class="n">_beta</span> <span class="ow">in</span> <span class="n">data_subset</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_subset</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Density calculations experimental for FFT method.&#39;</span> <span class="o">+</span>
                              <span class="s1">&#39; Use combination of zolatarev and quadrature methods instead.&#39;</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
                <span class="n">_alpha</span><span class="p">,</span> <span class="n">_beta</span> <span class="o">=</span> <span class="n">pair</span>
                <span class="n">_x</span> <span class="o">=</span> <span class="n">data_subset</span><span class="p">[:,(</span><span class="mi">0</span><span class="p">,)]</span>

                <span class="c1"># need enough points to &quot;cover&quot; _x for interpolation</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">fft_grid_spacing</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">_x</span><span class="p">))</span><span class="o">/</span><span class="n">h</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">fft_n_points_two_power</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">fft_n_points_two_power</span><span class="p">)</span>

                <span class="n">density_x</span><span class="p">,</span> <span class="n">density</span> <span class="o">=</span> <span class="n">levy_stable_gen</span><span class="o">.</span><span class="n">_pdf_from_cf_with_fft</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">levy_stable_gen</span><span class="o">.</span><span class="n">_cf</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">_alpha</span><span class="p">,</span> <span class="n">_beta</span><span class="p">),</span> <span class="n">h</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">density_x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">density</span><span class="p">))</span>
                <span class="n">data_out</span><span class="p">[</span><span class="n">data_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">_x</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data_out</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">,:]</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>

        <span class="n">data_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">data_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_in</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>

        <span class="n">fft_min_points_threshold</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;pdf_fft_min_points_threshold&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">fft_grid_spacing</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;pdf_fft_grid_spacing&#39;</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">)</span>
        <span class="n">fft_n_points_two_power</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;pdf_fft_n_points_two_power&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># group data in unique arrays of alpha, beta pairs</span>
        <span class="n">uniq_param_pairs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
            <span class="nb">list</span><span class="p">({</span><span class="nb">tuple</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data_in</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]}))</span>
        <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">uniq_param_pairs</span><span class="p">:</span>
            <span class="n">data_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">data_in</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="n">pair</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">data_subset</span> <span class="o">=</span> <span class="n">data_in</span><span class="p">[</span><span class="n">data_mask</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">fft_min_points_threshold</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_subset</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">fft_min_points_threshold</span><span class="p">:</span>
                <span class="n">data_out</span><span class="p">[</span><span class="n">data_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">levy_stable</span><span class="o">.</span><span class="n">_cdf_single_value_zolotarev</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_alpha</span><span class="p">,</span> <span class="n">_beta</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">_x</span><span class="p">,</span> <span class="n">_alpha</span><span class="p">,</span> <span class="n">_beta</span> <span class="ow">in</span> <span class="n">data_subset</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_subset</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;FFT method is considered experimental for &quot;</span>
                              <span class="s2">&quot;cumulative distribution function &quot;</span>
                              <span class="s2">&quot;evaluations. Use Zolotarev&#39;s method instead.&quot;</span><span class="p">,</span>
                              <span class="ne">RuntimeWarning</span><span class="p">)</span>
                <span class="n">_alpha</span><span class="p">,</span> <span class="n">_beta</span> <span class="o">=</span> <span class="n">pair</span>
                <span class="n">_x</span> <span class="o">=</span> <span class="n">data_subset</span><span class="p">[:,(</span><span class="mi">0</span><span class="p">,)]</span>

                <span class="c1"># need enough points to &quot;cover&quot; _x for interpolation</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">fft_grid_spacing</span>
                <span class="n">q</span> <span class="o">=</span> <span class="mi">16</span> <span class="k">if</span> <span class="n">fft_n_points_two_power</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">fft_n_points_two_power</span><span class="p">)</span>

                <span class="n">density_x</span><span class="p">,</span> <span class="n">density</span> <span class="o">=</span> <span class="n">levy_stable_gen</span><span class="o">.</span><span class="n">_pdf_from_cf_with_fft</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">levy_stable_gen</span><span class="o">.</span><span class="n">_cf</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">_alpha</span><span class="p">,</span> <span class="n">_beta</span><span class="p">),</span> <span class="n">h</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">InterpolatedUnivariateSpline</span><span class="p">(</span><span class="n">density_x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">density</span><span class="p">))</span>
                <span class="n">data_out</span><span class="p">[</span><span class="n">data_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">integral</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">x_1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x_1</span> <span class="ow">in</span> <span class="n">_x</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">data_out</span><span class="p">[</span><span class="n">data_mask</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data_out</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># We follow McCullock 1986 method - Simple Consistent Estimators</span>
        <span class="c1"># of Stable Distribution Parameters</span>

        <span class="c1"># Table III and IV</span>
        <span class="n">nu_alpha_range</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.439</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.6</span><span class="p">,</span> <span class="mf">2.7</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">25</span><span class="p">]</span>
        <span class="n">nu_beta_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="c1"># table III - alpha = psi_1(nu_alpha, nu_beta)</span>
        <span class="n">alpha_table</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="mf">2.000</span><span class="p">,</span> <span class="mf">2.000</span><span class="p">,</span> <span class="mf">2.000</span><span class="p">,</span> <span class="mf">2.000</span><span class="p">,</span> <span class="mf">2.000</span><span class="p">,</span> <span class="mf">2.000</span><span class="p">,</span> <span class="mf">2.000</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.916</span><span class="p">,</span> <span class="mf">1.924</span><span class="p">,</span> <span class="mf">1.924</span><span class="p">,</span> <span class="mf">1.924</span><span class="p">,</span> <span class="mf">1.924</span><span class="p">,</span> <span class="mf">1.924</span><span class="p">,</span> <span class="mf">1.924</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.808</span><span class="p">,</span> <span class="mf">1.813</span><span class="p">,</span> <span class="mf">1.829</span><span class="p">,</span> <span class="mf">1.829</span><span class="p">,</span> <span class="mf">1.829</span><span class="p">,</span> <span class="mf">1.829</span><span class="p">,</span> <span class="mf">1.829</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.729</span><span class="p">,</span> <span class="mf">1.730</span><span class="p">,</span> <span class="mf">1.737</span><span class="p">,</span> <span class="mf">1.745</span><span class="p">,</span> <span class="mf">1.745</span><span class="p">,</span> <span class="mf">1.745</span><span class="p">,</span> <span class="mf">1.745</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.664</span><span class="p">,</span> <span class="mf">1.663</span><span class="p">,</span> <span class="mf">1.663</span><span class="p">,</span> <span class="mf">1.668</span><span class="p">,</span> <span class="mf">1.676</span><span class="p">,</span> <span class="mf">1.676</span><span class="p">,</span> <span class="mf">1.676</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.563</span><span class="p">,</span> <span class="mf">1.560</span><span class="p">,</span> <span class="mf">1.553</span><span class="p">,</span> <span class="mf">1.548</span><span class="p">,</span> <span class="mf">1.547</span><span class="p">,</span> <span class="mf">1.547</span><span class="p">,</span> <span class="mf">1.547</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.484</span><span class="p">,</span> <span class="mf">1.480</span><span class="p">,</span> <span class="mf">1.471</span><span class="p">,</span> <span class="mf">1.460</span><span class="p">,</span> <span class="mf">1.448</span><span class="p">,</span> <span class="mf">1.438</span><span class="p">,</span> <span class="mf">1.438</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.391</span><span class="p">,</span> <span class="mf">1.386</span><span class="p">,</span> <span class="mf">1.378</span><span class="p">,</span> <span class="mf">1.364</span><span class="p">,</span> <span class="mf">1.337</span><span class="p">,</span> <span class="mf">1.318</span><span class="p">,</span> <span class="mf">1.318</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.279</span><span class="p">,</span> <span class="mf">1.273</span><span class="p">,</span> <span class="mf">1.266</span><span class="p">,</span> <span class="mf">1.250</span><span class="p">,</span> <span class="mf">1.210</span><span class="p">,</span> <span class="mf">1.184</span><span class="p">,</span> <span class="mf">1.150</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.128</span><span class="p">,</span> <span class="mf">1.121</span><span class="p">,</span> <span class="mf">1.114</span><span class="p">,</span> <span class="mf">1.101</span><span class="p">,</span> <span class="mf">1.067</span><span class="p">,</span> <span class="mf">1.027</span><span class="p">,</span> <span class="mf">0.973</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.029</span><span class="p">,</span> <span class="mf">1.021</span><span class="p">,</span> <span class="mf">1.014</span><span class="p">,</span> <span class="mf">1.004</span><span class="p">,</span> <span class="mf">0.974</span><span class="p">,</span> <span class="mf">0.935</span><span class="p">,</span> <span class="mf">0.874</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.896</span><span class="p">,</span> <span class="mf">0.892</span><span class="p">,</span> <span class="mf">0.884</span><span class="p">,</span> <span class="mf">0.883</span><span class="p">,</span> <span class="mf">0.855</span><span class="p">,</span> <span class="mf">0.823</span><span class="p">,</span> <span class="mf">0.769</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.818</span><span class="p">,</span> <span class="mf">0.812</span><span class="p">,</span> <span class="mf">0.806</span><span class="p">,</span> <span class="mf">0.801</span><span class="p">,</span> <span class="mf">0.780</span><span class="p">,</span> <span class="mf">0.756</span><span class="p">,</span> <span class="mf">0.691</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.698</span><span class="p">,</span> <span class="mf">0.695</span><span class="p">,</span> <span class="mf">0.692</span><span class="p">,</span> <span class="mf">0.689</span><span class="p">,</span> <span class="mf">0.676</span><span class="p">,</span> <span class="mf">0.656</span><span class="p">,</span> <span class="mf">0.597</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.593</span><span class="p">,</span> <span class="mf">0.590</span><span class="p">,</span> <span class="mf">0.588</span><span class="p">,</span> <span class="mf">0.586</span><span class="p">,</span> <span class="mf">0.579</span><span class="p">,</span> <span class="mf">0.563</span><span class="p">,</span> <span class="mf">0.513</span><span class="p">]]</span>

        <span class="c1"># table IV - beta = psi_2(nu_alpha, nu_beta)</span>
        <span class="n">beta_table</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.160</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.592</span><span class="p">,</span> <span class="mf">3.390</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.759</span><span class="p">,</span> <span class="mf">1.800</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.482</span><span class="p">,</span> <span class="mf">1.048</span><span class="p">,</span> <span class="mf">1.694</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.360</span><span class="p">,</span> <span class="mf">0.760</span><span class="p">,</span> <span class="mf">1.232</span><span class="p">,</span> <span class="mf">2.229</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.253</span><span class="p">,</span> <span class="mf">0.518</span><span class="p">,</span> <span class="mf">0.823</span><span class="p">,</span> <span class="mf">1.575</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.203</span><span class="p">,</span> <span class="mf">0.410</span><span class="p">,</span> <span class="mf">0.632</span><span class="p">,</span> <span class="mf">1.244</span><span class="p">,</span> <span class="mf">1.906</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.165</span><span class="p">,</span> <span class="mf">0.332</span><span class="p">,</span> <span class="mf">0.499</span><span class="p">,</span> <span class="mf">0.943</span><span class="p">,</span> <span class="mf">1.560</span><span class="p">,</span> <span class="mf">1.000</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.136</span><span class="p">,</span> <span class="mf">0.271</span><span class="p">,</span> <span class="mf">0.404</span><span class="p">,</span> <span class="mf">0.689</span><span class="p">,</span> <span class="mf">1.230</span><span class="p">,</span> <span class="mf">2.195</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.109</span><span class="p">,</span> <span class="mf">0.216</span><span class="p">,</span> <span class="mf">0.323</span><span class="p">,</span> <span class="mf">0.539</span><span class="p">,</span> <span class="mf">0.827</span><span class="p">,</span> <span class="mf">1.917</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.096</span><span class="p">,</span> <span class="mf">0.190</span><span class="p">,</span> <span class="mf">0.284</span><span class="p">,</span> <span class="mf">0.472</span><span class="p">,</span> <span class="mf">0.693</span><span class="p">,</span> <span class="mf">1.759</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.082</span><span class="p">,</span> <span class="mf">0.163</span><span class="p">,</span> <span class="mf">0.243</span><span class="p">,</span> <span class="mf">0.412</span><span class="p">,</span> <span class="mf">0.601</span><span class="p">,</span> <span class="mf">1.596</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.074</span><span class="p">,</span> <span class="mf">0.147</span><span class="p">,</span> <span class="mf">0.220</span><span class="p">,</span> <span class="mf">0.377</span><span class="p">,</span> <span class="mf">0.546</span><span class="p">,</span> <span class="mf">1.482</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.064</span><span class="p">,</span> <span class="mf">0.128</span><span class="p">,</span> <span class="mf">0.191</span><span class="p">,</span> <span class="mf">0.330</span><span class="p">,</span> <span class="mf">0.478</span><span class="p">,</span> <span class="mf">1.362</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.056</span><span class="p">,</span> <span class="mf">0.112</span><span class="p">,</span> <span class="mf">0.167</span><span class="p">,</span> <span class="mf">0.285</span><span class="p">,</span> <span class="mf">0.428</span><span class="p">,</span> <span class="mf">1.274</span><span class="p">]]</span>

        <span class="c1"># Table V and VII</span>
        <span class="n">alpha_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.9</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
        <span class="n">beta_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Table V - nu_c = psi_3(alpha, beta)</span>
        <span class="n">nu_c_table</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="mf">1.908</span><span class="p">,</span> <span class="mf">1.908</span><span class="p">,</span> <span class="mf">1.908</span><span class="p">,</span> <span class="mf">1.908</span><span class="p">,</span> <span class="mf">1.908</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.914</span><span class="p">,</span> <span class="mf">1.915</span><span class="p">,</span> <span class="mf">1.916</span><span class="p">,</span> <span class="mf">1.918</span><span class="p">,</span> <span class="mf">1.921</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.921</span><span class="p">,</span> <span class="mf">1.922</span><span class="p">,</span> <span class="mf">1.927</span><span class="p">,</span> <span class="mf">1.936</span><span class="p">,</span> <span class="mf">1.947</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.927</span><span class="p">,</span> <span class="mf">1.930</span><span class="p">,</span> <span class="mf">1.943</span><span class="p">,</span> <span class="mf">1.961</span><span class="p">,</span> <span class="mf">1.987</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.933</span><span class="p">,</span> <span class="mf">1.940</span><span class="p">,</span> <span class="mf">1.962</span><span class="p">,</span> <span class="mf">1.997</span><span class="p">,</span> <span class="mf">2.043</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.939</span><span class="p">,</span> <span class="mf">1.952</span><span class="p">,</span> <span class="mf">1.988</span><span class="p">,</span> <span class="mf">2.045</span><span class="p">,</span> <span class="mf">2.116</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.946</span><span class="p">,</span> <span class="mf">1.967</span><span class="p">,</span> <span class="mf">2.022</span><span class="p">,</span> <span class="mf">2.106</span><span class="p">,</span> <span class="mf">2.211</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.955</span><span class="p">,</span> <span class="mf">1.984</span><span class="p">,</span> <span class="mf">2.067</span><span class="p">,</span> <span class="mf">2.188</span><span class="p">,</span> <span class="mf">2.333</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.965</span><span class="p">,</span> <span class="mf">2.007</span><span class="p">,</span> <span class="mf">2.125</span><span class="p">,</span> <span class="mf">2.294</span><span class="p">,</span> <span class="mf">2.491</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.980</span><span class="p">,</span> <span class="mf">2.040</span><span class="p">,</span> <span class="mf">2.205</span><span class="p">,</span> <span class="mf">2.435</span><span class="p">,</span> <span class="mf">2.696</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">2.000</span><span class="p">,</span> <span class="mf">2.085</span><span class="p">,</span> <span class="mf">2.311</span><span class="p">,</span> <span class="mf">2.624</span><span class="p">,</span> <span class="mf">2.973</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">2.040</span><span class="p">,</span> <span class="mf">2.149</span><span class="p">,</span> <span class="mf">2.461</span><span class="p">,</span> <span class="mf">2.886</span><span class="p">,</span> <span class="mf">3.356</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">2.098</span><span class="p">,</span> <span class="mf">2.244</span><span class="p">,</span> <span class="mf">2.676</span><span class="p">,</span> <span class="mf">3.265</span><span class="p">,</span> <span class="mf">3.912</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">2.189</span><span class="p">,</span> <span class="mf">2.392</span><span class="p">,</span> <span class="mf">3.004</span><span class="p">,</span> <span class="mf">3.844</span><span class="p">,</span> <span class="mf">4.775</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">2.337</span><span class="p">,</span> <span class="mf">2.634</span><span class="p">,</span> <span class="mf">3.542</span><span class="p">,</span> <span class="mf">4.808</span><span class="p">,</span> <span class="mf">6.247</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">2.588</span><span class="p">,</span> <span class="mf">3.073</span><span class="p">,</span> <span class="mf">4.534</span><span class="p">,</span> <span class="mf">6.636</span><span class="p">,</span> <span class="mf">9.144</span><span class="p">]]</span>

        <span class="c1"># Table VII - nu_zeta = psi_5(alpha, beta)</span>
        <span class="n">nu_zeta_table</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.000</span><span class="p">,</span> <span class="mf">0.000</span><span class="p">,</span> <span class="mf">0.000</span><span class="p">,</span> <span class="mf">0.000</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.017</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.032</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.049</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.064</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.030</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.061</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.092</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.123</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.043</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.088</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.132</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.179</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.056</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.111</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.170</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.232</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.066</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.134</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.206</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.283</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.075</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.154</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.241</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.335</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.084</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.173</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.276</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.390</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.090</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.192</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.310</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.447</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.095</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.208</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.346</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.508</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.098</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.223</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.380</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.576</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.099</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.237</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.424</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.652</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.096</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.250</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.469</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.742</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.089</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.262</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.520</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.853</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.078</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.272</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.581</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.997</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.061</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.279</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.659</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.198</span><span class="p">]]</span>

        <span class="n">psi_1</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">nu_beta_range</span><span class="p">,</span> <span class="n">nu_alpha_range</span><span class="p">,</span> <span class="n">alpha_table</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
        <span class="n">psi_2</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">nu_beta_range</span><span class="p">,</span> <span class="n">nu_alpha_range</span><span class="p">,</span> <span class="n">beta_table</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
        <span class="n">psi_2_1</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">nu_beta</span><span class="p">,</span> <span class="n">nu_alpha</span><span class="p">:</span> <span class="n">psi_2</span><span class="p">(</span><span class="n">nu_beta</span><span class="p">,</span> <span class="n">nu_alpha</span><span class="p">)</span> <span class="k">if</span> <span class="n">nu_beta</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="n">psi_2</span><span class="p">(</span><span class="o">-</span><span class="n">nu_beta</span><span class="p">,</span> <span class="n">nu_alpha</span><span class="p">)</span>

        <span class="n">phi_3</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">beta_range</span><span class="p">,</span> <span class="n">alpha_range</span><span class="p">,</span> <span class="n">nu_c_table</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
        <span class="n">phi_3_1</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="n">phi_3</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span> <span class="k">if</span> <span class="n">beta</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">phi_3</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="n">phi_5</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">beta_range</span><span class="p">,</span> <span class="n">alpha_range</span><span class="p">,</span> <span class="n">nu_zeta_table</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
        <span class="n">phi_5_1</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="n">phi_5</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span> <span class="k">if</span> <span class="n">beta</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="n">phi_5</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>

        <span class="c1"># quantiles</span>
        <span class="n">p05</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">p50</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">p95</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
        <span class="n">p25</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
        <span class="n">p75</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>

        <span class="n">nu_alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">p95</span> <span class="o">-</span> <span class="n">p05</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">p75</span> <span class="o">-</span> <span class="n">p25</span><span class="p">)</span>
        <span class="n">nu_beta</span> <span class="o">=</span> <span class="p">(</span><span class="n">p95</span> <span class="o">+</span> <span class="n">p05</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">p50</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">p95</span> <span class="o">-</span> <span class="n">p05</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">nu_alpha</span> <span class="o">&gt;=</span> <span class="mf">2.439</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">psi_1</span><span class="p">(</span><span class="n">nu_beta</span><span class="p">,</span> <span class="n">nu_alpha</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)</span>
            <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">psi_2_1</span><span class="p">(</span><span class="n">nu_beta</span><span class="p">,</span> <span class="n">nu_alpha</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="mf">2.0</span>
            <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">nu_beta</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">p75</span> <span class="o">-</span> <span class="n">p25</span><span class="p">)</span> <span class="o">/</span> <span class="n">phi_3_1</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">zeta</span> <span class="o">=</span> <span class="n">p50</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">phi_5_1</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">zeta</span><span class="o">-</span><span class="n">beta</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">alpha</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span> <span class="k">if</span> <span class="n">alpha</span> <span class="o">==</span> <span class="mf">1.</span> <span class="k">else</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">alpha</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">alpha</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mf">0.</span> <span class="k">if</span> <span class="n">alpha</span> <span class="o">==</span> <span class="mf">2.</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="mf">0.</span> <span class="k">if</span> <span class="n">alpha</span> <span class="o">==</span> <span class="mf">2.</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>


<span class="n">levy_stable</span> <span class="o">=</span> <span class="n">levy_stable_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;levy_stable&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">logistic_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A logistic (or Sech-squared) continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `logistic` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{\exp(-x)}</span>
<span class="sd">                    {(1+\exp(-x))^2}</span>

<span class="sd">    `logistic` is a special case of `genlogistic` with ``c=1``.</span>

<span class="sd">    Remark that the survival function (``logistic.sf``) is equal to the</span>
<span class="sd">    Fermi-Dirac distribution describing fermionic statistics.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">logistic</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># logistic.pdf(x) = exp(-x) / (1+exp(-x))**2</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y</span> <span class="o">-</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">expit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">log_expit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">logit</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">expit</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">log_expit</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">logit</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">6.0</span><span class="o">/</span><span class="mf">5.0</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># https://en.wikipedia.org/wiki/Logistic_distribution</span>
        <span class="k">return</span> <span class="mf">2.0</span>

    <span class="nd">@_call_super_mom</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span> <span class="o">=</span> <span class="n">_check_fit_input_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
                                                         <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

        <span class="c1"># if user has provided `floc` or `fscale`, fall back on super fit</span>
        <span class="c1"># method. This scenario is not suitable for solving a system of</span>
        <span class="c1"># equations</span>
        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="c1"># rv_continuous provided guesses</span>
        <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fitstart</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="c1"># account for user provided guesses</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="p">)</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>

        <span class="c1"># the maximum likelihood estimators `a` and `b` of the location and</span>
        <span class="c1"># scale parameters are roots of the two equations described in `func`.</span>
        <span class="c1"># Source: Statistical Distributions, 3rd Edition. Evans, Hastings, and</span>
        <span class="c1"># Peacock (2000), Page 130</span>
        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">params</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">expit</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">-</span> <span class="n">n</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="n">n</span>
            <span class="k">return</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span>

        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">optimize</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">),</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">data</span><span class="p">,))</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>


<span class="n">logistic</span> <span class="o">=</span> <span class="n">logistic_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;logistic&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">loggamma_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A log gamma continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `loggamma` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = \frac{\exp(c x - \exp(x))}</span>
<span class="sd">                       {\Gamma(c)}</span>

<span class="sd">    for all :math:`x, c &gt; 0`. Here, :math:`\Gamma` is the</span>
<span class="sd">    gamma function (`scipy.special.gamma`).</span>

<span class="sd">    `loggamma` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">random_state</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># loggamma.pdf(x, c) = exp(c*x-exp(x)) / gamma(c)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">c</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">gammainccinv</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># See, for example, &quot;A Statistical Study of Log-Gamma Distribution&quot;, by</span>
        <span class="c1"># Ping Shing Chan (thesis, McMaster University, 1993).</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">digamma</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">polygamma</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="n">skewness</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">polygamma</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
        <span class="n">excess_kurtosis</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">polygamma</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">var</span><span class="o">*</span><span class="n">var</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">skewness</span><span class="p">,</span> <span class="n">excess_kurtosis</span>


<span class="n">loggamma</span> <span class="o">=</span> <span class="n">loggamma_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;loggamma&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">loglaplace_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A log-Laplace continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `loglaplace` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = \begin{cases}\frac{c}{2} x^{ c-1}  &amp;\text{for } 0 &lt; x &lt; 1\\</span>
<span class="sd">                               \frac{c}{2} x^{-c-1}  &amp;\text{for } x \ge 1</span>
<span class="sd">                  \end{cases}</span>

<span class="sd">    for :math:`c &gt; 0`.</span>

<span class="sd">    `loglaplace` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    T.J. Kozubowski and K. Podgorski, &quot;A log-Laplace growth rate model&quot;,</span>
<span class="sd">    The Mathematical Scientist, vol. 28, pp. 49-60, 2003.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># loglaplace.pdf(x, c) = c / 2 * x**(c-1),   for 0 &lt; x &lt; 1</span>
        <span class="c1">#                      = c / 2 * x**(-c-1),  for x &gt;= 1</span>
        <span class="n">cd2</span> <span class="o">=</span> <span class="n">c</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cd2</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="n">c</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">c</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.0</span>


<span class="n">loglaplace</span> <span class="o">=</span> <span class="n">loglaplace_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;loglaplace&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_lognorm_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span>
                      <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">s</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)),</span>
                      <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">lognorm_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A lognormal continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `lognorm` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, s) = \frac{1}{s x \sqrt{2\pi}}</span>
<span class="sd">                  \exp\left(-\frac{\log^2(x)}{2s^2}\right)</span>

<span class="sd">    for :math:`x &gt; 0`, :math:`s &gt; 0`.</span>

<span class="sd">    `lognorm` takes ``s`` as a shape parameter for :math:`s`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    A common parametrization for a lognormal random variable ``Y`` is in</span>
<span class="sd">    terms of the mean, ``mu``, and standard deviation, ``sigma``, of the</span>
<span class="sd">    unique normally distributed random variable ``X`` such that exp(X) = Y.</span>
<span class="sd">    This parametrization corresponds to setting ``s = sigma`` and ``scale =</span>
<span class="sd">    exp(mu)``.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">s</span> <span class="o">*</span> <span class="n">random_state</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="c1"># lognorm.pdf(x, s) = 1 / (s*x*sqrt(2*pi)) * exp(-1/2*(log(x)/s)**2)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_lognorm_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">s</span> <span class="o">*</span> <span class="n">_norm_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_sf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_logsf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="n">s</span><span class="p">)</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="n">p</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.0</span><span class="p">],</span> <span class="n">p</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>

    <span class="nd">@_call_super_mom</span>
    <span class="nd">@extend_notes_in_docstring</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">        When `method=&#39;MLE&#39;` and</span>
<span class="s2">        the location parameter is fixed by using the `floc` argument,</span>
<span class="s2">        this function uses explicit formulas for the maximum likelihood</span>
<span class="s2">        estimation of the log-normal shape and scale parameters, so the</span>
<span class="s2">        `optimizer`, `loc` and `scale` keyword arguments are ignored.</span>
<span class="s2">        </span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">floc</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;floc&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># fall back on the default fit method.</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="n">f0</span> <span class="o">=</span> <span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;f0&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span>
              <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fix_s&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">fscale</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fscale&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Too many input arguments.&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;f0&#39;</span><span class="p">,</span> <span class="s1">&#39;fs&#39;</span><span class="p">,</span> <span class="s1">&#39;fix_s&#39;</span><span class="p">,</span> <span class="s1">&#39;floc&#39;</span><span class="p">,</span> <span class="s1">&#39;fscale&#39;</span><span class="p">,</span> <span class="s1">&#39;loc&#39;</span><span class="p">,</span> <span class="s1">&#39;scale&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;optimizer&#39;</span><span class="p">,</span> <span class="s1">&#39;method&#39;</span><span class="p">]:</span>
            <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwds</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Unknown arguments: </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">kwds</span><span class="p">)</span>

        <span class="c1"># Special case: loc is fixed.  Use the maximum likelihood formulas</span>
        <span class="c1"># instead of the numerical solver.</span>

        <span class="k">if</span> <span class="n">f0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># This check is for consistency with `rv_continuous.fit`.</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All parameters fixed. There is nothing to &quot;</span>
                             <span class="s2">&quot;optimize.&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;The data contains non-finite values.&quot;</span><span class="p">)</span>

        <span class="n">floc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">floc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">floc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Shifting the data by floc. Don&#39;t do the subtraction in-place,</span>
            <span class="c1"># because `data` might be a view of the input array.</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">floc</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">data</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">FitDataError</span><span class="p">(</span><span class="s2">&quot;lognorm&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="n">floc</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="n">lndata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Three cases to handle:</span>
        <span class="c1"># * shape and scale both free</span>
        <span class="c1"># * shape fixed, scale free</span>
        <span class="c1"># * shape free, scale fixed</span>

        <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># scale is free.</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lndata</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">f0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># shape is free.</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="n">lndata</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># shape is fixed.</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">f0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># scale is fixed, shape is free</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">fscale</span><span class="p">)</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">lndata</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">scale</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">shape</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">scale</span>


<span class="n">lognorm</span> <span class="o">=</span> <span class="n">lognorm_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;lognorm&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">gilbrat_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Gilbrat continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `gilbrat` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{1}{x \sqrt{2\pi}} \exp(-\frac{1}{2} (\log(x))^2)</span>

<span class="sd">    `gilbrat` is a special case of `lognorm` with ``s=1``.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">random_state</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># gilbrat.pdf(x) = 1/(x*sqrt(2*pi)) * exp(-1/2*(log(x))**2)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_lognorm_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">_norm_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">e</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.0</span><span class="p">],</span> <span class="n">p</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span>


<span class="n">gilbrat</span> <span class="o">=</span> <span class="n">gilbrat_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;gilbrat&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">maxwell_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Maxwell continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    A special case of a `chi` distribution,  with ``df=3``, ``loc=0.0``,</span>
<span class="sd">    and given ``scale = a``, where ``a`` is the parameter used in the</span>
<span class="sd">    Mathworld description [1]_.</span>

<span class="sd">    The probability density function for `maxwell` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \sqrt{2/\pi}x^2 \exp(-x^2/2)</span>

<span class="sd">    for :math:`x &gt;= 0`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] http://mathworld.wolfram.com/MaxwellDistribution.html</span>

<span class="sd">    %(example)s</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">chi</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># maxwell.pdf(x) = sqrt(2/pi)x**2 * exp(-x**2/2)</span>
        <span class="k">return</span> <span class="n">_SQRT_2_OVER_PI</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_LOG_SQRT_2_OVER_PI</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">x</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="mi">8</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
                <span class="mi">3</span><span class="o">-</span><span class="mi">8</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">32</span><span class="o">-</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="n">val</span><span class="o">**</span><span class="mf">1.5</span><span class="p">,</span>
                <span class="p">(</span><span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="mi">160</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="mi">384</span><span class="p">)</span> <span class="o">/</span> <span class="n">val</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_EULER</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span>


<span class="n">maxwell</span> <span class="o">=</span> <span class="n">maxwell_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;maxwell&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">mielke_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Mielke Beta-Kappa / Dagum continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `mielke` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, k, s) = \frac{k x^{k-1}}{(1+x^s)^{1+k/s}}</span>

<span class="sd">    for :math:`x &gt; 0` and :math:`k, s &gt; 0`. The distribution is sometimes</span>
<span class="sd">    called Dagum distribution ([2]_). It was already defined in [3]_, called</span>
<span class="sd">    a Burr Type III distribution (`burr` with parameters ``c=s`` and</span>
<span class="sd">    ``d=k/s``).</span>

<span class="sd">    `mielke` takes ``k`` and ``s`` as shape parameters.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Mielke, P.W., 1973 &quot;Another Family of Distributions for Describing</span>
<span class="sd">           and Analyzing Precipitation Data.&quot; J. Appl. Meteor., 12, 275-280</span>
<span class="sd">    .. [2] Dagum, C., 1977 &quot;A new model for personal income distribution.&quot;</span>
<span class="sd">           Economie Appliquee, 33, 327-367.</span>
<span class="sd">    .. [3] Burr, I. W. &quot;Cumulative frequency functions&quot;, Annals of</span>
<span class="sd">           Mathematical Statistics, 13(2), pp 215-232 (1942).</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">s</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">x</span><span class="o">**</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="n">k</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">x</span><span class="o">**</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="n">qsk</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">s</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="n">qsk</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">qsk</span><span class="p">),</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">nth_moment</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
            <span class="c1"># n-th moment is defined for -k &lt; n &lt; s</span>
            <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">((</span><span class="n">k</span><span class="o">+</span><span class="n">n</span><span class="p">)</span><span class="o">/</span><span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">n</span><span class="o">/</span><span class="n">s</span><span class="p">)</span><span class="o">/</span><span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">k</span><span class="o">/</span><span class="n">s</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span> <span class="n">nth_moment</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>


<span class="n">mielke</span> <span class="o">=</span> <span class="n">mielke_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mielke&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">kappa4_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Kappa 4 parameter distribution.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for kappa4 is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, h, k) = (1 - k x)^{1/k - 1} (1 - h (1 - k x)^{1/k})^{1/h-1}</span>

<span class="sd">    if :math:`h` and :math:`k` are not equal to 0.</span>

<span class="sd">    If :math:`h` or :math:`k` are zero then the pdf can be simplified:</span>

<span class="sd">    h = 0 and k != 0::</span>

<span class="sd">        kappa4.pdf(x, h, k) = (1.0 - k*x)**(1.0/k - 1.0)*</span>
<span class="sd">                              exp(-(1.0 - k*x)**(1.0/k))</span>

<span class="sd">    h != 0 and k = 0::</span>

<span class="sd">        kappa4.pdf(x, h, k) = exp(-x)*(1.0 - h*exp(-x))**(1.0/h - 1.0)</span>

<span class="sd">    h = 0 and k = 0::</span>

<span class="sd">        kappa4.pdf(x, h, k) = exp(-x)*exp(-exp(-x))</span>

<span class="sd">    kappa4 takes :math:`h` and :math:`k` as shape parameters.</span>

<span class="sd">    The kappa4 distribution returns other distributions when certain</span>
<span class="sd">    :math:`h` and :math:`k` values are used.</span>

<span class="sd">    +------+-------------+----------------+------------------+</span>
<span class="sd">    | h    | k=0.0       | k=1.0          | -inf&lt;=k&lt;=inf     |</span>
<span class="sd">    +======+=============+================+==================+</span>
<span class="sd">    | -1.0 | Logistic    |                | Generalized      |</span>
<span class="sd">    |      |             |                | Logistic(1)      |</span>
<span class="sd">    |      |             |                |                  |</span>
<span class="sd">    |      | logistic(x) |                |                  |</span>
<span class="sd">    +------+-------------+----------------+------------------+</span>
<span class="sd">    |  0.0 | Gumbel      | Reverse        | Generalized      |</span>
<span class="sd">    |      |             | Exponential(2) | Extreme Value    |</span>
<span class="sd">    |      |             |                |                  |</span>
<span class="sd">    |      | gumbel_r(x) |                | genextreme(x, k) |</span>
<span class="sd">    +------+-------------+----------------+------------------+</span>
<span class="sd">    |  1.0 | Exponential | Uniform        | Generalized      |</span>
<span class="sd">    |      |             |                | Pareto           |</span>
<span class="sd">    |      |             |                |                  |</span>
<span class="sd">    |      | expon(x)    | uniform(x)     | genpareto(x, -k) |</span>
<span class="sd">    +------+-------------+----------------+------------------+</span>

<span class="sd">    (1) There are at least five generalized logistic distributions.</span>
<span class="sd">        Four are described here:</span>
<span class="sd">        https://en.wikipedia.org/wiki/Generalized_logistic_distribution</span>
<span class="sd">        The &quot;fifth&quot; one is the one kappa4 should match which currently</span>
<span class="sd">        isn&#39;t implemented in scipy:</span>
<span class="sd">        https://en.wikipedia.org/wiki/Talk:Generalized_logistic_distribution</span>
<span class="sd">        https://www.mathwave.com/help/easyfit/html/analyses/distributions/gen_logistic.html</span>
<span class="sd">    (2) This distribution is currently not in scipy.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    J.C. Finney, &quot;Optimization of a Skewed Logistic Distribution With Respect</span>
<span class="sd">    to the Kolmogorov-Smirnov Test&quot;, A Dissertation Submitted to the Graduate</span>
<span class="sd">    Faculty of the Louisiana State University and Agricultural and Mechanical</span>
<span class="sd">    College, (August, 2004),</span>
<span class="sd">    https://digitalcommons.lsu.edu/gradschool_dissertations/3672</span>

<span class="sd">    J.R.M. Hosking, &quot;The four-parameter kappa distribution&quot;. IBM J. Res.</span>
<span class="sd">    Develop. 38 (3), 25 1-258 (1994).</span>

<span class="sd">    B. Kumphon, A. Kaew-Man, P. Seenoi, &quot;A Rainfall Distribution for the Lampao</span>
<span class="sd">    Site in the Chi River Basin, Thailand&quot;, Journal of Water Resource and</span>
<span class="sd">    Protection, vol. 4, 866-869, (2012).</span>
<span class="sd">    :doi:`10.4236/jwarp.2012.410101`</span>

<span class="sd">    C. Winchester, &quot;On Estimation of the Four-Parameter Kappa Distribution&quot;, A</span>
<span class="sd">    Thesis Submitted to Dalhousie University, Halifax, Nova Scotia, (March</span>
<span class="sd">    2000).</span>
<span class="sd">    http://www.nlc-bnc.ca/obj/s4/f2/dsk2/ftp01/MQ57336.pdf</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">h</span> <span class="o">==</span> <span class="n">h</span>

    <span class="k">def</span> <span class="nf">_get_support</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">condlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)]</span>

        <span class="k">def</span> <span class="nf">f0</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="o">-</span><span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="n">k</span>

        <span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">f3</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">h</span><span class="p">))</span>
            <span class="n">a</span><span class="p">[:]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">return</span> <span class="n">a</span>

        <span class="k">def</span> <span class="nf">f5</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">k</span>

        <span class="n">_a</span> <span class="o">=</span> <span class="n">_lazyselect</span><span class="p">(</span><span class="n">condlist</span><span class="p">,</span>
                             <span class="p">[</span><span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f3</span><span class="p">,</span> <span class="n">f3</span><span class="p">,</span> <span class="n">f5</span><span class="p">],</span>
                             <span class="p">[</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span>
                             <span class="n">default</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">f0</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">k</span>

        <span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">h</span><span class="p">))</span>
            <span class="n">a</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">return</span> <span class="n">a</span>

        <span class="n">_b</span> <span class="o">=</span> <span class="n">_lazyselect</span><span class="p">(</span><span class="n">condlist</span><span class="p">,</span>
                             <span class="p">[</span><span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f1</span><span class="p">],</span>
                             <span class="p">[</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span>
                             <span class="n">default</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="c1"># kappa4.pdf(x, h, k) = (1.0 - k*x)**(1.0/k - 1.0)*</span>
        <span class="c1">#                       (1.0 - h*(1.0 - k*x)**(1.0/k))**(1.0/h-1)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">condlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span>

        <span class="k">def</span> <span class="nf">f0</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;pdf = (1.0 - k*x)**(1.0/k - 1.0)*(</span>
<span class="sd">                      1.0 - h*(1.0 - k*x)**(1.0/k))**(1.0/h-1.0)</span>
<span class="sd">               logpdf = ...</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">xlog1py</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">k</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span>
                    <span class="n">sc</span><span class="o">.</span><span class="n">xlog1py</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">h</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">k</span><span class="p">)))</span>

        <span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;pdf = (1.0 - k*x)**(1.0/k - 1.0)*np.exp(-(</span>
<span class="sd">                      1.0 - k*x)**(1.0/k))</span>
<span class="sd">               logpdf = ...</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlog1py</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">k</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">k</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">f2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;pdf = np.exp(-x)*(1.0 - h*np.exp(-x))**(1.0/h - 1.0)</span>
<span class="sd">               logpdf = ...</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">x</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlog1py</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">h</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="n">h</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">f3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;pdf = np.exp(-x-np.exp(-x))</span>
<span class="sd">               logpdf = ...</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_lazyselect</span><span class="p">(</span><span class="n">condlist</span><span class="p">,</span>
                           <span class="p">[</span><span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f3</span><span class="p">],</span>
                           <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span>
                           <span class="n">default</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logcdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">condlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span>

        <span class="k">def</span> <span class="nf">f0</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;cdf = (1.0 - h*(1.0 - k*x)**(1.0/k))**(1.0/h)</span>
<span class="sd">               logcdf = ...</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">return</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">k</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;cdf = np.exp(-(1.0 - k*x)**(1.0/k))</span>
<span class="sd">               logcdf = ...</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">k</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">f2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;cdf = (1.0 - h*np.exp(-x))**(1.0/h)</span>
<span class="sd">               logcdf = ...</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">return</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">h</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">f3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;cdf = np.exp(-np.exp(-x))</span>
<span class="sd">               logcdf = ...</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_lazyselect</span><span class="p">(</span><span class="n">condlist</span><span class="p">,</span>
                           <span class="p">[</span><span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f3</span><span class="p">],</span>
                           <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span>
                           <span class="n">default</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">condlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span>

        <span class="k">def</span> <span class="nf">f0</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">q</span><span class="o">**</span><span class="n">h</span><span class="p">))</span><span class="o">/</span><span class="n">h</span><span class="p">)</span><span class="o">**</span><span class="n">k</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="n">k</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">f2</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;ppf = -np.log((1.0 - (q**h))/h)</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">q</span><span class="o">**</span><span class="n">h</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">f3</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">_lazyselect</span><span class="p">(</span><span class="n">condlist</span><span class="p">,</span>
                           <span class="p">[</span><span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f3</span><span class="p">],</span>
                           <span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span>
                           <span class="n">default</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">h</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">maxr</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">elif</span> <span class="n">h</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">maxr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">h</span><span class="o">*</span><span class="n">k</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">maxr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">k</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">maxr</span> <span class="o">=</span> <span class="mi">5</span>

        <span class="n">outputs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">maxr</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">outputs</span><span class="p">[:]</span>


<span class="n">kappa4</span> <span class="o">=</span> <span class="n">kappa4_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;kappa4&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">kappa3_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Kappa 3 parameter distribution.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `kappa3` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a) = a (a + x^a)^{-(a + 1)/a}</span>

<span class="sd">    for :math:`x &gt; 0` and :math:`a &gt; 0`.</span>

<span class="sd">    `kappa3` takes ``a`` as a shape parameter for :math:`a`.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    P.W. Mielke and E.S. Johnson, &quot;Three-Parameter Kappa Distribution Maximum</span>
<span class="sd">    Likelihood and Likelihood Ratio Tests&quot;, Methods in Weather Research,</span>
<span class="sd">    701-707, (September, 1973),</span>
<span class="sd">    :doi:`10.1175/1520-0493(1973)101&lt;0701:TKDMLE&gt;2.3.CO;2`</span>

<span class="sd">    B. Kumphon, &quot;Maximum Entropy and Maximum Likelihood Estimation for the</span>
<span class="sd">    Three-Parameter Kappa Distribution&quot;, Open Journal of Statistics, vol 2,</span>
<span class="sd">    415-419 (2012), :doi:`10.4236/ojs.2012.24050`</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="c1"># kappa3.pdf(x, a) = a*(a + x**a)**(-(a + 1)/a),     for x &gt; 0</span>
        <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="p">(</span><span class="n">q</span><span class="o">**-</span><span class="n">a</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">outputs</span><span class="p">[:]</span>


<span class="n">kappa3</span> <span class="o">=</span> <span class="n">kappa3_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;kappa3&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">moyal_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Moyal continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `moyal` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \exp(-(x + \exp(-x))/2) / \sqrt{2\pi}</span>

<span class="sd">    for a real number :math:`x`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    This distribution has utility in high-energy physics and radiation</span>
<span class="sd">    detection. It describes the energy loss of a charged relativistic</span>
<span class="sd">    particle due to ionization of the medium [1]_. It also provides an</span>
<span class="sd">    approximation for the Landau distribution. For an in depth description</span>
<span class="sd">    see [2]_. For additional description, see [3]_.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] J.E. Moyal, &quot;XXX. Theory of ionization fluctuations&quot;,</span>
<span class="sd">           The London, Edinburgh, and Dublin Philosophical Magazine</span>
<span class="sd">           and Journal of Science, vol 46, 263-280, (1955).</span>
<span class="sd">           :doi:`10.1080/14786440308521076` (gated)</span>
<span class="sd">    .. [2] G. Cordeiro et al., &quot;The beta Moyal: a useful skew distribution&quot;,</span>
<span class="sd">           International Journal of Research and Reviews in Applied Sciences,</span>
<span class="sd">           vol 10, 171-192, (2012).</span>
<span class="sd">           http://www.arpapress.com/Volumes/Vol10Issue2/IJRRAS_10_2_02.pdf</span>
<span class="sd">    .. [3] C. Walck, &quot;Handbook on Statistical Distributions for</span>
<span class="sd">           Experimentalists; International Report SUF-PFY/96-01&quot;, Chapter 26,</span>
<span class="sd">           University of Stockholm: Stockholm, Sweden, (2007).</span>
<span class="sd">           http://www.stat.rice.edu/~dobelman/textfiles/DistributionsHandbook.pdf</span>

<span class="sd">    .. versionadded:: 1.1.0</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                       <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">erfc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">erf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">erfcinv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">euler_gamma</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">zeta</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="mf">4.</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">euler_gamma</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mf">2.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">euler_gamma</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mf">3.0</span><span class="p">:</span>
            <span class="n">tmp1</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">euler_gamma</span><span class="p">)</span>
            <span class="n">tmp2</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">euler_gamma</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span>
            <span class="n">tmp3</span> <span class="o">=</span> <span class="mi">14</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">zeta</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">tmp1</span> <span class="o">+</span> <span class="n">tmp2</span> <span class="o">+</span> <span class="n">tmp3</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mf">4.0</span><span class="p">:</span>
            <span class="n">tmp1</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">14</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">zeta</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">euler_gamma</span><span class="p">)</span>
            <span class="n">tmp2</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">euler_gamma</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">tmp3</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">euler_gamma</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span>
            <span class="n">tmp4</span> <span class="o">=</span> <span class="mi">7</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">4</span> <span class="o">/</span> <span class="mi">4</span>
            <span class="k">return</span> <span class="n">tmp1</span> <span class="o">+</span> <span class="n">tmp2</span> <span class="o">+</span> <span class="n">tmp3</span> <span class="o">+</span> <span class="n">tmp4</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># return generic for higher moments</span>
            <span class="c1"># return rv_continuous._mom1_sc(self, n, b)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mom1_sc</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>


<span class="n">moyal</span> <span class="o">=</span> <span class="n">moyal_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;moyal&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">nakagami_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Nakagami continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `nakagami` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, \nu) = \frac{2 \nu^\nu}{\Gamma(\nu)} x^{2\nu-1} \exp(-\nu x^2)</span>

<span class="sd">    for :math:`x &gt;= 0`, :math:`\nu &gt; 0`.</span>

<span class="sd">    `nakagami` takes ``nu`` as a shape parameter for :math:`\nu`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">nu</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="c1"># nakagami.pdf(x, nu) = 2 * nu**nu / gamma(nu) *</span>
        <span class="c1">#                       x**(2*nu-1) * exp(-nu*x**2)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">nu</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nu</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">nu</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">nu</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">nu</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincc</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">nu</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">nu</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainccinv</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">nu</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">mu</span><span class="o">*</span><span class="n">mu</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">nu</span><span class="o">*</span><span class="n">mu2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="n">nu</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">mu2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">mu</span><span class="o">**</span><span class="mi">4</span><span class="o">*</span><span class="n">nu</span> <span class="o">+</span> <span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">nu</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">mu</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">nu</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">g2</span> <span class="o">/=</span> <span class="n">nu</span><span class="o">*</span><span class="n">mu2</span><span class="o">**</span><span class="mf">2.0</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">numargs</span>
        <span class="c1"># Analytical justified estimates</span>
        <span class="c1"># see: https://docs.scipy.org/doc/scipy/reference/tutorial/stats/continuous_nakagami.html</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">data</span> <span class="o">-</span> <span class="n">loc</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">args</span> <span class="o">+</span> <span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>


<span class="n">nakagami</span> <span class="o">=</span> <span class="n">nakagami_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;nakagami&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ncx2_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A non-central chi-squared continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `ncx2` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, k, \lambda) = \frac{1}{2} \exp(-(\lambda+x)/2)</span>
<span class="sd">            (x/\lambda)^{(k-2)/4}  I_{(k-2)/2}(\sqrt{\lambda x})</span>

<span class="sd">    for :math:`x &gt;= 0` and :math:`k, \lambda &gt; 0`. :math:`k` specifies the</span>
<span class="sd">    degrees of freedom (denoted ``df`` in the implementation) and</span>
<span class="sd">    :math:`\lambda` is the non-centrality parameter (denoted ``nc`` in the</span>
<span class="sd">    implementation). :math:`I_\nu` denotes the modified Bessel function of</span>
<span class="sd">    first order of degree :math:`\nu` (`scipy.special.iv`).</span>

<span class="sd">    `ncx2` takes ``df`` and ``nc`` as shape parameters.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nc</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">noncentral_chisquare</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span> <span class="n">f</span><span class="o">=</span><span class="n">_ncx2_log_pdf</span><span class="p">,</span> <span class="n">f2</span><span class="o">=</span><span class="n">chi2</span><span class="o">.</span><span class="n">logpdf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="c1"># ncx2.pdf(x, df, nc) = exp(-(nc+x)/2) * 1/2 * (x/nc)**((df-2)/4)</span>
        <span class="c1">#                       * I[(df-2)/2](sqrt(nc*x))</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span> <span class="n">f</span><span class="o">=</span><span class="n">_ncx2_pdf</span><span class="p">,</span> <span class="n">f2</span><span class="o">=</span><span class="n">chi2</span><span class="o">.</span><span class="n">pdf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span> <span class="n">f</span><span class="o">=</span><span class="n">_ncx2_cdf</span><span class="p">,</span> <span class="n">f2</span><span class="o">=</span><span class="n">chi2</span><span class="o">.</span><span class="n">cdf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span> <span class="n">f</span><span class="o">=</span><span class="n">sc</span><span class="o">.</span><span class="n">chndtrix</span><span class="p">,</span> <span class="n">f2</span><span class="o">=</span><span class="n">chi2</span><span class="o">.</span><span class="n">ppf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">df</span> <span class="o">+</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">nc</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">df</span> <span class="o">+</span> <span class="n">nc</span><span class="p">,</span>
                <span class="mi">2</span><span class="o">*</span><span class="n">val</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">val</span><span class="o">+</span><span class="n">nc</span><span class="p">)</span><span class="o">/</span><span class="n">val</span><span class="o">**</span><span class="mf">1.5</span><span class="p">,</span>
                <span class="mf">12.0</span><span class="o">*</span><span class="p">(</span><span class="n">val</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">nc</span><span class="p">)</span><span class="o">/</span><span class="n">val</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span>


<span class="n">ncx2</span> <span class="o">=</span> <span class="n">ncx2_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ncx2&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ncf_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A non-central F distribution continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    scipy.stats.f : Fisher distribution</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `ncf` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, n_1, n_2, \lambda) =</span>
<span class="sd">            \exp\left(\frac{\lambda}{2} +</span>
<span class="sd">                      \lambda n_1 \frac{x}{2(n_1 x + n_2)}</span>
<span class="sd">                \right)</span>
<span class="sd">            n_1^{n_1/2} n_2^{n_2/2} x^{n_1/2 - 1} \\</span>
<span class="sd">            (n_2 + n_1 x)^{-(n_1 + n_2)/2}</span>
<span class="sd">            \gamma(n_1/2) \gamma(1 + n_2/2) \\</span>
<span class="sd">            \frac{L^{\frac{n_1}{2}-1}_{n_2/2}</span>
<span class="sd">                \left(-\lambda n_1 \frac{x}{2(n_1 x + n_2)}\right)}</span>
<span class="sd">            {B(n_1/2, n_2/2)</span>
<span class="sd">                \gamma\left(\frac{n_1 + n_2}{2}\right)}</span>

<span class="sd">    for :math:`n_1, n_2 &gt; 0`, :math:`\lambda \ge 0`.  Here :math:`n_1` is the</span>
<span class="sd">    degrees of freedom in the numerator, :math:`n_2` the degrees of freedom in</span>
<span class="sd">    the denominator, :math:`\lambda` the non-centrality parameter,</span>
<span class="sd">    :math:`\gamma` is the logarithm of the Gamma function, :math:`L_n^k` is a</span>
<span class="sd">    generalized Laguerre polynomial and :math:`B` is the beta function.</span>

<span class="sd">    `ncf` takes ``df1``, ``df2`` and ``nc`` as shape parameters. If ``nc=0``,</span>
<span class="sd">    the distribution becomes equivalent to the Fisher distribution.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">df1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nc</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">noncentral_f</span><span class="p">(</span><span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf_skip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="c1"># ncf.pdf(x, df1, df2, nc) = exp(nc/2 + nc*df1*x/(2*(df1*x+df2))) *</span>
        <span class="c1">#             df1**(df1/2) * df2**(df2/2) * x**(df1/2-1) *</span>
        <span class="c1">#             (df2+df1*x)**(-(df1+df2)/2) *</span>
        <span class="c1">#             gamma(df1/2)*gamma(1+df2/2) *</span>
        <span class="c1">#             L^{v1/2-1}^{v2/2}(-nc*v1*x/(2*(v1*x+v2))) /</span>
        <span class="c1">#             (B(v1/2, v2/2) * gamma((v1+v2)/2))</span>
        <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span>
        <span class="n">term</span> <span class="o">=</span> <span class="o">-</span><span class="n">nc</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">nc</span><span class="o">*</span><span class="n">n1</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">n2</span><span class="o">+</span><span class="n">n1</span><span class="o">*</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">n1</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">+</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">n2</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
        <span class="n">term</span> <span class="o">-=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">((</span><span class="n">n1</span><span class="o">+</span><span class="n">n2</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="n">Px</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
        <span class="n">Px</span> <span class="o">*=</span> <span class="n">n1</span><span class="o">**</span><span class="p">(</span><span class="n">n1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">n2</span><span class="o">**</span><span class="p">(</span><span class="n">n2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">n1</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">Px</span> <span class="o">*=</span> <span class="p">(</span><span class="n">n2</span><span class="o">+</span><span class="n">n1</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">n1</span><span class="o">+</span><span class="n">n2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">Px</span> <span class="o">*=</span> <span class="n">sc</span><span class="o">.</span><span class="n">assoc_laguerre</span><span class="p">(</span><span class="o">-</span><span class="n">nc</span><span class="o">*</span><span class="n">n1</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="n">n2</span><span class="o">+</span><span class="n">n1</span><span class="o">*</span><span class="n">x</span><span class="p">)),</span> <span class="n">n2</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">n1</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">Px</span> <span class="o">/=</span> <span class="n">sc</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">n1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">n2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># This function does not have a return.  Drop it for now, the generic</span>
        <span class="c1"># function seems to work OK.</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">ncfdtr</span><span class="p">(</span><span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">ncfdtri</span><span class="p">(</span><span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">dfn</span> <span class="o">*</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">dfd</span><span class="p">)</span><span class="o">**</span><span class="n">n</span>
        <span class="n">term</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dfn</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dfd</span><span class="o">-</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">dfd</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">nc</span> <span class="o">/</span> <span class="mf">2.0</span><span class="o">+</span><span class="n">term</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">*=</span> <span class="n">sc</span><span class="o">.</span><span class="n">hyp1f1</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dfn</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dfn</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">nc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="c1"># Note: the rv_continuous class ensures that dfn &gt; 0 when this function</span>
        <span class="c1"># is called, so we don&#39;t have  to check for division by zero with dfn</span>
        <span class="c1"># in the following.</span>
        <span class="n">mu_num</span> <span class="o">=</span> <span class="n">dfd</span> <span class="o">*</span> <span class="p">(</span><span class="n">dfn</span> <span class="o">+</span> <span class="n">nc</span><span class="p">)</span>
        <span class="n">mu_den</span> <span class="o">=</span> <span class="n">dfn</span> <span class="o">*</span> <span class="p">(</span><span class="n">dfd</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">mu_num</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">true_divide</span><span class="p">(</span><span class="n">mu_num</span><span class="p">,</span> <span class="n">mu_den</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">dfd</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">mu</span><span class="p">)</span>

        <span class="n">mu2_num</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">((</span><span class="n">dfn</span> <span class="o">+</span> <span class="n">nc</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">dfn</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">nc</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dfd</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">dfd</span><span class="o">/</span><span class="n">dfn</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">mu2_den</span> <span class="o">=</span> <span class="p">(</span><span class="n">dfd</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">dfd</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">mu2_num</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">true_divide</span><span class="p">(</span><span class="n">mu2_num</span><span class="p">,</span> <span class="n">mu2_den</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">dfd</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">mu2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>


<span class="n">ncf</span> <span class="o">=</span> <span class="n">ncf_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ncf&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">t_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Student&#39;s t continuous random variable.</span>

<span class="sd">    For the noncentral t distribution, see `nct`.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    nct</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `t` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, \nu) = \frac{\Gamma((\nu+1)/2)}</span>
<span class="sd">                        {\sqrt{\pi \nu} \Gamma(\nu/2)}</span>
<span class="sd">                    (1+x^2/\nu)^{-(\nu+1)/2}</span>

<span class="sd">    where :math:`x` is a real number and the degrees of freedom parameter</span>
<span class="sd">    :math:`\nu` (denoted ``df`` in the implementation) satisfies</span>
<span class="sd">    :math:`\nu &gt; 0`. :math:`\Gamma` is the gamma function</span>
<span class="sd">    (`scipy.special.gamma`).</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">df</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">standard_t</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="c1">#                                gamma((df+1)/2)</span>
        <span class="c1"># t.pdf(x, df) = ---------------------------------------------------</span>
        <span class="c1">#                sqrt(pi*df) * gamma(df/2) * (1+x**2/df)**((df+1)/2)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">df</span><span class="o">*</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">Px</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">((</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
              <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">r</span><span class="p">)</span><span class="o">**</span><span class="p">((</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">Px</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">df</span><span class="o">*</span><span class="mf">1.0</span>
        <span class="n">lPx</span> <span class="o">=</span> <span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">((</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
               <span class="o">-</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">r</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">lPx</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">stdtr</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">stdtr</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">stdtrit</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">stdtrit</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">df</span><span class="p">,),</span>
                         <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="o">-</span><span class="mf">2.0</span><span class="p">),</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">mu2</span><span class="p">)</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="n">df</span><span class="p">,),</span>
                        <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="mf">6.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="o">-</span><span class="mf">4.0</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">g2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="n">half</span> <span class="o">=</span> <span class="n">df</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">half1</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">half1</span><span class="o">*</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">digamma</span><span class="p">(</span><span class="n">half1</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">digamma</span><span class="p">(</span><span class="n">half</span><span class="p">))</span>
                <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">half</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)))</span>


<span class="n">t</span> <span class="o">=</span> <span class="n">t_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">nct_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A non-central Student&#39;s t continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    If :math:`Y` is a standard normal random variable and :math:`V` is</span>
<span class="sd">    an independent chi-square random variable (`chi2`) with :math:`k` degrees</span>
<span class="sd">    of freedom, then</span>

<span class="sd">    .. math::</span>

<span class="sd">        X = \frac{Y + c}{\sqrt{V/k}}</span>

<span class="sd">    has a non-central Student&#39;s t distribution on the real line.</span>
<span class="sd">    The degrees of freedom parameter :math:`k` (denoted ``df`` in the</span>
<span class="sd">    implementation) satisfies :math:`k &gt; 0` and the noncentrality parameter</span>
<span class="sd">    :math:`c` (denoted ``nc`` in the implementation) is a real number.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nc</span> <span class="o">==</span> <span class="n">nc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">nc</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">chi2</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">df</span><span class="o">*</span><span class="mf">1.0</span>
        <span class="n">nc</span> <span class="o">=</span> <span class="n">nc</span><span class="o">*</span><span class="mf">1.0</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span>
        <span class="n">ncx2</span> <span class="o">=</span> <span class="n">nc</span><span class="o">*</span><span class="n">nc</span><span class="o">*</span><span class="n">x2</span>
        <span class="n">fac1</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="n">x2</span>
        <span class="n">trm1</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="o">-</span> <span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">nc</span><span class="o">*</span><span class="n">nc</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">fac1</span><span class="p">)</span>
                   <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span>
        <span class="n">Px</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">trm1</span><span class="p">)</span>
        <span class="n">valF</span> <span class="o">=</span> <span class="n">ncx2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">fac1</span><span class="p">)</span>
        <span class="n">trm1</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">nc</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">hyp1f1</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">valF</span><span class="p">)</span>
                <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">fac1</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span>
        <span class="n">trm2</span> <span class="o">=</span> <span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">hyp1f1</span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">valF</span><span class="p">)</span>
                <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">fac1</span><span class="p">)</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
        <span class="n">Px</span> <span class="o">*=</span> <span class="n">trm1</span><span class="o">+</span><span class="n">trm2</span>
        <span class="k">return</span> <span class="n">Px</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">nctdtr</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">nctdtrit</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">moments</span><span class="o">=</span><span class="s1">&#39;mv&#39;</span><span class="p">):</span>
        <span class="c1">#</span>
        <span class="c1"># See D. Hogben, R.S. Pinkham, and M.B. Wilk,</span>
        <span class="c1"># &#39;The moments of the non-central t-distribution&#39;</span>
        <span class="c1"># Biometrika 48, p. 465 (2961).</span>
        <span class="c1"># e.g. https://www.jstor.org/stable/2332772 (gated)</span>
        <span class="c1">#</span>
        <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">gfac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">betaln</span><span class="p">(</span><span class="n">df</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
        <span class="n">c11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">df</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span> <span class="o">*</span> <span class="n">gfac</span>
        <span class="n">c20</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">df</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="o">-</span><span class="mf">2.</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">c22</span> <span class="o">=</span> <span class="n">c20</span> <span class="o">-</span> <span class="n">c11</span><span class="o">*</span><span class="n">c11</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nc</span><span class="o">*</span><span class="n">c11</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">c22</span><span class="o">*</span><span class="n">nc</span><span class="o">*</span><span class="n">nc</span> <span class="o">+</span> <span class="n">c20</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;s&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">c33t</span> <span class="o">=</span> <span class="n">df</span> <span class="o">*</span> <span class="p">(</span><span class="mf">7.</span><span class="o">-</span><span class="mf">2.</span><span class="o">*</span><span class="n">df</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="o">-</span><span class="mf">2.</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="o">-</span><span class="mf">3.</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2.</span><span class="o">*</span><span class="n">c11</span><span class="o">*</span><span class="n">c11</span>
            <span class="n">c31t</span> <span class="o">=</span> <span class="mf">3.</span><span class="o">*</span><span class="n">df</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="o">-</span><span class="mf">2.</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="o">-</span><span class="mf">3.</span><span class="p">)</span>
            <span class="n">mu3</span> <span class="o">=</span> <span class="p">(</span><span class="n">c33t</span><span class="o">*</span><span class="n">nc</span><span class="o">*</span><span class="n">nc</span> <span class="o">+</span> <span class="n">c31t</span><span class="p">)</span> <span class="o">*</span> <span class="n">c11</span><span class="o">*</span><span class="n">nc</span>
            <span class="n">g1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="n">mu3</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">mu2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="c1"># kurtosis</span>
        <span class="k">if</span> <span class="s1">&#39;k&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">c44</span> <span class="o">=</span> <span class="n">df</span><span class="o">*</span><span class="n">df</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="o">-</span><span class="mf">2.</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="o">-</span><span class="mf">4.</span><span class="p">)</span>
            <span class="n">c44</span> <span class="o">-=</span> <span class="n">c11</span><span class="o">*</span><span class="n">c11</span> <span class="o">*</span> <span class="mf">2.</span><span class="o">*</span><span class="n">df</span><span class="o">*</span><span class="p">(</span><span class="mf">5.</span><span class="o">-</span><span class="n">df</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="o">-</span><span class="mf">2.</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="o">-</span><span class="mf">3.</span><span class="p">)</span>
            <span class="n">c44</span> <span class="o">-=</span> <span class="mf">3.</span><span class="o">*</span><span class="n">c11</span><span class="o">**</span><span class="mi">4</span>
            <span class="n">c42</span> <span class="o">=</span> <span class="n">df</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="o">-</span><span class="mf">4.</span><span class="p">)</span> <span class="o">-</span> <span class="n">c11</span><span class="o">*</span><span class="n">c11</span> <span class="o">*</span> <span class="p">(</span><span class="n">df</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="o">-</span><span class="mf">3.</span><span class="p">)</span>
            <span class="n">c42</span> <span class="o">*=</span> <span class="mf">6.</span><span class="o">*</span><span class="n">df</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="o">-</span><span class="mf">2.</span><span class="p">)</span>
            <span class="n">c40</span> <span class="o">=</span> <span class="mf">3.</span><span class="o">*</span><span class="n">df</span><span class="o">*</span><span class="n">df</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="o">-</span><span class="mf">2.</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="o">-</span><span class="mf">4.</span><span class="p">)</span>

            <span class="n">mu4</span> <span class="o">=</span> <span class="n">c44</span> <span class="o">*</span> <span class="n">nc</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="n">c42</span><span class="o">*</span><span class="n">nc</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c40</span>
            <span class="n">g2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">,</span> <span class="n">mu4</span><span class="o">/</span><span class="n">mu2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">3.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>


<span class="n">nct</span> <span class="o">=</span> <span class="n">nct_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;nct&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">pareto_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Pareto continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `pareto` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, b) = \frac{b}{x^{b+1}}</span>

<span class="sd">    for :math:`x \ge 1`, :math:`b &gt; 0`.</span>

<span class="sd">    `pareto` takes ``b`` as a shape parameter for :math:`b`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># pareto.pdf(x, b) = b / x**(b+1)</span>
        <span class="k">return</span> <span class="n">b</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">q</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">moments</span><span class="o">=</span><span class="s1">&#39;mv&#39;</span><span class="p">):</span>
        <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;m&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">1</span>
            <span class="n">bt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">bt</span> <span class="o">/</span> <span class="p">(</span><span class="n">bt</span><span class="o">-</span><span class="mf">1.0</span><span class="p">))</span>
        <span class="k">if</span> <span class="s1">&#39;v&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">2</span>
            <span class="n">bt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="n">mu2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">mu2</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">bt</span> <span class="o">/</span> <span class="p">(</span><span class="n">bt</span><span class="o">-</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">bt</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;s&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">3</span>
            <span class="n">bt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="n">g1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">bt</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">bt</span> <span class="o">-</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">bt</span> <span class="o">-</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">bt</span><span class="p">))</span>
            <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;k&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">4</span>
            <span class="n">bt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="n">g2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="p">(</span><span class="mf">6.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">bt</span><span class="p">)</span> <span class="o">/</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">bt</span><span class="p">))</span>
            <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">g2</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">c</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="nd">@_call_super_mom</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">_check_fit_input_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">fshape</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">floc</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">fscale</span> <span class="k">if</span> <span class="n">fscale</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">FitDataError</span><span class="p">(</span><span class="s2">&quot;pareto&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">floc</span>

        <span class="c1"># Source: Evans, Hastings, and Peacock (2000), Statistical</span>
        <span class="c1"># Distributions, 3rd. Ed., John Wiley and Sons. Page 149.</span>

        <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fscale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fshape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fshape</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">data</span><span class="o">/</span><span class="n">fscale</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">fshape</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span>


<span class="n">pareto</span> <span class="o">=</span> <span class="n">pareto_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pareto&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">lomax_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Lomax (Pareto of the second kind) continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `lomax` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = \frac{c}{(1+x)^{c+1}}</span>

<span class="sd">    for :math:`x \ge 0`, :math:`c &gt; 0`.</span>

<span class="sd">    `lomax` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    `lomax` is a special case of `pareto` with ``loc=-1.0``.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># lomax.pdf(x, c) = c / (1+x)**(c+1)</span>
        <span class="k">return</span> <span class="n">c</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span> <span class="o">=</span> <span class="n">pareto</span><span class="o">.</span><span class="n">stats</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">loc</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">moments</span><span class="o">=</span><span class="s1">&#39;mvsk&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">+</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>


<span class="n">lomax</span> <span class="o">=</span> <span class="n">lomax_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;lomax&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">pearson3_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A pearson type III continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `pearson3` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, \kappa) = \frac{|\beta|}{\Gamma(\alpha)}</span>
<span class="sd">                       (\beta (x - \zeta))^{\alpha - 1}</span>
<span class="sd">                       \exp(-\beta (x - \zeta))</span>

<span class="sd">    where:</span>

<span class="sd">    .. math::</span>

<span class="sd">            \beta = \frac{2}{\kappa}</span>

<span class="sd">            \alpha = \beta^2 = \frac{4}{\kappa^2}</span>

<span class="sd">            \zeta = -\frac{\alpha}{\beta} = -\beta</span>

<span class="sd">    :math:`\Gamma` is the gamma function (`scipy.special.gamma`).</span>
<span class="sd">    Pass the skew :math:`\kappa` into `pearson3` as the shape parameter</span>
<span class="sd">    ``skew``.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    R.W. Vogel and D.E. McMartin, &quot;Probability Plot Goodness-of-Fit and</span>
<span class="sd">    Skewness Estimation Procedures for the Pearson Type 3 Distribution&quot;, Water</span>
<span class="sd">    Resources Research, Vol.27, 3149-3158 (1991).</span>

<span class="sd">    L.R. Salvosa, &quot;Tables of Pearson&#39;s Type III Function&quot;, Ann. Math. Statist.,</span>
<span class="sd">    Vol.1, 191-198 (1930).</span>

<span class="sd">    &quot;Using Modern Computing Tools to Fit the Pearson Type III Distribution to</span>
<span class="sd">    Aviation Loads Data&quot;, Office of Aviation Research (2003).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_preprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">skew</span><span class="p">):</span>
        <span class="c1"># The real &#39;loc&#39; and &#39;scale&#39; are handled in the calling pdf(...). The</span>
        <span class="c1"># local variables &#39;loc&#39; and &#39;scale&#39; within pearson3._pdf are set to</span>
        <span class="c1"># the defaults just to keep them as part of the equations for</span>
        <span class="c1"># documentation.</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="c1"># If skew is small, return _norm_pdf. The divide between pearson3</span>
        <span class="c1"># and norm was found by brute force and is approximately a skew of</span>
        <span class="c1"># 0.000016.  No one, I hope, would actually use a skew value even</span>
        <span class="c1"># close to this small.</span>
        <span class="n">norm2pearson_transition</span> <span class="o">=</span> <span class="mf">0.000016</span>

        <span class="n">ans</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">skew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">skew</span><span class="p">)</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="n">ans</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># mask is True where skew is small enough to use the normal approx.</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">skew</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">norm2pearson_transition</span>
        <span class="n">invmask</span> <span class="o">=</span> <span class="o">~</span><span class="n">mask</span>

        <span class="n">beta</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">skew</span><span class="p">[</span><span class="n">invmask</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">zeta</span> <span class="o">=</span> <span class="n">loc</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="n">beta</span>

        <span class="n">transx</span> <span class="o">=</span> <span class="n">beta</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">invmask</span><span class="p">]</span> <span class="o">-</span> <span class="n">zeta</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ans</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">transx</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">invmask</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">zeta</span>

    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skew</span><span class="p">):</span>
        <span class="c1"># The _argcheck function in rv_continuous only allows positive</span>
        <span class="c1"># arguments.  The skew argument for pearson3 can be zero (which I want</span>
        <span class="c1"># to handle inside pearson3._pdf) or negative.  So just return True</span>
        <span class="c1"># for all skew args.</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">skew</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skew</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">v</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">skew</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">skew</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">k</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">skew</span><span class="p">):</span>
        <span class="c1"># pearson3.pdf(x, skew) = abs(beta) / gamma(alpha) *</span>
        <span class="c1">#     (beta * (x - zeta))**(alpha - 1) * exp(-beta*(x - zeta))</span>
        <span class="c1"># Do the calculation in _logpdf since helps to limit</span>
        <span class="c1"># overflow/underflow problems</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">skew</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ans</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ans</span><span class="p">):</span>
                <span class="k">return</span> <span class="mf">0.0</span>
            <span class="k">return</span> <span class="n">ans</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ans</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="n">ans</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">skew</span><span class="p">):</span>
        <span class="c1">#   PEARSON3 logpdf                           GAMMA logpdf</span>
        <span class="c1">#   np.log(abs(beta))</span>
        <span class="c1"># + (alpha - 1)*np.log(beta*(x - zeta))          + (a - 1)*np.log(x)</span>
        <span class="c1"># - beta*(x - zeta)                           - x</span>
        <span class="c1"># - sc.gammalnalpha)                              - sc.gammalna)</span>
        <span class="n">ans</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">transx</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">invmask</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">skew</span><span class="p">))</span>

        <span class="n">ans</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">_norm_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">]))</span>
        <span class="c1"># use logpdf instead of _logpdf to fix issue mentioned in gh-12640</span>
        <span class="c1"># (_logpdf does not return correct result for alpha = 1)</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">invmask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span> <span class="o">+</span> <span class="n">gamma</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">transx</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ans</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">skew</span><span class="p">):</span>
        <span class="n">ans</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">transx</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">invmask</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">skew</span><span class="p">))</span>

        <span class="n">ans</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>

        <span class="n">skew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">skew</span><span class="p">,</span> <span class="n">invmask</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">invmask1a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">invmask</span><span class="p">,</span> <span class="n">skew</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">invmask1b</span> <span class="o">=</span> <span class="n">skew</span><span class="p">[</span><span class="n">invmask</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="c1"># use cdf instead of _cdf to fix issue mentioned in gh-12640</span>
        <span class="c1"># (_cdf produces NaNs for inputs outside support)</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">invmask1a</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">transx</span><span class="p">[</span><span class="n">invmask1b</span><span class="p">],</span> <span class="n">alpha</span><span class="p">[</span><span class="n">invmask1b</span><span class="p">])</span>

        <span class="c1"># The gamma._cdf approach wasn&#39;t working with negative skew.</span>
        <span class="c1"># Note that multiplying the skew by -1 reflects about x=0.</span>
        <span class="c1"># So instead of evaluating the CDF with negative skew at x,</span>
        <span class="c1"># evaluate the SF with positive skew at -x.</span>
        <span class="n">invmask2a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">invmask</span><span class="p">,</span> <span class="n">skew</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">invmask2b</span> <span class="o">=</span> <span class="n">skew</span><span class="p">[</span><span class="n">invmask</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span>
        <span class="c1"># gamma._sf produces NaNs when transx &lt; 0, so use gamma.sf</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">invmask2a</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">transx</span><span class="p">[</span><span class="n">invmask2b</span><span class="p">],</span> <span class="n">alpha</span><span class="p">[</span><span class="n">invmask2b</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">ans</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skew</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">skew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">skew</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="n">ans</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">invmask</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">zeta</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">skew</span><span class="p">))</span>

        <span class="n">nsmall</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">nbig</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="n">nsmall</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">nsmall</span><span class="p">)</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">invmask</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">standard_gamma</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">nbig</span><span class="p">)</span><span class="o">/</span><span class="n">beta</span> <span class="o">+</span> <span class="n">zeta</span>

        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="p">():</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">ans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ans</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">skew</span><span class="p">):</span>
        <span class="n">ans</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">invmask</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">zeta</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">skew</span><span class="p">))</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">_norm_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">invmask</span><span class="p">]</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">q</span><span class="p">[</span><span class="n">invmask</span><span class="p">])</span><span class="o">/</span><span class="n">beta</span> <span class="o">+</span> <span class="n">zeta</span>
        <span class="k">return</span> <span class="n">ans</span>

    <span class="nd">@_call_super_mom</span>
    <span class="nd">@extend_notes_in_docstring</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">        Note that method of moments (`method=&#39;MM&#39;`) is not</span>
<span class="s2">        available for this distribution.</span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;method&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;MM&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Fit `method=&#39;MM&#39;` is not available for &quot;</span>
                                      <span class="s2">&quot;the Pearson3 distribution. Please try &quot;</span>
                                      <span class="s2">&quot;the default `method=&#39;MLE&#39;`.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>


<span class="n">pearson3</span> <span class="o">=</span> <span class="n">pearson3_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;pearson3&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">powerlaw_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A power-function continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `powerlaw` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a) = a x^{a-1}</span>

<span class="sd">    for :math:`0 \le x \le 1`, :math:`a &gt; 0`.</span>

<span class="sd">    `powerlaw` takes ``a`` as a shape parameter for :math:`a`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    `powerlaw` is a special case of `beta` with ``b=1``.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="c1"># powerlaw.pdf(x, a) = a * x**(a-1)</span>
        <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">),</span>
                <span class="n">a</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span>
                <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="p">((</span><span class="n">a</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mf">3.0</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">a</span> <span class="o">+</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">a</span><span class="p">),</span>
                <span class="mi">6</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">a</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>


<span class="n">powerlaw</span> <span class="o">=</span> <span class="n">powerlaw_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;powerlaw&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">powerlognorm_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A power log-normal continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `powerlognorm` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c, s) = \frac{c}{x s} \phi(\log(x)/s)</span>
<span class="sd">                     (\Phi(-\log(x)/s))^{c-1}</span>

<span class="sd">    where :math:`\phi` is the normal pdf, and :math:`\Phi` is the normal cdf,</span>
<span class="sd">    and :math:`x &gt; 0`, :math:`s, c &gt; 0`.</span>

<span class="sd">    `powerlognorm` takes :math:`c` and :math:`s` as shape parameters.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="c1"># powerlognorm.pdf(x, c, s) = c / (x*s) * phi(log(x)/s) *</span>
        <span class="c1">#                                         (Phi(-log(x)/s))**(c-1),</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">c</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">s</span><span class="p">)</span> <span class="o">*</span> <span class="n">_norm_pdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">s</span><span class="p">)</span> <span class="o">*</span>
                <span class="nb">pow</span><span class="p">(</span><span class="n">_norm_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">s</span><span class="p">),</span> <span class="n">c</span><span class="o">*</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">1.0</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="nb">pow</span><span class="p">(</span><span class="n">_norm_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">s</span><span class="p">),</span> <span class="n">c</span><span class="o">*</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">s</span> <span class="o">*</span> <span class="n">_norm_ppf</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">q</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">c</span><span class="p">)))</span>


<span class="n">powerlognorm</span> <span class="o">=</span> <span class="n">powerlognorm_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;powerlognorm&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">powernorm_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A power normal continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `powernorm` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = c \phi(x) (\Phi(-x))^{c-1}</span>

<span class="sd">    where :math:`\phi` is the normal pdf, and :math:`\Phi` is the normal cdf,</span>
<span class="sd">    and :math:`x &gt;= 0`, :math:`c &gt; 0`.</span>

<span class="sd">    `powernorm` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># powernorm.pdf(x, c) = c * phi(x) * (Phi(-x))**(c-1)</span>
        <span class="k">return</span> <span class="n">c</span><span class="o">*</span><span class="n">_norm_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">_norm_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mf">1.0</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">_norm_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">_norm_logcdf</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">_norm_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">_norm_ppf</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">q</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">c</span><span class="p">))</span>


<span class="n">powernorm</span> <span class="o">=</span> <span class="n">powernorm_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;powernorm&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">rdist_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;An R-distributed (symmetric beta) continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `rdist` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = \frac{(1-x^2)^{c/2-1}}{B(1/2, c/2)}</span>

<span class="sd">    for :math:`-1 \le x \le 1`, :math:`c &gt; 0`. `rdist` is also called the</span>
<span class="sd">    symmetric beta distribution: if B has a `beta` distribution with</span>
<span class="sd">    parameters (c/2, c/2), then X = 2*B - 1 follows a R-distribution with</span>
<span class="sd">    parameter c.</span>

<span class="sd">    `rdist` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    This distribution includes the following distribution kernels as</span>
<span class="sd">    special cases::</span>

<span class="sd">        c = 2:  uniform</span>
<span class="sd">        c = 3:  `semicircular`</span>
<span class="sd">        c = 4:  Epanechnikov (parabolic)</span>
<span class="sd">        c = 6:  quartic (biweight)</span>
<span class="sd">        c = 8:  triweight</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># use relation to the beta distribution for pdf, cdf, etc</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">beta</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">((</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">beta</span><span class="o">.</span><span class="n">_cdf</span><span class="p">((</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">beta</span><span class="o">.</span><span class="n">_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">random_state</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">numerator</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">beta</span><span class="p">((</span><span class="n">n</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">c</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">sc</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">c</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>


<span class="n">rdist</span> <span class="o">=</span> <span class="n">rdist_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rdist&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_rayleigh_fit_check_error</span><span class="p">(</span><span class="n">ier</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ier</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;rayleigh.fit: fsolve failed to find the root of &#39;</span>
                           <span class="s1">&#39;the first-order conditions of the log-likelihood &#39;</span>
                           <span class="sa">f</span><span class="s1">&#39;function: </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s1"> (ier=</span><span class="si">{</span><span class="n">ier</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">rayleigh_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Rayleigh continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `rayleigh` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = x \exp(-x^2/2)</span>

<span class="sd">    for :math:`x \ge 0`.</span>

<span class="sd">    `rayleigh` is a special case of `chi` with ``df=2``.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">chi</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="c1"># rayleigh.pdf(r) = r * exp(-r**2/2)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">r</span> <span class="o">*</span> <span class="n">r</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logsf</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">r</span> <span class="o">*</span> <span class="n">r</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span>
                <span class="n">val</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="n">val</span><span class="o">**</span><span class="mf">1.5</span><span class="p">,</span>
                <span class="mi">6</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">val</span><span class="o">-</span><span class="mi">16</span><span class="o">/</span><span class="n">val</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_EULER</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="nd">@_call_super_mom</span>
    <span class="nd">@extend_notes_in_docstring</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">        Notes specifically for ``rayleigh.fit``: If the location is fixed with</span>
<span class="s2">        the `floc` parameter, this method uses an analytical formula to find</span>
<span class="s2">        the scale.  Otherwise, this function uses a numerical root finder on</span>
<span class="s2">        the first order conditions of the log-likelihood function to find the</span>
<span class="s2">        MLE.  Only the (optional) `loc` parameter is used as the initial guess</span>
<span class="s2">        for the root finder; the `scale` parameter and any other parameters</span>
<span class="s2">        for the optimizer are ignored.</span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span> <span class="o">=</span> <span class="n">_check_fit_input_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
                                                         <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">scale_mle</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="c1"># Source: Statistical Distributions, 3rd Edition. Evans, Hastings,</span>
            <span class="c1"># and Peacock (2000), Page 175</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">data</span> <span class="o">-</span> <span class="n">loc</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span> <span class="o">**</span> <span class="mf">.5</span>

        <span class="k">def</span> <span class="nf">loc_mle</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="c1"># This implicit equation for `loc` is used when</span>
            <span class="c1"># both `loc` and `scale` are free.</span>
            <span class="n">xm</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">loc</span>
            <span class="n">s1</span> <span class="o">=</span> <span class="n">xm</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">s2</span> <span class="o">=</span> <span class="p">(</span><span class="n">xm</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">s3</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">xm</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">s1</span> <span class="o">-</span> <span class="n">s2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="o">*</span><span class="n">s3</span>

        <span class="k">def</span> <span class="nf">loc_mle_scale_fixed</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="c1"># This implicit equation for `loc` is used when</span>
            <span class="c1"># `scale` is fixed but `loc` is not.</span>
            <span class="n">xm</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">loc</span>
            <span class="k">return</span> <span class="n">xm</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="n">scale</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">xm</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># `loc` is fixed, analytically determine `scale`.</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">floc</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">FitDataError</span><span class="p">(</span><span class="s2">&quot;rayleigh&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">floc</span><span class="p">,</span> <span class="n">scale_mle</span><span class="p">(</span><span class="n">floc</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="c1"># Account for user provided guess of `loc`.</span>
        <span class="n">loc0</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">loc0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Use _fitstart to estimate loc; ignore the returned scale.</span>
            <span class="n">loc0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fitstart</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># `scale` is fixed</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">ier</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">fsolve</span><span class="p">(</span><span class="n">loc_mle_scale_fixed</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">loc0</span><span class="p">,</span>
                                                <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">fscale</span><span class="p">,</span> <span class="n">data</span><span class="p">,),</span>
                                                <span class="n">xtol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">_rayleigh_fit_check_error</span><span class="p">(</span><span class="n">ier</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fscale</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Neither `loc` nor `scale` are fixed.</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">ier</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">fsolve</span><span class="p">(</span><span class="n">loc_mle</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">loc0</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">data</span><span class="p">,),</span>
                                                <span class="n">xtol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">_rayleigh_fit_check_error</span><span class="p">(</span><span class="n">ier</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">scale_mle</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">)</span>


<span class="n">rayleigh</span> <span class="o">=</span> <span class="n">rayleigh_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rayleigh&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">reciprocal_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A loguniform or reciprocal continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for this class is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a, b) = \frac{1}{x \log(b/a)}</span>

<span class="sd">    for :math:`a \le x \le b`, :math:`b &gt; a &gt; 0`. This class takes</span>
<span class="sd">    :math:`a` and :math:`b` as shape parameters.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    This doesn&#39;t show the equal probability of ``0.01``, ``0.1`` and</span>
<span class="sd">    ``1``. This is best when the x-axis is log-scaled:</span>

<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(1, 1)</span>
<span class="sd">    &gt;&gt;&gt; ax.hist(np.log10(r))</span>
<span class="sd">    &gt;&gt;&gt; ax.set_ylabel(&quot;Frequency&quot;)</span>
<span class="sd">    &gt;&gt;&gt; ax.set_xlabel(&quot;Value of random variable&quot;)</span>
<span class="sd">    &gt;&gt;&gt; ax.xaxis.set_major_locator(plt.FixedLocator([-2, -1, 0]))</span>
<span class="sd">    &gt;&gt;&gt; ticks = [&quot;$10^{{ {} }}$&quot;.format(i) for i in [-2, -1, 0]]</span>
<span class="sd">    &gt;&gt;&gt; ax.set_xticklabels(ticks)  # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; plt.show()</span>

<span class="sd">    This random variable will be log-uniform regardless of the base chosen for</span>
<span class="sd">    ``a`` and ``b``. Let&#39;s specify with base ``2`` instead:</span>

<span class="sd">    &gt;&gt;&gt; rvs = %(name)s(2**-2, 2**0).rvs(size=1000)</span>

<span class="sd">    Values of ``1/4``, ``1/2`` and ``1`` are equally likely with this random</span>
<span class="sd">    variable.  Here&#39;s the histogram:</span>

<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(1, 1)</span>
<span class="sd">    &gt;&gt;&gt; ax.hist(np.log2(rvs))</span>
<span class="sd">    &gt;&gt;&gt; ax.set_ylabel(&quot;Frequency&quot;)</span>
<span class="sd">    &gt;&gt;&gt; ax.set_xlabel(&quot;Value of random variable&quot;)</span>
<span class="sd">    &gt;&gt;&gt; ax.xaxis.set_major_locator(plt.FixedLocator([-2, -1, 0]))</span>
<span class="sd">    &gt;&gt;&gt; ticks = [&quot;$2^{{ {} }}$&quot;.format(i) for i in [-2, -1, 0]]</span>
<span class="sd">    &gt;&gt;&gt; ax.set_xticklabels(ticks)  # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; plt.show()</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_support</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># reciprocal.pdf(x, a, b) = 1 / (x*log(b/a))</span>
        <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">a</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">a</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="nb">pow</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="n">a</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="n">a</span><span class="p">))</span>


<span class="n">loguniform</span> <span class="o">=</span> <span class="n">reciprocal_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;loguniform&quot;</span><span class="p">)</span>
<span class="n">reciprocal</span> <span class="o">=</span> <span class="n">reciprocal_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;reciprocal&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">rice_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Rice continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `rice` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, b) = x \exp(- \frac{x^2 + b^2}{2}) I_0(x b)</span>

<span class="sd">    for :math:`x &gt;= 0`, :math:`b &gt; 0`. :math:`I_0` is the modified Bessel</span>
<span class="sd">    function of order zero (`scipy.special.i0`).</span>

<span class="sd">    `rice` takes ``b`` as a shape parameter for :math:`b`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    The Rice distribution describes the length, :math:`r`, of a 2-D vector with</span>
<span class="sd">    components :math:`(U+u, V+v)`, where :math:`U, V` are constant, :math:`u,</span>
<span class="sd">    v` are independent Gaussian random variables with standard deviation</span>
<span class="sd">    :math:`s`.  Let :math:`R = \sqrt{U^2 + V^2}`. Then the pdf of :math:`r` is</span>
<span class="sd">    ``rice.pdf(x, R/s, scale=s)``.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">b</span> <span class="o">&gt;=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># https://en.wikipedia.org/wiki/Rice_distribution</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">b</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">random_state</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span> <span class="o">+</span> <span class="n">size</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">t</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">chndtr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">chndtrix</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">b</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># rice.pdf(x, b) = x * exp(-(x**2+b**2)/2) * I[0](x*b)</span>
        <span class="c1">#</span>
        <span class="c1"># We use (x**2 + b**2)/2 = ((x-b)**2)/2 + xb.</span>
        <span class="c1"># The factor of np.exp(-xb) is then included in the i0e function</span>
        <span class="c1"># in place of the modified Bessel function, i0, improving</span>
        <span class="c1"># numerical stability for large values of xb.</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">i0e</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">nd2</span> <span class="o">=</span> <span class="n">n</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">nd2</span>
        <span class="n">b2</span> <span class="o">=</span> <span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">**</span><span class="p">(</span><span class="n">nd2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span> <span class="o">*</span>
                <span class="n">sc</span><span class="o">.</span><span class="n">hyp1f1</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b2</span><span class="p">))</span>


<span class="n">rice</span> <span class="o">=</span> <span class="n">rice_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rice&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">recipinvgauss_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A reciprocal inverse Gaussian continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `recipinvgauss` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, \mu) = \frac{1}{\sqrt{2\pi x}}</span>
<span class="sd">                    \exp\left(\frac{-(1-\mu x)^2}{2\mu^2x}\right)</span>

<span class="sd">    for :math:`x \ge 0`.</span>

<span class="sd">    `recipinvgauss` takes ``mu`` as a shape parameter for :math:`\mu`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="c1"># recipinvgauss.pdf(x, mu) =</span>
        <span class="c1">#                     1/sqrt(2*pi*x) * exp(-(1-mu*x)**2/(2*x*mu**2))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">),</span>
                          <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">mu</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">mu</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span>
                                         <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)),</span>
                          <span class="n">fillvalue</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="n">trm1</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">mu</span> <span class="o">-</span> <span class="n">x</span>
        <span class="n">trm2</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">mu</span> <span class="o">+</span> <span class="n">x</span>
        <span class="n">isqx</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">isqx</span><span class="o">*</span><span class="n">trm1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">mu</span><span class="p">)</span><span class="o">*</span><span class="n">_norm_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">isqx</span><span class="o">*</span><span class="n">trm2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="n">trm1</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">mu</span> <span class="o">-</span> <span class="n">x</span>
        <span class="n">trm2</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">mu</span> <span class="o">+</span> <span class="n">x</span>
        <span class="n">isqx</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">isqx</span><span class="o">*</span><span class="n">trm1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">mu</span><span class="p">)</span><span class="o">*</span><span class="n">_norm_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">isqx</span><span class="o">*</span><span class="n">trm2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">random_state</span><span class="o">.</span><span class="n">wald</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>


<span class="n">recipinvgauss</span> <span class="o">=</span> <span class="n">recipinvgauss_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;recipinvgauss&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">semicircular_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A semicircular continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    rdist</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `semicircular` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{2}{\pi} \sqrt{1-x^2}</span>

<span class="sd">    for :math:`-1 \le x \le 1`.</span>

<span class="sd">    The distribution is a special case of `rdist` with `c = 3`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] &quot;Wigner semicircle distribution&quot;,</span>
<span class="sd">           https://en.wikipedia.org/wiki/Wigner_semicircle_distribution</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span><span class="o">+</span><span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">rdist</span><span class="o">.</span><span class="n">_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># generate values uniformly distributed on the area under the pdf</span>
        <span class="c1"># (semi-circle) by randomly generating the radius and angle</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">))</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">r</span> <span class="o">*</span> <span class="n">a</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.64472988584940017414</span>


<span class="n">semicircular</span> <span class="o">=</span> <span class="n">semicircular_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;semicircular&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">skewcauchy_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A skewed Cauchy random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    cauchy : Cauchy distribution</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    The probability density function for `skewcauchy` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{1}{\pi \left(\frac{x^2}{\left(a\, \text{sign}(x) + 1</span>
<span class="sd">                                                   \right)^2} + 1 \right)}</span>

<span class="sd">    for a real number :math:`x` and skewness parameter :math:`-1 &lt; a &lt; 1`.</span>

<span class="sd">    When :math:`a=0`, the distribution reduces to the usual Cauchy</span>
<span class="sd">    distribution.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] &quot;Skewed generalized *t* distribution&quot;, Wikipedia</span>
<span class="sd">       https://en.wikipedia.org/wiki/Skewed_generalized_t_distribution#Skewed_Cauchy_distribution</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">)),</span>
                        <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cdf</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">i</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">moments</span><span class="o">=</span><span class="s1">&#39;mvsk&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># Use 0 as the initial guess of the skewness shape parameter.</span>
        <span class="c1"># For the location and scale, estimate using the median and</span>
        <span class="c1"># quartiles.</span>
        <span class="n">p25</span><span class="p">,</span> <span class="n">p50</span><span class="p">,</span> <span class="n">p75</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">])</span>
        <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">p50</span><span class="p">,</span> <span class="p">(</span><span class="n">p75</span> <span class="o">-</span> <span class="n">p25</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>


<span class="n">skewcauchy</span> <span class="o">=</span> <span class="n">skewcauchy_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;skewcauchy&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">skew_norm_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A skew-normal random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The pdf is::</span>

<span class="sd">        skewnorm.pdf(x, a) = 2 * norm.pdf(x) * norm.cdf(a*x)</span>

<span class="sd">    `skewnorm` takes a real number :math:`a` as a skewness parameter</span>
<span class="sd">    When ``a = 0`` the distribution is identical to a normal distribution</span>
<span class="sd">    (`norm`). `rvs` implements the method of [1]_.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] A. Azzalini and A. Capitanio (1999). Statistical applications of the</span>
<span class="sd">        multivariate skew-normal distribution. J. Roy. Statist. Soc., B 61, 579-602.</span>
<span class="sd">        :arxiv:`0911.2093`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">2.</span><span class="o">*</span><span class="n">_norm_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">_norm_cdf</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_support</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cdf</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pdf</span><span class="p">,</span> <span class="n">_a</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pdf</span><span class="p">,</span> <span class="n">_a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">t2</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pdf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">cdf</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">+</span> <span class="n">t2</span>
        <span class="k">if</span> <span class="n">cdf</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Presumably numerical noise, e.g. 1.0000000000000002</span>
            <span class="n">cdf</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">return</span> <span class="n">cdf</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">u0</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">a</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="n">d</span><span class="o">*</span><span class="n">u0</span> <span class="o">+</span> <span class="n">v</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">u0</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> <span class="o">-</span><span class="n">u1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">moments</span><span class="o">=</span><span class="s1">&#39;mvsk&#39;</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">const</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">a</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;m&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">const</span>
        <span class="k">if</span> <span class="s1">&#39;v&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">const</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">if</span> <span class="s1">&#39;s&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="mi">4</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">const</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">const</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="mi">3</span>
        <span class="k">if</span> <span class="s1">&#39;k&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">const</span><span class="o">**</span><span class="mi">4</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">const</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span>


<span class="n">skewnorm</span> <span class="o">=</span> <span class="n">skew_norm_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;skewnorm&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">trapezoid_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A trapezoidal continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The trapezoidal distribution can be represented with an up-sloping line</span>
<span class="sd">    from ``loc`` to ``(loc + c*scale)``, then constant to ``(loc + d*scale)``</span>
<span class="sd">    and then downsloping from ``(loc + d*scale)`` to ``(loc+scale)``.  This</span>
<span class="sd">    defines the trapezoid base from ``loc`` to ``(loc+scale)`` and the flat</span>
<span class="sd">    top from ``c`` to ``d`` proportional to the position along the base</span>
<span class="sd">    with ``0 &lt;= c &lt;= d &lt;= 1``.  When ``c=d``, this is equivalent to `triang`</span>
<span class="sd">    with the same values for `loc`, `scale` and `c`.</span>
<span class="sd">    The method of [1]_ is used for computing moments.</span>

<span class="sd">    `trapezoid` takes :math:`c` and :math:`d` as shape parameters.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    The standard form is in the range [0, 1] with c the mode.</span>
<span class="sd">    The location parameter shifts the start to `loc`.</span>
<span class="sd">    The scale parameter changes the width from 1 to `scale`.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Kacker, R.N. and Lawrence, J.F. (2007). Trapezoidal and triangular</span>
<span class="sd">       distributions for Type B evaluation of standard uncertainty.</span>
<span class="sd">       Metrologia 44, 117-127. :doi:`10.1088/0026-1394/44/2/003`</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;=</span> <span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_lazyselect</span><span class="p">([</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">c</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">),</span>
                            <span class="n">x</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">],</span>
                           <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">u</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="n">c</span><span class="p">,</span>
                            <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">u</span><span class="p">,</span>
                            <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">u</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">d</span><span class="p">)],</span>
                            <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">u</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_lazyselect</span><span class="p">([</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">c</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">),</span>
                            <span class="n">x</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">],</span>
                           <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">c</span> <span class="o">/</span> <span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                            <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">c</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                            <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="mi">1</span><span class="o">-</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                                               <span class="o">/</span> <span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">d</span><span class="p">))],</span>
                            <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">qc</span><span class="p">,</span> <span class="n">qd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cdf</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cdf</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
        <span class="n">condlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span> <span class="o">&lt;</span> <span class="n">qc</span><span class="p">,</span> <span class="n">q</span> <span class="o">&lt;=</span> <span class="n">qd</span><span class="p">,</span> <span class="n">q</span> <span class="o">&gt;</span> <span class="n">qd</span><span class="p">]</span>
        <span class="n">choicelist</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">d</span> <span class="o">-</span> <span class="n">c</span><span class="p">)),</span>
                      <span class="mf">0.5</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">d</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">c</span><span class="p">,</span>
                      <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">d</span><span class="p">))]</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">condlist</span><span class="p">,</span> <span class="n">choicelist</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="c1"># Using the parameterization from Kacker, 2007, with</span>
        <span class="c1"># a=bottom left, c=top left, d=top right, b=bottom right, then</span>
        <span class="c1">#     E[X^n] = h/(n+1)/(n+2) [(b^{n+2}-d^{n+2})/(b-d)</span>
        <span class="c1">#                             - ((c^{n+2} - a^{n+2})/(c-a)]</span>
        <span class="c1"># with h = 2/((b-a) - (d-c)). The corresponding parameterization</span>
        <span class="c1"># in scipy, has a&#39;=loc, c&#39;=loc+c*scale, d&#39;=loc+d*scale, b&#39;=loc+scale,</span>
        <span class="c1"># which for standard form reduces to a&#39;=0, b&#39;=1, c&#39;=c, d&#39;=d.</span>
        <span class="c1"># Substituting into E[X^n] gives the bd&#39; term as (1 - d^{n+2})/(1 - d)</span>
        <span class="c1"># and the ac&#39; term as c^{n-1} for the standard form. The bd&#39; term has</span>
        <span class="c1"># numerical difficulties near d=1, so replace (1 - d^{n+2})/(1-d)</span>
        <span class="c1"># with expm1((n+2)*log(d))/(d-1).</span>
        <span class="c1"># Testing with n=18 for c=(1e-30,1-eps) shows that this is stable.</span>
        <span class="c1"># We still require an explicit test for d=1 to prevent divide by zero,</span>
        <span class="c1"># and now a test for d=0 to prevent log(0).</span>
        <span class="n">ab_term</span> <span class="o">=</span> <span class="n">c</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">dc_term</span> <span class="o">=</span> <span class="n">_lazyselect</span><span class="p">(</span>
            <span class="p">[</span><span class="n">d</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;</span> <span class="n">d</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">d</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">],</span>
            <span class="p">[</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
             <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">d</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="mf">1.0</span><span class="p">),</span>
             <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span>
            <span class="p">[</span><span class="n">d</span><span class="p">])</span>
        <span class="n">val</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">d</span><span class="o">-</span><span class="n">c</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">dc_term</span> <span class="o">-</span> <span class="n">ab_term</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="c1"># Using the parameterization from Wikipedia (van Dorp, 2003)</span>
        <span class="c1"># with a=bottom left, c=top left, d=top right, b=bottom right</span>
        <span class="c1"># gives a&#39;=loc, b&#39;=loc+c*scale, c&#39;=loc+d*scale, d&#39;=loc+scale,</span>
        <span class="c1"># which for loc=0, scale=1 is a&#39;=0, b&#39;=c, c&#39;=d, d&#39;=1.</span>
        <span class="c1"># Substituting into the entropy formula from Wikipedia gives</span>
        <span class="c1"># the following result.</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">d</span><span class="o">+</span><span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">d</span><span class="o">-</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">d</span><span class="o">-</span><span class="n">c</span><span class="p">))</span>


<span class="n">trapezoid</span> <span class="o">=</span> <span class="n">trapezoid_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;trapezoid&quot;</span><span class="p">)</span>
<span class="c1"># Note: alias kept for backwards compatibility. Rename was done</span>
<span class="c1"># because trapz is a slur in colloquial English (see gh-12924).</span>
<span class="n">trapz</span> <span class="o">=</span> <span class="n">trapezoid_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;trapz&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">trapz</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">:</span>
    <span class="n">trapz</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;trapz is an alias for `trapezoid`&quot;</span>


<span class="k">class</span> <span class="nc">triang_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A triangular continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The triangular distribution can be represented with an up-sloping line from</span>
<span class="sd">    ``loc`` to ``(loc + c*scale)`` and then downsloping for ``(loc + c*scale)``</span>
<span class="sd">    to ``(loc + scale)``.</span>

<span class="sd">    `triang` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    The standard form is in the range [0, 1] with c the mode.</span>
<span class="sd">    The location parameter shifts the start to `loc`.</span>
<span class="sd">    The scale parameter changes the width from 1 to `scale`.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">triangular</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># 0: edge case where c=0</span>
        <span class="c1"># 1: generalised case for x &lt; c, don&#39;t use x &lt;= c, as it doesn&#39;t cope</span>
        <span class="c1">#    with c = 0.</span>
        <span class="c1"># 2: generalised case for x &gt;= c, but doesn&#39;t cope with c = 1</span>
        <span class="c1"># 3: edge case where c=1</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">_lazyselect</span><span class="p">([</span><span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
                         <span class="n">x</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">,</span>
                         <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">c</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">),</span>
                         <span class="n">c</span> <span class="o">==</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span>
                         <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="n">c</span><span class="p">,</span>
                         <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">c</span><span class="p">),</span>
                         <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">],</span>
                        <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">r</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">_lazyselect</span><span class="p">([</span><span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
                         <span class="n">x</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">,</span>
                         <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">c</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">),</span>
                         <span class="n">c</span> <span class="o">==</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">,</span>
                         <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="n">c</span><span class="p">,</span>
                         <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                         <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">],</span>
                        <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">r</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">q</span><span class="p">),</span> <span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">c</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">q</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">c</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span>
                <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">c</span><span class="o">+</span><span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="mi">18</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">((</span><span class="mf">1.0</span><span class="o">-</span><span class="n">c</span><span class="o">+</span><span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="p">),</span> <span class="mf">1.5</span><span class="p">)),</span>
                <span class="o">-</span><span class="mf">3.0</span><span class="o">/</span><span class="mf">5.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


<span class="n">triang</span> <span class="o">=</span> <span class="n">triang_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;triang&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">truncexpon_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A truncated exponential continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `truncexpon` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, b) = \frac{\exp(-x)}{1 - \exp(-b)}</span>

<span class="sd">    for :math:`0 &lt;= x &lt;= b`.</span>

<span class="sd">    `truncexpon` takes ``b`` as a shape parameter for :math:`b`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_get_support</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># truncexpon.pdf(x, b) = exp(-x) / (1-exp(-b))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># wrong answer with formula, same as in continuous.pdf</span>
        <span class="c1"># return sc.gamman+1)-sc.gammainc1+n, b)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">b</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># return generic for higher moments</span>
            <span class="c1"># return rv_continuous._mom1_sc(self, n, b)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mom1_sc</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">eB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">eB</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">eB</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mf">1.0</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">eB</span><span class="p">)</span>


<span class="n">truncexpon</span> <span class="o">=</span> <span class="n">truncexpon_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;truncexpon&#39;</span><span class="p">)</span>


<span class="n">TRUNCNORM_TAIL_X</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">TRUNCNORM_MAX_BRENT_ITERS</span> <span class="o">=</span> <span class="mi">40</span>


<span class="k">def</span> <span class="nf">_truncnorm_get_delta_scalar</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">TRUNCNORM_TAIL_X</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">b</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">TRUNCNORM_TAIL_X</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">_norm_sf</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">_norm_sf</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">delta</span>


<span class="k">def</span> <span class="nf">_truncnorm_get_delta</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_truncnorm_get_delta_scalar</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_truncnorm_get_delta_scalar</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">b</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
    <span class="n">condinner</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;=</span> <span class="n">TRUNCNORM_TAIL_X</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">TRUNCNORM_TAIL_X</span><span class="p">)</span>
    <span class="n">conda</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">condinner</span>
    <span class="n">condb</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">condinner</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">conda</span><span class="p">):</span>
        <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">conda</span><span class="p">,</span> <span class="n">_norm_sf</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">conda</span><span class="p">])</span> <span class="o">-</span> <span class="n">_norm_sf</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">conda</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">condb</span><span class="p">):</span>
        <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">condb</span><span class="p">,</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">condb</span><span class="p">])</span> <span class="o">-</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">condb</span><span class="p">]))</span>
    <span class="n">delta</span><span class="p">[</span><span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">delta</span>


<span class="k">def</span> <span class="nf">_truncnorm_get_logdelta_scalar</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;=</span> <span class="n">TRUNCNORM_TAIL_X</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">TRUNCNORM_TAIL_X</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">_norm_sf</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">_norm_sf</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">b</span><span class="p">)):</span>
        <span class="n">nla</span><span class="p">,</span> <span class="n">nlb</span> <span class="o">=</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">logdelta</span> <span class="o">=</span> <span class="n">nlb</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">nla</span> <span class="o">-</span> <span class="n">nlb</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sla</span><span class="p">,</span> <span class="n">slb</span> <span class="o">=</span> <span class="n">_norm_logsf</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">_norm_logsf</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">logdelta</span> <span class="o">=</span> <span class="n">sla</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">slb</span> <span class="o">-</span> <span class="n">sla</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">logdelta</span>


<span class="k">def</span> <span class="nf">_truncnorm_logpdf_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">shp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
        <span class="n">condlta</span><span class="p">,</span> <span class="n">condgtb</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">condlta</span><span class="p">):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">condlta</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">condgtb</span><span class="p">):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">condgtb</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="n">cond_inner</span> <span class="o">=</span> <span class="o">~</span><span class="n">condlta</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">condgtb</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">cond_inner</span><span class="p">):</span>
            <span class="n">_logdelta</span> <span class="o">=</span> <span class="n">_truncnorm_get_logdelta_scalar</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">cond_inner</span><span class="p">,</span> <span class="n">_norm_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">cond_inner</span><span class="p">])</span> <span class="o">-</span> <span class="n">_logdelta</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">shp</span> <span class="o">==</span> <span class="p">())</span> <span class="k">else</span> <span class="n">out</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_truncnorm_pdf_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">:</span>
                <span class="k">return</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">:</span>
                <span class="k">return</span> <span class="mf">0.0</span>
        <span class="n">shp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
        <span class="n">condlta</span><span class="p">,</span> <span class="n">condgtb</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">condlta</span><span class="p">):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">condlta</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">condgtb</span><span class="p">):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">condgtb</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">cond_inner</span> <span class="o">=</span> <span class="o">~</span><span class="n">condlta</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">condgtb</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">cond_inner</span><span class="p">):</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">_truncnorm_get_delta_scalar</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">cond_inner</span><span class="p">,</span> <span class="n">_norm_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">cond_inner</span><span class="p">])</span> <span class="o">/</span> <span class="n">delta</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">cond_inner</span><span class="p">,</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">_truncnorm_logpdf_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">cond_inner</span><span class="p">],</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">shp</span> <span class="o">==</span> <span class="p">())</span> <span class="k">else</span> <span class="n">out</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_truncnorm_logcdf_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>
        <span class="n">shp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
        <span class="n">condlea</span><span class="p">,</span> <span class="n">condgeb</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">condlea</span><span class="p">):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">condlea</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">condgeb</span><span class="p">):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">condgeb</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">cond_inner</span> <span class="o">=</span> <span class="o">~</span><span class="n">condlea</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">condgeb</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">cond_inner</span><span class="p">):</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">_truncnorm_get_delta_scalar</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">cond_inner</span><span class="p">,</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="n">_norm_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">cond_inner</span><span class="p">])</span> <span class="o">-</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
                                <span class="o">/</span> <span class="n">delta</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">nla</span><span class="p">,</span> <span class="n">nlb</span> <span class="o">=</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                        <span class="n">tab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">nla</span> <span class="o">-</span> <span class="n">nlb</span><span class="p">))</span>
                        <span class="n">nlx</span> <span class="o">=</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">cond_inner</span><span class="p">])</span>
                        <span class="n">tax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">nla</span> <span class="o">-</span> <span class="n">nlx</span><span class="p">))</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">cond_inner</span><span class="p">,</span> <span class="n">nlx</span> <span class="o">+</span> <span class="n">tax</span> <span class="o">-</span> <span class="p">(</span><span class="n">nlb</span> <span class="o">+</span> <span class="n">tab</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sla</span> <span class="o">=</span> <span class="n">_norm_logsf</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                        <span class="n">slb</span> <span class="o">=</span> <span class="n">_norm_logsf</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">cond_inner</span><span class="p">,</span>
                                 <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">_norm_logsf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">cond_inner</span><span class="p">])</span>
                                                  <span class="o">-</span> <span class="n">sla</span><span class="p">))</span>
                                 <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">slb</span> <span class="o">-</span> <span class="n">sla</span><span class="p">)))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">shp</span> <span class="o">==</span> <span class="p">())</span> <span class="k">else</span> <span class="n">out</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_truncnorm_cdf_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">0</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">1</span>
        <span class="n">shp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
        <span class="n">condlea</span><span class="p">,</span> <span class="n">condgeb</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">condlea</span><span class="p">):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">condlea</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">condgeb</span><span class="p">):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">condgeb</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">cond_inner</span> <span class="o">=</span> <span class="o">~</span><span class="n">condlea</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">condgeb</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">cond_inner</span><span class="p">):</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">_truncnorm_get_delta_scalar</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">cond_inner</span><span class="p">,</span>
                         <span class="p">(</span><span class="n">_norm_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">cond_inner</span><span class="p">])</span> <span class="o">-</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="o">/</span> <span class="n">delta</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">cond_inner</span><span class="p">,</span>
                             <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">_truncnorm_logcdf_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">cond_inner</span><span class="p">],</span>
                                                             <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">shp</span> <span class="o">==</span> <span class="p">())</span> <span class="k">else</span> <span class="n">out</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_truncnorm_logsf_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="p">:</span>
                <span class="k">return</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">shp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>

        <span class="n">condlea</span><span class="p">,</span> <span class="n">condgeb</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">condlea</span><span class="p">):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">condlea</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">condgeb</span><span class="p">):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">condgeb</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="n">cond_inner</span> <span class="o">=</span> <span class="o">~</span><span class="n">condlea</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">condgeb</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">cond_inner</span><span class="p">):</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">_truncnorm_get_delta_scalar</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">cond_inner</span><span class="p">,</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="n">_norm_sf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">cond_inner</span><span class="p">])</span> <span class="o">-</span> <span class="n">_norm_sf</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
                                <span class="o">/</span> <span class="n">delta</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">nla</span><span class="p">,</span> <span class="n">nlb</span> <span class="o">=</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">cond_inner</span><span class="p">,</span>
                                 <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">cond_inner</span><span class="p">])</span>
                                                  <span class="o">-</span> <span class="n">nlb</span><span class="p">))</span>
                                 <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">nla</span> <span class="o">-</span> <span class="n">nlb</span><span class="p">)))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sla</span><span class="p">,</span> <span class="n">slb</span> <span class="o">=</span> <span class="n">_norm_logsf</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">_norm_logsf</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                        <span class="n">tab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">slb</span> <span class="o">-</span> <span class="n">sla</span><span class="p">))</span>
                        <span class="n">slx</span> <span class="o">=</span> <span class="n">_norm_logsf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">cond_inner</span><span class="p">])</span>
                        <span class="n">tax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">slb</span> <span class="o">-</span> <span class="n">slx</span><span class="p">))</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">cond_inner</span><span class="p">,</span> <span class="n">slx</span> <span class="o">+</span> <span class="n">tax</span> <span class="o">-</span> <span class="p">(</span><span class="n">sla</span> <span class="o">+</span> <span class="n">tab</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">shp</span> <span class="o">==</span> <span class="p">())</span> <span class="k">else</span> <span class="n">out</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_truncnorm_sf_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="p">:</span>
                <span class="k">return</span> <span class="mf">1.0</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">:</span>
                <span class="k">return</span> <span class="mf">0.0</span>
        <span class="n">shp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>

        <span class="n">condlea</span><span class="p">,</span> <span class="n">condgeb</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">condlea</span><span class="p">):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">condlea</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">condgeb</span><span class="p">):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">condgeb</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">cond_inner</span> <span class="o">=</span> <span class="o">~</span><span class="n">condlea</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">condgeb</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">cond_inner</span><span class="p">):</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">_truncnorm_get_delta_scalar</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">cond_inner</span><span class="p">,</span>
                         <span class="p">(</span><span class="n">_norm_sf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">cond_inner</span><span class="p">])</span> <span class="o">-</span> <span class="n">_norm_sf</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="o">/</span> <span class="n">delta</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">cond_inner</span><span class="p">,</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">_truncnorm_logsf_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">cond_inner</span><span class="p">],</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">shp</span> <span class="o">==</span> <span class="p">())</span> <span class="k">else</span> <span class="n">out</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_norm_logcdfprime</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
    <span class="c1"># derivative of special.log_ndtr (See special/cephes/ndtr.c)</span>
    <span class="c1"># Differentiate formula for log Phi(z)_truncnorm_ppf</span>
    <span class="c1"># log Phi(z) = -z^2/2 - log(-z) - log(2pi)/2</span>
    <span class="c1">#              + log(1 + sum (-1)^n (2n-1)!! / z^(2n))</span>
    <span class="c1"># Convergence of series is slow for |z| &lt; 10, but can use</span>
    <span class="c1">#     d(log Phi(z))/dz = dPhi(z)/dz / Phi(z)</span>
    <span class="c1"># Just take the first 10 terms because that is sufficient for use</span>
    <span class="c1"># in _norm_ilogcdf</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">z</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">lhs</span> <span class="o">=</span> <span class="o">-</span><span class="n">z</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">z</span>
    <span class="n">denom_cons</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">numerator</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">pwr</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">denom_total</span><span class="p">,</span> <span class="n">numerator_total</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">):</span>
        <span class="n">pwr</span> <span class="o">*=</span> <span class="n">denom_cons</span>
        <span class="n">numerator</span> <span class="o">*=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">term</span> <span class="o">=</span> <span class="n">sign</span> <span class="o">*</span> <span class="n">numerator</span> <span class="o">*</span> <span class="n">pwr</span>
        <span class="n">denom_total</span> <span class="o">+=</span> <span class="n">term</span>
        <span class="n">numerator_total</span> <span class="o">+=</span> <span class="n">term</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="n">z</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="n">sign</span>
    <span class="k">return</span> <span class="n">lhs</span> <span class="o">-</span> <span class="n">numerator_total</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">denom_total</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_norm_ilogcdf</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Inverse function to _norm_logcdf==sc.log_ndtr.&quot;&quot;&quot;</span>
    <span class="c1"># Apply approximate Newton-Raphson</span>
    <span class="c1"># Only use for very negative values of y.</span>
    <span class="c1"># At minimum requires y &lt;= -(log(2pi)+2^2)/2 ~= -2.9</span>
    <span class="c1"># Much better convergence for y &lt;= -10</span>
    <span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">z</span> <span class="o">-</span> <span class="p">(</span><span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">_norm_logcdfprime</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">z</span>


<span class="k">def</span> <span class="nf">_truncnorm_ppf_scalar</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">shp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
    <span class="n">condle0</span><span class="p">,</span> <span class="n">condge1</span> <span class="o">=</span> <span class="p">(</span><span class="n">q</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">q</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">condle0</span><span class="p">):</span>
        <span class="n">out</span><span class="p">[</span><span class="n">condle0</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">condge1</span><span class="p">):</span>
        <span class="n">out</span><span class="p">[</span><span class="n">condge1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">_truncnorm_get_delta_scalar</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">cond_inner</span> <span class="o">=</span> <span class="o">~</span><span class="n">condle0</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">condge1</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">cond_inner</span><span class="p">):</span>
        <span class="n">qinner</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">cond_inner</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sa</span><span class="p">,</span> <span class="n">sb</span> <span class="o">=</span> <span class="n">_norm_sf</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">_norm_sf</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">cond_inner</span><span class="p">,</span>
                         <span class="n">_norm_isf</span><span class="p">(</span><span class="n">qinner</span> <span class="o">*</span> <span class="n">sb</span> <span class="o">+</span> <span class="n">sa</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">qinner</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">na</span><span class="p">,</span> <span class="n">nb</span> <span class="o">=</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">cond_inner</span><span class="p">,</span>
                         <span class="n">_norm_ppf</span><span class="p">(</span><span class="n">qinner</span> <span class="o">*</span> <span class="n">nb</span> <span class="o">+</span> <span class="n">na</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">qinner</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">cond_inner</span><span class="p">,</span>
                     <span class="o">-</span><span class="n">_norm_ilogcdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">qinner</span><span class="p">)</span> <span class="o">+</span> <span class="n">_norm_logsf</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">cond_inner</span><span class="p">,</span>
                     <span class="n">_norm_ilogcdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">b</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Solve</span>
                <span class="c1"># norm_logcdf(x)</span>
                <span class="c1">#      = norm_logcdf(a) + log1p(q * (expm1(norm_logcdf(b)</span>
                <span class="c1">#                                    - norm_logcdf(a)))</span>
                <span class="c1">#      = nla + log1p(q * expm1(nlb - nla))</span>
                <span class="c1">#      = nlb + log(q) + log1p((1-q) * exp(nla - nlb)/q)</span>
                <span class="k">def</span> <span class="nf">_f_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">c</span>

                <span class="n">nla</span><span class="p">,</span> <span class="n">nlb</span> <span class="o">=</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">nlb</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">cond_inner</span><span class="p">])</span>
                <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">nla</span> <span class="o">-</span> <span class="n">nlb</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">C</span><span class="p">:</span>
                    <span class="n">one_minus_q</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">q</span><span class="p">)[</span><span class="n">cond_inner</span><span class="p">]</span>
                    <span class="n">values</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">one_minus_q</span> <span class="o">*</span> <span class="n">C</span> <span class="o">/</span> <span class="n">q</span><span class="p">[</span><span class="n">cond_inner</span><span class="p">])</span>
                <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">optimize</span><span class="o">.</span><span class="n">_zeros_py</span><span class="o">.</span><span class="n">brentq</span><span class="p">(</span><span class="n">_f_cdf</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">c</span><span class="p">,),</span>
                                           <span class="n">maxiter</span><span class="o">=</span><span class="n">TRUNCNORM_MAX_BRENT_ITERS</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
                <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">cond_inner</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Solve</span>
                <span class="c1"># norm_logsf(x)</span>
                <span class="c1">#      = norm_logsf(b) + log1p((1-q) * (expm1(norm_logsf(a)</span>
                <span class="c1">#                                       - norm_logsf(b)))</span>
                <span class="c1">#      = slb + log1p((1-q)[cond_inner] * expm1(sla - slb))</span>
                <span class="c1">#      = sla + log(1-q) + log1p(q * np.exp(slb - sla)/(1-q))</span>
                <span class="k">def</span> <span class="nf">_f_sf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">_norm_logsf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">c</span>

                <span class="n">sla</span><span class="p">,</span> <span class="n">slb</span> <span class="o">=</span> <span class="n">_norm_logsf</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">_norm_logsf</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                <span class="n">one_minus_q</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">q</span><span class="p">)[</span><span class="n">cond_inner</span><span class="p">]</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">sla</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">one_minus_q</span><span class="p">)</span>
                <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">slb</span> <span class="o">-</span> <span class="n">sla</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">C</span><span class="p">:</span>
                    <span class="n">values</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">cond_inner</span><span class="p">]</span> <span class="o">*</span> <span class="n">C</span> <span class="o">/</span> <span class="n">one_minus_q</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">optimize</span><span class="o">.</span><span class="n">_zeros_py</span><span class="o">.</span><span class="n">brentq</span><span class="p">(</span><span class="n">_f_sf</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">c</span><span class="p">,),</span>
                                           <span class="n">maxiter</span><span class="o">=</span><span class="n">TRUNCNORM_MAX_BRENT_ITERS</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
                <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">cond_inner</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">out</span><span class="p">[</span><span class="n">out</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
        <span class="n">out</span><span class="p">[</span><span class="n">out</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">shp</span> <span class="o">==</span> <span class="p">())</span> <span class="k">else</span> <span class="n">out</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">truncnorm_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A truncated normal continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The standard form of this distribution is a standard normal truncated to</span>
<span class="sd">    the range [a, b] --- notice that a and b are defined over the domain of the</span>
<span class="sd">    standard normal.  To convert clip values for a specific mean and standard</span>
<span class="sd">    deviation, use::</span>

<span class="sd">        a, b = (myclip_a - my_mean) / my_std, (myclip_b - my_mean) / my_std</span>

<span class="sd">    `truncnorm` takes :math:`a` and :math:`b` as shape parameters.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">_get_support</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_truncnorm_pdf_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_truncnorm_pdf_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">b</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
        <span class="n">it</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="p">[],</span>
                       <span class="p">[[</span><span class="s1">&#39;readonly&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;readonly&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;readonly&#39;</span><span class="p">],</span>
                        <span class="p">[</span><span class="s1">&#39;writeonly&#39;</span><span class="p">,</span> <span class="s1">&#39;allocate&#39;</span><span class="p">]])</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">,</span> <span class="n">_ld</span><span class="p">)</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
            <span class="n">_ld</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">_truncnorm_pdf_scalar</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">it</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_truncnorm_logpdf_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_truncnorm_logpdf_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">b</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
        <span class="n">it</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="p">[],</span>
                       <span class="p">[[</span><span class="s1">&#39;readonly&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;readonly&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;readonly&#39;</span><span class="p">],</span>
                        <span class="p">[</span><span class="s1">&#39;writeonly&#39;</span><span class="p">,</span> <span class="s1">&#39;allocate&#39;</span><span class="p">]])</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">,</span> <span class="n">_ld</span><span class="p">)</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
            <span class="n">_ld</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">_truncnorm_logpdf_scalar</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">it</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_truncnorm_cdf_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_truncnorm_cdf_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">b</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
        <span class="n">out</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">it</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">out</span><span class="p">],</span> <span class="p">[],</span>
                       <span class="p">[[</span><span class="s1">&#39;readonly&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;readonly&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;readonly&#39;</span><span class="p">],</span>
                        <span class="p">[</span><span class="s1">&#39;writeonly&#39;</span><span class="p">,</span> <span class="s1">&#39;allocate&#39;</span><span class="p">]])</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">,</span> <span class="n">_p</span><span class="p">)</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
            <span class="n">_p</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">_truncnorm_cdf_scalar</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">it</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_truncnorm_logcdf_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_truncnorm_logcdf_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">b</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
        <span class="n">it</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="p">[],</span>
                       <span class="p">[[</span><span class="s1">&#39;readonly&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;readonly&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;readonly&#39;</span><span class="p">],</span>
                        <span class="p">[</span><span class="s1">&#39;writeonly&#39;</span><span class="p">,</span> <span class="s1">&#39;allocate&#39;</span><span class="p">]])</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">,</span> <span class="n">_p</span><span class="p">)</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
            <span class="n">_p</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">_truncnorm_logcdf_scalar</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">it</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_truncnorm_sf_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_truncnorm_sf_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">b</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
        <span class="n">out</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">it</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">out</span><span class="p">],</span> <span class="p">[],</span>
                       <span class="p">[[</span><span class="s1">&#39;readonly&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;readonly&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;readonly&#39;</span><span class="p">],</span>
                        <span class="p">[</span><span class="s1">&#39;writeonly&#39;</span><span class="p">,</span> <span class="s1">&#39;allocate&#39;</span><span class="p">]])</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">,</span> <span class="n">_p</span><span class="p">)</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
            <span class="n">_p</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">_truncnorm_sf_scalar</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">it</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_truncnorm_logsf_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_truncnorm_logsf_scalar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">b</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
        <span class="n">out</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">it</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">out</span><span class="p">],</span> <span class="p">[],</span>
                       <span class="p">[[</span><span class="s1">&#39;readonly&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;readonly&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;readonly&#39;</span><span class="p">],</span>
                        <span class="p">[</span><span class="s1">&#39;writeonly&#39;</span><span class="p">,</span> <span class="s1">&#39;allocate&#39;</span><span class="p">]])</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">,</span> <span class="n">_p</span><span class="p">)</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
            <span class="n">_p</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">_truncnorm_logsf_scalar</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">it</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_truncnorm_ppf_scalar</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_truncnorm_ppf_scalar</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">b</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>

        <span class="n">out</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">it</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">([</span><span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">out</span><span class="p">],</span> <span class="p">[],</span>
                       <span class="p">[[</span><span class="s1">&#39;readonly&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;readonly&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;readonly&#39;</span><span class="p">],</span>
                        <span class="p">[</span><span class="s1">&#39;writeonly&#39;</span><span class="p">,</span> <span class="s1">&#39;allocate&#39;</span><span class="p">]])</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">_q</span><span class="p">,</span> <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">,</span> <span class="n">_x</span><span class="p">)</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
            <span class="n">_x</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">_truncnorm_ppf_scalar</span><span class="p">(</span><span class="n">_q</span><span class="p">,</span> <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">it</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">n_th_moment</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Returns n-th moment. Defined only if n &gt;= 0.</span>
<span class="sd">            Function cannot broadcast due to the loop over n</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">pA</span><span class="p">,</span> <span class="n">pB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pdf</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="n">pA</span><span class="p">,</span> <span class="o">-</span><span class="n">pB</span><span class="p">]</span>
            <span class="n">moments</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="c1"># a or b might be infinite, and the corresponding pdf value</span>
                <span class="c1"># is 0 in that case, but nan is returned for the</span>
                <span class="c1"># multiplication.  However, as b-&gt;infinity,  pdf(b)*b**k -&gt; 0.</span>
                <span class="c1"># So it is safe to use _lazywhere to avoid the nan.</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]],</span>
                                  <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="o">**</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">fillvalue</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">mk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">moments</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">moments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mk</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">moments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">((</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">b</span> <span class="o">==</span> <span class="n">b</span><span class="p">),</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">n_th_moment</span><span class="p">,</span> <span class="n">otypes</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">moments</span><span class="o">=</span><span class="s1">&#39;mv&#39;</span><span class="p">):</span>
        <span class="n">pA</span><span class="p">,</span> <span class="n">pB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]),</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_truncnorm_stats_scalar</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">pA</span><span class="p">,</span> <span class="n">pB</span><span class="p">,</span> <span class="n">moments</span><span class="p">):</span>
            <span class="n">m1</span> <span class="o">=</span> <span class="n">pA</span> <span class="o">-</span> <span class="n">pB</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="n">m1</span>
            <span class="c1"># use _lazywhere to avoid nan (See detailed comment in _munp)</span>
            <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="n">pA</span><span class="p">,</span> <span class="o">-</span><span class="n">pB</span><span class="p">]</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">,</span>
                              <span class="n">fillvalue</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">m2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">mu</span><span class="p">,</span> <span class="n">b</span><span class="o">-</span><span class="n">mu</span><span class="p">]],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">,</span>
                              <span class="n">fillvalue</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># mu2 = m2 - mu**2, but not as numerically stable as:</span>
            <span class="c1"># mu2 = (a-mu)*pA - (b-mu)*pB + 1</span>
            <span class="n">mu2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
                              <span class="n">fillvalue</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">m3</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">m1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
                              <span class="n">fillvalue</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">m4</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">m2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

            <span class="n">mu3</span> <span class="o">=</span> <span class="n">m3</span> <span class="o">+</span> <span class="n">m1</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">m2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">m1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">g1</span> <span class="o">=</span> <span class="n">mu3</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">mu2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
            <span class="n">mu4</span> <span class="o">=</span> <span class="n">m4</span> <span class="o">+</span> <span class="n">m1</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">m3</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">m1</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">m2</span> <span class="o">-</span> <span class="n">m1</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">g2</span> <span class="o">=</span> <span class="n">mu4</span> <span class="o">/</span> <span class="n">mu2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">3</span>
            <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

        <span class="n">_truncnorm_stats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">_truncnorm_stats_scalar</span><span class="p">,</span>
                                        <span class="n">excluded</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;moments&#39;</span><span class="p">,))</span>
        <span class="k">return</span> <span class="n">_truncnorm_stats</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">pA</span><span class="p">,</span> <span class="n">pB</span><span class="p">,</span> <span class="n">moments</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># if a and b are scalar, use _rvs_scalar, otherwise need to create</span>
        <span class="c1"># output by iterating over parameters</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs_scalar</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs_scalar</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">b</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">size</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># When this method is called, size will be a (possibly empty)</span>
            <span class="c1"># tuple of integers.  It will not be None; if `size=None` is passed</span>
            <span class="c1"># to `rvs()`, size will be the empty tuple ().</span>

            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="c1"># a and b now have the same shape.</span>

            <span class="c1"># `shp` is the shape of the blocks of random variates that are</span>
            <span class="c1"># generated for each combination of parameters associated with</span>
            <span class="c1"># broadcasting a and b.</span>
            <span class="c1"># bc is a tuple the same length as size.  The values</span>
            <span class="c1"># in bc are bools.  If bc[j] is True, it means that</span>
            <span class="c1"># entire axis is filled in for a given combination of the</span>
            <span class="c1"># broadcast arguments.</span>
            <span class="n">shp</span><span class="p">,</span> <span class="n">bc</span> <span class="o">=</span> <span class="n">_check_shape</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

            <span class="c1"># `numsamples` is the total number of variates to be generated</span>
            <span class="c1"># for each combination of the input arguments.</span>
            <span class="n">numsamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shp</span><span class="p">))</span>

            <span class="c1"># `out` is the array to be returned.  It is filled in in the</span>
            <span class="c1"># loop below.</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

            <span class="n">it</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span>
                           <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;multi_index&#39;</span><span class="p">],</span>
                           <span class="n">op_flags</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;readonly&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;readonly&#39;</span><span class="p">]])</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">it</span><span class="o">.</span><span class="n">finished</span><span class="p">:</span>
                <span class="c1"># Convert the iterator&#39;s multi_index into an index into the</span>
                <span class="c1"># `out` array where the call to _rvs_scalar() will be stored.</span>
                <span class="c1"># Where bc is True, we use a full slice; otherwise we use the</span>
                <span class="c1"># index value from it.multi_index.  len(it.multi_index) might</span>
                <span class="c1"># be less than len(bc), and in that case we want to align these</span>
                <span class="c1"># two sequences to the right, so the loop variable j runs from</span>
                <span class="c1"># -len(size) to 0.  This doesn&#39;t cause an IndexError, as</span>
                <span class="c1"># bc[j] will be True in those cases where it.multi_index[j]</span>
                <span class="c1"># would cause an IndexError.</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">it</span><span class="o">.</span><span class="n">multi_index</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">bc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">else</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
                            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">size</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
                <span class="n">out</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs_scalar</span><span class="p">(</span><span class="n">it</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">it</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">numsamples</span><span class="p">,</span>
                                            <span class="n">random_state</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shp</span><span class="p">)</span>
                <span class="n">it</span><span class="o">.</span><span class="n">iternext</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="p">():</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">_rvs_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">numsamples</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">numsamples</span><span class="p">:</span>
            <span class="n">numsamples</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># prepare sampling of rvs</span>
        <span class="n">size1d</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">numsamples</span><span class="p">))</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">size1d</span><span class="p">)</span>  <span class="c1"># number of rvs needed, reshape upon return</span>
        <span class="c1"># Calculate some rvs</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ppf</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">rvs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">size1d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rvs</span>


<span class="n">truncnorm</span> <span class="o">=</span> <span class="n">truncnorm_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;truncnorm&#39;</span><span class="p">,</span> <span class="n">momtype</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">tukeylambda_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Tukey-Lamdba continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    A flexible distribution, able to represent and interpolate between the</span>
<span class="sd">    following distributions:</span>

<span class="sd">    - Cauchy                (:math:`lambda = -1`)</span>
<span class="sd">    - logistic              (:math:`lambda = 0`)</span>
<span class="sd">    - approx Normal         (:math:`lambda = 0.14`)</span>
<span class="sd">    - uniform from -1 to 1  (:math:`lambda = 1`)</span>

<span class="sd">    `tukeylambda` takes a real number :math:`lambda` (denoted ``lam``</span>
<span class="sd">    in the implementation) as a shape parameter.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lam</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">lam</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">lam</span><span class="p">):</span>
        <span class="n">Fx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">tklmbda</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lam</span><span class="p">))</span>
        <span class="n">Px</span> <span class="o">=</span> <span class="n">Fx</span><span class="o">**</span><span class="p">(</span><span class="n">lam</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Fx</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="n">lam</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">Px</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">Px</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">lam</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lam</span><span class="p">)),</span> <span class="n">Px</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">lam</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">tklmbda</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lam</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">lam</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">boxcox</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">lam</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">boxcox1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">,</span> <span class="n">lam</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lam</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="n">_tlvar</span><span class="p">(</span><span class="n">lam</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">_tlkurt</span><span class="p">(</span><span class="n">lam</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lam</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">integ</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">lam</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="nb">pow</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">,</span> <span class="n">lam</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">integ</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>


<span class="n">tukeylambda</span> <span class="o">=</span> <span class="n">tukeylambda_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;tukeylambda&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FitUniformFixedScaleDataError</span><span class="p">(</span><span class="n">FitDataError</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ptp</span><span class="p">,</span> <span class="n">fscale</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Invalid values in `data`.  Maximum likelihood estimation with &quot;</span>
            <span class="s2">&quot;the uniform distribution and fixed scale requires that &quot;</span>
            <span class="s2">&quot;data.ptp() &lt;= fscale, but data.ptp() = </span><span class="si">%r</span><span class="s2"> and fscale = </span><span class="si">%r</span><span class="s2">.&quot;</span> <span class="o">%</span>
            <span class="p">(</span><span class="n">ptp</span><span class="p">,</span> <span class="n">fscale</span><span class="p">),</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">uniform_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A uniform continuous random variable.</span>

<span class="sd">    In the standard form, the distribution is uniform on ``[0, 1]``. Using</span>
<span class="sd">    the parameters ``loc`` and ``scale``, one obtains the uniform distribution</span>
<span class="sd">    on ``[loc, loc + scale]``.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">q</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="nd">@_call_super_mom</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Maximum likelihood estimate for the location and scale parameters.</span>

<span class="sd">        `uniform.fit` uses only the following parameters.  Because exact</span>
<span class="sd">        formulas are used, the parameters related to optimization that are</span>
<span class="sd">        available in the `fit` method of other distributions are ignored</span>
<span class="sd">        here.  The only positional argument accepted is `data`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : array_like</span>
<span class="sd">            Data to use in calculating the maximum likelihood estimate.</span>
<span class="sd">        floc : float, optional</span>
<span class="sd">            Hold the location parameter fixed to the specified value.</span>
<span class="sd">        fscale : float, optional</span>
<span class="sd">            Hold the scale parameter fixed to the specified value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        loc, scale : float</span>
<span class="sd">            Maximum likelihood estimates for the location and scale.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        An error is raised if `floc` is given and any values in `data` are</span>
<span class="sd">        less than `floc`, or if `fscale` is given and `fscale` is less</span>
<span class="sd">        than ``data.max() - data.min()``.  An error is also raised if both</span>
<span class="sd">        `floc` and `fscale` are given.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from scipy.stats import uniform</span>

<span class="sd">        We&#39;ll fit the uniform distribution to `x`:</span>

<span class="sd">        &gt;&gt;&gt; x = np.array([2, 2.5, 3.1, 9.5, 13.0])</span>

<span class="sd">        For a uniform distribution MLE, the location is the minimum of the</span>
<span class="sd">        data, and the scale is the maximum minus the minimum.</span>

<span class="sd">        &gt;&gt;&gt; loc, scale = uniform.fit(x)</span>
<span class="sd">        &gt;&gt;&gt; loc</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; scale</span>
<span class="sd">        11.0</span>

<span class="sd">        If we know the data comes from a uniform distribution where the support</span>
<span class="sd">        starts at 0, we can use `floc=0`:</span>

<span class="sd">        &gt;&gt;&gt; loc, scale = uniform.fit(x, floc=0)</span>
<span class="sd">        &gt;&gt;&gt; loc</span>
<span class="sd">        0.0</span>
<span class="sd">        &gt;&gt;&gt; scale</span>
<span class="sd">        13.0</span>

<span class="sd">        Alternatively, if we know the length of the support is 12, we can use</span>
<span class="sd">        `fscale=12`:</span>

<span class="sd">        &gt;&gt;&gt; loc, scale = uniform.fit(x, fscale=12)</span>
<span class="sd">        &gt;&gt;&gt; loc</span>
<span class="sd">        1.5</span>
<span class="sd">        &gt;&gt;&gt; scale</span>
<span class="sd">        12.0</span>

<span class="sd">        In that last example, the support interval is [1.5, 13.5].  This</span>
<span class="sd">        solution is not unique.  For example, the distribution with ``loc=2``</span>
<span class="sd">        and ``scale=12`` has the same likelihood as the one above.  When</span>
<span class="sd">        `fscale` is given and it is larger than ``data.max() - data.min()``,</span>
<span class="sd">        the parameters returned by the `fit` method center the support over</span>
<span class="sd">        the interval ``[data.min(), data.max()]``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Too many arguments.&quot;</span><span class="p">)</span>

        <span class="n">floc</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;floc&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">fscale</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fscale&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">_remove_optimizer_parameters</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># This check is for consistency with `rv_continuous.fit`.</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All parameters fixed. There is nothing to &quot;</span>
                             <span class="s2">&quot;optimize.&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;The data contains non-finite values.&quot;</span><span class="p">)</span>

        <span class="c1"># MLE for the uniform distribution</span>
        <span class="c1"># --------------------------------</span>
        <span class="c1"># The PDF is</span>
        <span class="c1">#</span>
        <span class="c1">#     f(x, loc, scale) = {1/scale  for loc &lt;= x &lt;= loc + scale</span>
        <span class="c1">#                        {0        otherwise}</span>
        <span class="c1">#</span>
        <span class="c1"># The likelihood function is</span>
        <span class="c1">#     L(x, loc, scale) = (1/scale)**n</span>
        <span class="c1"># where n is len(x), assuming loc &lt;= x &lt;= loc + scale for all x.</span>
        <span class="c1"># The log-likelihood is</span>
        <span class="c1">#     l(x, loc, scale) = -n*log(scale)</span>
        <span class="c1"># The log-likelihood is maximized by making scale as small as possible,</span>
        <span class="c1"># while keeping loc &lt;= x &lt;= loc + scale.   So if neither loc nor scale</span>
        <span class="c1"># are fixed, the log-likelihood is maximized by choosing</span>
        <span class="c1">#     loc = x.min()</span>
        <span class="c1">#     scale = x.ptp()</span>
        <span class="c1"># If loc is fixed, it must be less than or equal to x.min(), and then</span>
        <span class="c1"># the scale is</span>
        <span class="c1">#     scale = x.max() - loc</span>
        <span class="c1"># If scale is fixed, it must not be less than x.ptp().  If scale is</span>
        <span class="c1"># greater than x.ptp(), the solution is not unique.  Note that the</span>
        <span class="c1"># likelihood does not depend on loc, except for the requirement that</span>
        <span class="c1"># loc &lt;= x &lt;= loc + scale.  All choices of loc for which</span>
        <span class="c1">#     x.max() - scale &lt;= loc &lt;= x.min()</span>
        <span class="c1"># have the same log-likelihood.  In this case, we choose loc such that</span>
        <span class="c1"># the support is centered over the interval [data.min(), data.max()]:</span>
        <span class="c1">#     loc = x.min() = 0.5*(scale - x.ptp())</span>

        <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># scale is not fixed.</span>
            <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># loc is not fixed, scale is not fixed.</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">ptp</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># loc is fixed, scale is not fixed.</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">floc</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">loc</span>
                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">loc</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">FitDataError</span><span class="p">(</span><span class="s2">&quot;uniform&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">loc</span> <span class="o">+</span> <span class="n">scale</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># loc is not fixed, scale is fixed.</span>
            <span class="n">ptp</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">ptp</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">ptp</span> <span class="o">&gt;</span> <span class="n">fscale</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FitUniformFixedScaleDataError</span><span class="p">(</span><span class="n">ptp</span><span class="o">=</span><span class="n">ptp</span><span class="p">,</span> <span class="n">fscale</span><span class="o">=</span><span class="n">fscale</span><span class="p">)</span>
            <span class="c1"># If ptp &lt; fscale, the ML estimate is not unique; see the comments</span>
            <span class="c1"># above.  We choose the distribution for which the support is</span>
            <span class="c1"># centered over the interval [data.min(), data.max()].</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">fscale</span> <span class="o">-</span> <span class="n">ptp</span><span class="p">)</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">fscale</span>

        <span class="c1"># We expect the return values to be floating point, so ensure it</span>
        <span class="c1"># by explicitly converting to float.</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">loc</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>


<span class="n">uniform</span> <span class="o">=</span> <span class="n">uniform_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;uniform&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">vonmises_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Von Mises continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `vonmises` and `vonmises_line` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, \kappa) = \frac{ \exp(\kappa \cos(x)) }{ 2 \pi I_0(\kappa) }</span>

<span class="sd">    for :math:`-\pi \le x \le \pi`, :math:`\kappa &gt; 0`. :math:`I_0` is the</span>
<span class="sd">    modified Bessel function of order zero (`scipy.special.i0`).</span>

<span class="sd">    `vonmises` is a circular distribution which does not restrict the</span>
<span class="sd">    distribution to a fixed interval. Currently, there is no circular</span>
<span class="sd">    distribution framework in scipy. The ``cdf`` is implemented such that</span>
<span class="sd">    ``cdf(x + 2*np.pi) == cdf(x) + 1``.</span>

<span class="sd">    `vonmises_line` is the same distribution, defined on :math:`[-\pi, \pi]`</span>
<span class="sd">    on the real line. This is a regular (i.e. non-circular) distribution.</span>

<span class="sd">    `vonmises` and `vonmises_line` take ``kappa`` as a shape parameter.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">vonmises</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="c1"># vonmises.pdf(x, kappa) = exp(kappa * cos(x)) / (2*pi*I[0](kappa))</span>
        <span class="c1">#                        = exp(kappa * (cos(x) - 1)) /</span>
        <span class="c1">#                          (2*pi*exp(-kappa)*I[0](kappa))</span>
        <span class="c1">#                        = exp(kappa * cosm1(x)) / (2*pi*i0e(kappa))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">kappa</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">cosm1</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">i0e</span><span class="p">(</span><span class="n">kappa</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_stats</span><span class="o">.</span><span class="n">von_mises_cdf</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats_skip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">i1</span><span class="p">(</span><span class="n">kappa</span><span class="p">)</span> <span class="o">/</span> <span class="n">sc</span><span class="o">.</span><span class="n">i0</span><span class="p">(</span><span class="n">kappa</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">i0</span><span class="p">(</span><span class="n">kappa</span><span class="p">)))</span>


<span class="n">vonmises</span> <span class="o">=</span> <span class="n">vonmises_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;vonmises&#39;</span><span class="p">)</span>
<span class="n">vonmises_line</span> <span class="o">=</span> <span class="n">vonmises_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;vonmises_line&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">wald_gen</span><span class="p">(</span><span class="n">invgauss_gen</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Wald continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `wald` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{1}{\sqrt{2\pi x^3}} \exp(- \frac{ (x-1)^2 }{ 2x })</span>

<span class="sd">    for :math:`x &gt;= 0`.</span>

<span class="sd">    `wald` is a special case of `invgauss` with ``mu=1``.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">wald</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># wald.pdf(x) = 1/sqrt(2*pi*x**3) * exp(-(x-1)**2/(2*x))</span>
        <span class="k">return</span> <span class="n">invgauss</span><span class="o">.</span><span class="n">_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">invgauss</span><span class="o">.</span><span class="n">_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">invgauss</span><span class="o">.</span><span class="n">_sf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">invgauss</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">invgauss</span><span class="o">.</span><span class="n">_logcdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">invgauss</span><span class="o">.</span><span class="n">_logsf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">15.0</span>


<span class="n">wald</span> <span class="o">=</span> <span class="n">wald_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;wald&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">wrapcauchy_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A wrapped Cauchy continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `wrapcauchy` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = \frac{1-c^2}{2\pi (1+c^2 - 2c \cos(x))}</span>

<span class="sd">    for :math:`0 \le x \le 2\pi`, :math:`0 &lt; c &lt; 1`.</span>

<span class="sd">    `wrapcauchy` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># wrapcauchy.pdf(x, c) = (1-c**2) / (2*pi*(1+c**2-2*c*cos(x)))</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cr</span><span class="p">):</span>
            <span class="c1"># CDF for 0 &lt;= x &lt; pi</span>
            <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">cr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">f2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cr</span><span class="p">):</span>
            <span class="c1"># CDF for pi &lt;= x &lt;= 2*pi</span>
            <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">cr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>

        <span class="n">cr</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cr</span><span class="p">),</span> <span class="n">f</span><span class="o">=</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="o">=</span><span class="n">f2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">c</span><span class="p">)</span>
        <span class="n">rcq</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">val</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">q</span><span class="p">))</span>
        <span class="n">rcmq</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">val</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">q</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">rcq</span><span class="p">,</span> <span class="n">rcmq</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># Use 0.5 as the initial guess of the shape parameter.</span>
        <span class="c1"># For the location and scale, use the minimum and</span>
        <span class="c1"># peak-to-peak/(2*pi), respectively.</span>
        <span class="k">return</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>


<span class="n">wrapcauchy</span> <span class="o">=</span> <span class="n">wrapcauchy_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;wrapcauchy&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">gennorm_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A generalized normal continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    laplace : Laplace distribution</span>
<span class="sd">    norm : normal distribution</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `gennorm` is [1]_:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, \beta) = \frac{\beta}{2 \Gamma(1/\beta)} \exp(-|x|^\beta)</span>

<span class="sd">    :math:`\Gamma` is the gamma function (`scipy.special.gamma`).</span>

<span class="sd">    `gennorm` takes ``beta`` as a shape parameter for :math:`\beta`.</span>
<span class="sd">    For :math:`\beta = 1`, it is identical to a Laplace distribution.</span>
<span class="sd">    For :math:`\beta = 2`, it is identical to a normal distribution</span>
<span class="sd">    (with ``scale=1/sqrt(2)``).</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>

<span class="sd">    .. [1] &quot;Generalized normal distribution, Version 1&quot;,</span>
<span class="sd">           https://en.wikipedia.org/wiki/Generalized_normal_distribution#Version_1</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="n">beta</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="c1"># evaluating (.5 + c) first prevents numerical cancellation</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="n">c</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincc</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="n">beta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="c1"># evaluating (1. + c) first prevents numerical cancellation</span>
        <span class="k">return</span> <span class="n">c</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainccinv</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_ppf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="n">c1</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c5</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">([</span><span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span><span class="p">,</span> <span class="mf">3.0</span><span class="o">/</span><span class="n">beta</span><span class="p">,</span> <span class="mf">5.0</span><span class="o">/</span><span class="n">beta</span><span class="p">])</span>
        <span class="k">return</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">c3</span> <span class="o">-</span> <span class="n">c1</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">c5</span> <span class="o">+</span> <span class="n">c1</span> <span class="o">-</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">c3</span><span class="p">)</span> <span class="o">-</span> <span class="mf">3.</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">beta</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">.5</span> <span class="o">*</span> <span class="n">beta</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">beta</span><span class="p">)</span>


<span class="n">gennorm</span> <span class="o">=</span> <span class="n">gennorm_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;gennorm&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">halfgennorm_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;The upper half of a generalized normal continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    gennorm : generalized normal distribution</span>
<span class="sd">    expon : exponential distribution</span>
<span class="sd">    halfnorm : half normal distribution</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `halfgennorm` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, \beta) = \frac{\beta}{\Gamma(1/\beta)} \exp(-|x|^\beta)</span>

<span class="sd">    for :math:`x &gt; 0`. :math:`\Gamma` is the gamma function</span>
<span class="sd">    (`scipy.special.gamma`).</span>

<span class="sd">    `gennorm` takes ``beta`` as a shape parameter for :math:`\beta`.</span>
<span class="sd">    For :math:`\beta = 1`, it is identical to an exponential distribution.</span>
<span class="sd">    For :math:`\beta = 2`, it is identical to a half normal distribution</span>
<span class="sd">    (with ``scale=1/sqrt(2)``).</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>

<span class="sd">    .. [1] &quot;Generalized normal distribution, Version 1&quot;,</span>
<span class="sd">           https://en.wikipedia.org/wiki/Generalized_normal_distribution#Version_1</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="c1">#                                 beta</span>
        <span class="c1"># halfgennorm.pdf(x, beta) =  -------------  exp(-|x|**beta)</span>
        <span class="c1">#                             gamma(1/beta)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="n">beta</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span><span class="p">,</span> <span class="n">x</span><span class="o">**</span><span class="n">beta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincc</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span><span class="p">,</span> <span class="n">x</span><span class="o">**</span><span class="n">beta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainccinv</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span>


<span class="n">halfgennorm</span> <span class="o">=</span> <span class="n">halfgennorm_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;halfgennorm&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">crystalball_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Crystalball distribution</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `crystalball` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, \beta, m) =  \begin{cases}</span>
<span class="sd">                            N \exp(-x^2 / 2),  &amp;\text{for } x &gt; -\beta\\</span>
<span class="sd">                            N A (B - x)^{-m}  &amp;\text{for } x \le -\beta</span>
<span class="sd">                          \end{cases}</span>

<span class="sd">    where :math:`A = (m / |\beta|)^m  \exp(-\beta^2 / 2)`,</span>
<span class="sd">    :math:`B = m/|\beta| - |\beta|` and :math:`N` is a normalisation constant.</span>

<span class="sd">    `crystalball` takes :math:`\beta &gt; 0` and :math:`m &gt; 1` as shape</span>
<span class="sd">    parameters.  :math:`\beta` defines the point where the pdf changes</span>
<span class="sd">    from a power-law to a Gaussian distribution.  :math:`m` is the power</span>
<span class="sd">    of the power-law tail.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] &quot;Crystal Ball Function&quot;,</span>
<span class="sd">           https://en.wikipedia.org/wiki/Crystal_Ball_function</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    .. versionadded:: 0.19.0</span>

<span class="sd">    %(example)s</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return PDF of the crystalball function.</span>

<span class="sd">                                            --</span>
<span class="sd">                                           | exp(-x**2 / 2),  for x &gt; -beta</span>
<span class="sd">        crystalball.pdf(x, beta, m) =  N * |</span>
<span class="sd">                                           | A * (B - x)**(-m), for x &lt;= -beta</span>
<span class="sd">                                            --</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">N</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span>
                   <span class="n">_norm_pdf_C</span> <span class="o">*</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">rhs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">lhs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="n">m</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span>
                    <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span> <span class="o">-</span> <span class="n">beta</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">m</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">N</span> <span class="o">*</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">beta</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span> <span class="n">f</span><span class="o">=</span><span class="n">rhs</span><span class="p">,</span> <span class="n">f2</span><span class="o">=</span><span class="n">lhs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the log of the PDF of the crystalball function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">N</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span>
                   <span class="n">_norm_pdf_C</span> <span class="o">*</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">rhs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span>

        <span class="k">def</span> <span class="nf">lhs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">m</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span> <span class="o">-</span> <span class="n">beta</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">m</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span> <span class="o">-</span> <span class="n">beta</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">beta</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span> <span class="n">f</span><span class="o">=</span><span class="n">rhs</span><span class="p">,</span> <span class="n">f2</span><span class="o">=</span><span class="n">lhs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return CDF of the crystalball function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">N</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span>
                   <span class="n">_norm_pdf_C</span> <span class="o">*</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">rhs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span>
                    <span class="n">_norm_pdf_C</span> <span class="o">*</span> <span class="p">(</span><span class="n">_norm_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="p">)))</span>

        <span class="k">def</span> <span class="nf">lhs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="n">m</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span>
                    <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span> <span class="o">-</span> <span class="n">beta</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">N</span> <span class="o">*</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">beta</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span> <span class="n">f</span><span class="o">=</span><span class="n">rhs</span><span class="p">,</span> <span class="n">f2</span><span class="o">=</span><span class="n">lhs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="n">N</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span>
                   <span class="n">_norm_pdf_C</span> <span class="o">*</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>
        <span class="n">pbeta</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">ppf_less</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="n">eb2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="n">eb2</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">N</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">C</span> <span class="o">+</span> <span class="n">_norm_pdf_C</span> <span class="o">*</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span> <span class="o">-</span> <span class="n">beta</span> <span class="o">-</span>
                    <span class="p">((</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="n">eb2</span><span class="o">*</span><span class="n">p</span><span class="o">/</span><span class="n">N</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">m</span><span class="p">)))</span>

        <span class="k">def</span> <span class="nf">ppf_greater</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="n">eb2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="n">eb2</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">N</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">C</span> <span class="o">+</span> <span class="n">_norm_pdf_C</span> <span class="o">*</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">_norm_ppf</span><span class="p">(</span><span class="n">_norm_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">_norm_pdf_C</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="n">N</span> <span class="o">-</span> <span class="n">C</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="n">pbeta</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span> <span class="n">f</span><span class="o">=</span><span class="n">ppf_less</span><span class="p">,</span> <span class="n">f2</span><span class="o">=</span><span class="n">ppf_greater</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the n-th non-central moment of the crystalball function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">N</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span>
                   <span class="n">_norm_pdf_C</span> <span class="o">*</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">n_th_moment</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Returns n-th moment. Defined only if n+1 &lt; m</span>
<span class="sd">            Function cannot broadcast due to the loop over n</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="n">m</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">m</span><span class="o">/</span><span class="n">beta</span> <span class="o">-</span> <span class="n">beta</span>
            <span class="n">rhs</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">((</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span>
                   <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">n</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">beta</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)))</span>
            <span class="n">lhs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">rhs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">lhs</span> <span class="o">+=</span> <span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">binom</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">k</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span>
                        <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">m</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">lhs</span> <span class="o">+</span> <span class="n">rhs</span>

        <span class="k">return</span> <span class="n">N</span> <span class="o">*</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">n_th_moment</span><span class="p">,</span> <span class="n">otypes</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]),</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shape parameter bounds are m &gt; 1 and beta &gt; 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">beta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>


<span class="n">crystalball</span> <span class="o">=</span> <span class="n">crystalball_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;crystalball&#39;</span><span class="p">,</span> <span class="n">longname</span><span class="o">=</span><span class="s2">&quot;A Crystalball Function&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_argus_phi</span><span class="p">(</span><span class="n">chi</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Utility function for the argus distribution used in the pdf, sf and</span>
<span class="sd">    moment calculation.</span>
<span class="sd">    Note that for all x &gt; 0:</span>
<span class="sd">    gammainc(1.5, x**2/2) = 2 * (_norm_cdf(x) - x * _norm_pdf(x) - 0.5).</span>
<span class="sd">    This can be verified directly by noting that the cdf of Gamma(1.5) can</span>
<span class="sd">    be written as erf(sqrt(x)) - 2*sqrt(x)*exp(-x)/sqrt(Pi).</span>
<span class="sd">    We use gammainc instead of the usual definition because it is more precise</span>
<span class="sd">    for small chi.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">chi</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>


<span class="k">class</span> <span class="nc">argus_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Argus distribution</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `argus` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, \chi) = \frac{\chi^3}{\sqrt{2\pi} \Psi(\chi)} x \sqrt{1-x^2}</span>
<span class="sd">                     \exp(-\chi^2 (1 - x^2)/2)</span>

<span class="sd">    for :math:`0 &lt; x &lt; 1` and :math:`\chi &gt; 0`, where</span>

<span class="sd">    .. math::</span>

<span class="sd">        \Psi(\chi) = \Phi(\chi) - \chi \phi(\chi) - 1/2</span>

<span class="sd">    with :math:`\Phi` and :math:`\phi` being the CDF and PDF of a standard</span>
<span class="sd">    normal distribution, respectively.</span>

<span class="sd">    `argus` takes :math:`\chi` as shape a parameter.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] &quot;ARGUS distribution&quot;,</span>
<span class="sd">           https://en.wikipedia.org/wiki/ARGUS_distribution</span>

<span class="sd">    .. versionadded:: 0.19.0</span>

<span class="sd">    %(example)s</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">chi</span><span class="p">):</span>
        <span class="c1"># for x = 0 or 1, logpdf returns -np.inf</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
            <span class="n">y</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span>
            <span class="n">A</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">chi</span><span class="p">)</span> <span class="o">-</span> <span class="n">_norm_pdf_logC</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">_argus_phi</span><span class="p">(</span><span class="n">chi</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">A</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">chi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">y</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">chi</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">chi</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">chi</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">chi</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">chi</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_argus_phi</span><span class="p">(</span><span class="n">chi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="n">_argus_phi</span><span class="p">(</span><span class="n">chi</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">chi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">chi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">chi</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs_scalar</span><span class="p">(</span><span class="n">chi</span><span class="p">,</span> <span class="n">numsamples</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shp</span><span class="p">,</span> <span class="n">bc</span> <span class="o">=</span> <span class="n">_check_shape</span><span class="p">(</span><span class="n">chi</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
            <span class="n">numsamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shp</span><span class="p">))</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
            <span class="n">it</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">([</span><span class="n">chi</span><span class="p">],</span>
                           <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;multi_index&#39;</span><span class="p">],</span>
                           <span class="n">op_flags</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;readonly&#39;</span><span class="p">]])</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">it</span><span class="o">.</span><span class="n">finished</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">it</span><span class="o">.</span><span class="n">multi_index</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">bc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">else</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
                            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">size</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
                <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs_scalar</span><span class="p">(</span><span class="n">it</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">numsamples</span><span class="o">=</span><span class="n">numsamples</span><span class="p">,</span>
                                     <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
                <span class="n">out</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shp</span><span class="p">)</span>
                <span class="n">it</span><span class="o">.</span><span class="n">iternext</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="p">():</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">[()]</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">_rvs_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">numsamples</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># if chi &lt;= 1.8:</span>
        <span class="c1"># use rejection method, see Devroye:</span>
        <span class="c1"># Non-Uniform Random Variate Generation, 1986, section II.3.2.</span>
        <span class="c1"># write: PDF f(x) = c * g(x) * h(x), where</span>
        <span class="c1"># h is [0,1]-valued and g is a density</span>
        <span class="c1"># we use two ways to write f</span>
        <span class="c1">#</span>
        <span class="c1"># Case 1:</span>
        <span class="c1"># write g(x) = 3*x*sqrt(1-x**2), h(x) = exp(-chi**2 (1-x**2) / 2)</span>
        <span class="c1"># If X has a distribution with density g its ppf G_inv is given by:</span>
        <span class="c1"># G_inv(u) = np.sqrt(1 - u**(2/3))</span>
        <span class="c1">#</span>
        <span class="c1"># Case 2:</span>
        <span class="c1"># g(x) = chi**2 * x * exp(-chi**2 * (1-x**2)/2) / (1 - exp(-chi**2 /2))</span>
        <span class="c1"># h(x) = sqrt(1 - x**2), 0 &lt;= x &lt;= 1</span>
        <span class="c1"># one can show that</span>
        <span class="c1"># G_inv(u) = np.sqrt(2*np.log(u*(np.exp(chi**2/2)-1)+1))/chi</span>
        <span class="c1">#          = np.sqrt(1 + 2*np.log(np.exp(-chi**2/2)*(1-u)+u)/chi**2)</span>
        <span class="c1"># the latter expression is used for precision with small chi</span>
        <span class="c1">#</span>
        <span class="c1"># In both cases, the inverse cdf of g can be written analytically, and</span>
        <span class="c1"># we can apply the rejection method:</span>
        <span class="c1">#</span>
        <span class="c1"># REPEAT</span>
        <span class="c1">#    Generate U uniformly distributed on [0, 1]</span>
        <span class="c1">#    Generate X with density g (e.g. via inverse transform sampling:</span>
        <span class="c1">#    X = G_inv(V) with V uniformly distributed on [0, 1])</span>
        <span class="c1"># UNTIL X &lt;= h(X)</span>
        <span class="c1"># RETURN X</span>
        <span class="c1">#</span>
        <span class="c1"># We use case 1 for chi &lt;= 0.5 as it maintains precision for small chi</span>
        <span class="c1"># and case 2 for 0.5 &lt; chi &lt;= 1.8 due to its speed for moderate chi.</span>
        <span class="c1">#</span>
        <span class="c1"># if chi &gt; 1.8:</span>
        <span class="c1"># use relation to the Gamma distribution: if X is ARGUS with parameter</span>
        <span class="c1"># chi), then Y = chi**2 * (1 - X**2) / 2 has density proportional to</span>
        <span class="c1"># sqrt(u) * exp(-u) on [0, chi**2 / 2], i.e. a Gamma(3/2) distribution</span>
        <span class="c1"># conditioned on [0, chi**2 / 2]). Therefore, to sample X from the</span>
        <span class="c1"># ARGUS distribution, we sample Y from the gamma distribution, keeping</span>
        <span class="c1"># only samples on [0, chi**2 / 2], and apply the inverse</span>
        <span class="c1"># transformation X = (1 - 2*Y/chi**2)**(1/2). Since we only</span>
        <span class="c1"># look at chi &gt; 1.8, gamma(1.5).cdf(chi**2/2) is large enough such</span>
        <span class="c1"># Y falls in the inteval [0, chi**2 / 2] with a high probability:</span>
        <span class="c1"># stats.gamma(1.5).cdf(1.8**2/2) = 0.644...</span>
        <span class="c1">#</span>
        <span class="c1"># The points to switch between the different methods are determined</span>
        <span class="c1"># by a comparison of the runtime of the different methods. However,</span>
        <span class="c1"># the runtime is platform-dependent. The implemented values should</span>
        <span class="c1"># ensure a good overall performance and are supported by an analysis</span>
        <span class="c1"># of the rejection constants of different methods.</span>

        <span class="n">size1d</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">numsamples</span><span class="p">))</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">size1d</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="n">simulated</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">chi2</span> <span class="o">=</span> <span class="n">chi</span> <span class="o">*</span> <span class="n">chi</span>
        <span class="k">if</span> <span class="n">chi</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="o">-</span><span class="n">chi2</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="k">while</span> <span class="n">simulated</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">simulated</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">v</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
                <span class="c1"># acceptance condition: u &lt;= h(G_inv(v)). This simplifies to</span>
                <span class="n">accept</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span>
                <span class="n">num_accept</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">accept</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">num_accept</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># we still need to transform z=v**(2/3) to X = G_inv(v)</span>
                    <span class="n">rvs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">z</span><span class="p">[</span><span class="n">accept</span><span class="p">])</span>
                    <span class="n">x</span><span class="p">[</span><span class="n">simulated</span><span class="p">:(</span><span class="n">simulated</span> <span class="o">+</span> <span class="n">num_accept</span><span class="p">)]</span> <span class="o">=</span> <span class="n">rvs</span>
                    <span class="n">simulated</span> <span class="o">+=</span> <span class="n">num_accept</span>
        <span class="k">elif</span> <span class="n">chi</span> <span class="o">&lt;=</span> <span class="mf">1.8</span><span class="p">:</span>
            <span class="n">echi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">chi2</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">simulated</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">simulated</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                <span class="n">z</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">echi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="n">v</span><span class="p">)</span> <span class="o">/</span> <span class="n">chi2</span>
                <span class="c1"># as in case one, simplify u &lt;= h(G_inv(v)) and then transform</span>
                <span class="c1"># z to the target distribution X = G_inv(v)</span>
                <span class="n">accept</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">num_accept</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">accept</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">num_accept</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">rvs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">z</span><span class="p">[</span><span class="n">accept</span><span class="p">])</span>
                    <span class="n">x</span><span class="p">[</span><span class="n">simulated</span><span class="p">:(</span><span class="n">simulated</span> <span class="o">+</span> <span class="n">num_accept</span><span class="p">)]</span> <span class="o">=</span> <span class="n">rvs</span>
                    <span class="n">simulated</span> <span class="o">+=</span> <span class="n">num_accept</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># conditional Gamma for chi &gt; 1.8</span>
            <span class="k">while</span> <span class="n">simulated</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">simulated</span>
                <span class="n">g</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">standard_gamma</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                <span class="n">accept</span> <span class="o">=</span> <span class="p">(</span><span class="n">g</span> <span class="o">&lt;=</span> <span class="n">chi2</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">num_accept</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">accept</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">num_accept</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">x</span><span class="p">[</span><span class="n">simulated</span><span class="p">:(</span><span class="n">simulated</span> <span class="o">+</span> <span class="n">num_accept</span><span class="p">)]</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="n">accept</span><span class="p">]</span>
                    <span class="n">simulated</span> <span class="o">+=</span> <span class="n">num_accept</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="n">chi2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">size1d</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chi</span><span class="p">):</span>
        <span class="c1"># need to ensure that dtype is float</span>
        <span class="c1"># otherwise the mask below does not work for integers</span>
        <span class="n">chi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">chi</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">_argus_phi</span><span class="p">(</span><span class="n">chi</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="n">chi</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">ive</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">chi</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="n">phi</span>
        <span class="c1"># compute second moment, use Taylor expansion for small chi (&lt;= 0.1)</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">chi</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">chi</span> <span class="o">&gt;</span> <span class="mf">0.1</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">chi</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">mu2</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">c</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">_norm_pdf</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="n">phi</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">chi</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">coef</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">358</span><span class="o">/</span><span class="mi">65690625</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">94</span><span class="o">/</span><span class="mi">1010625</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">/</span><span class="mi">2625</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="o">/</span><span class="mi">175</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">]</span>
        <span class="n">mu2</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">coef</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="n">mu2</span> <span class="o">-</span> <span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>


<span class="n">argus</span> <span class="o">=</span> <span class="n">argus_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;argus&#39;</span><span class="p">,</span> <span class="n">longname</span><span class="o">=</span><span class="s2">&quot;An Argus Function&quot;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">rv_histogram</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a distribution given by a histogram.</span>
<span class="sd">    This is useful to generate a template distribution from a binned</span>
<span class="sd">    datasample.</span>

<span class="sd">    As a subclass of the `rv_continuous` class, `rv_histogram` inherits from it</span>
<span class="sd">    a collection of generic methods (see `rv_continuous` for the full list),</span>
<span class="sd">    and implements them based on the properties of the provided binned</span>
<span class="sd">    datasample.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    histogram : tuple of array_like</span>
<span class="sd">      Tuple containing two array_like objects</span>
<span class="sd">      The first containing the content of n bins</span>
<span class="sd">      The second containing the (n+1) bin boundaries</span>
<span class="sd">      In particular the return value np.histogram is accepted</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    There are no additional shape parameters except for the loc and scale.</span>
<span class="sd">    The pdf is defined as a stepwise function from the provided histogram</span>
<span class="sd">    The cdf is a linear interpolation of the pdf.</span>

<span class="sd">    .. versionadded:: 0.19.0</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    Create a scipy.stats distribution from a numpy histogram</span>

<span class="sd">    &gt;&gt;&gt; import scipy.stats</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; data = scipy.stats.norm.rvs(size=100000, loc=0, scale=1.5, random_state=123)</span>
<span class="sd">    &gt;&gt;&gt; hist = np.histogram(data, bins=100)</span>
<span class="sd">    &gt;&gt;&gt; hist_dist = scipy.stats.rv_histogram(hist)</span>

<span class="sd">    Behaves like an ordinary scipy rv_continuous distribution</span>

<span class="sd">    &gt;&gt;&gt; hist_dist.pdf(1.0)</span>
<span class="sd">    0.20538577847618705</span>
<span class="sd">    &gt;&gt;&gt; hist_dist.cdf(2.0)</span>
<span class="sd">    0.90818568543056499</span>

<span class="sd">    PDF is zero above (below) the highest (lowest) bin of the histogram,</span>
<span class="sd">    defined by the max (min) of the original dataset</span>

<span class="sd">    &gt;&gt;&gt; hist_dist.pdf(np.max(data))</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hist_dist.cdf(np.max(data))</span>
<span class="sd">    1.0</span>
<span class="sd">    &gt;&gt;&gt; hist_dist.pdf(np.min(data))</span>
<span class="sd">    7.7591907244498314e-05</span>
<span class="sd">    &gt;&gt;&gt; hist_dist.cdf(np.min(data))</span>
<span class="sd">    0.0</span>

<span class="sd">    PDF and CDF follow the histogram</span>

<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; X = np.linspace(-5.0, 5.0, 100)</span>
<span class="sd">    &gt;&gt;&gt; plt.title(&quot;PDF from Template&quot;)</span>
<span class="sd">    &gt;&gt;&gt; plt.hist(data, density=True, bins=100)</span>
<span class="sd">    &gt;&gt;&gt; plt.plot(X, hist_dist.pdf(X), label=&#39;PDF&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.plot(X, hist_dist.cdf(X), label=&#39;CDF&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.show()</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_support_mask</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">histogram</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new distribution using the given histogram</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        histogram : tuple of array_like</span>
<span class="sd">          Tuple containing two array_like objects</span>
<span class="sd">          The first containing the content of n bins</span>
<span class="sd">          The second containing the (n+1) bin boundaries</span>
<span class="sd">          In particular the return value np.histogram is accepted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_histogram</span> <span class="o">=</span> <span class="n">histogram</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">histogram</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected length 2 for parameter histogram&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">histogram</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hbins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">histogram</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hbins</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of elements in histogram content &quot;</span>
                             <span class="s2">&quot;and histogram boundaries do not match, &quot;</span>
                             <span class="s2">&quot;expected n and n+1.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hbin_widths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hbins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hbins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hbin_widths</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hcdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hbin_widths</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hcdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hcdf</span><span class="p">])</span>
        <span class="c1"># Set support</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hbins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hbins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        PDF of the histogram</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hbins</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        CDF calculated from the histogram</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hbins</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hcdf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Percentile function calculated from the histogram</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hcdf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hbins</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the n-th non-central moment.&quot;&quot;&quot;</span>
        <span class="n">integrals</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hbins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hbins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">integrals</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute entropy of distribution&quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">,</span>
                         <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],),</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
                         <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">res</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hbin_widths</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_updated_ctor_param</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the histogram as additional constructor argument</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dct</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_updated_ctor_param</span><span class="p">()</span>
        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;histogram&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_histogram</span>
        <span class="k">return</span> <span class="n">dct</span>


<span class="k">class</span> <span class="nc">studentized_range_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A studentized range continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    t: Student&#39;s t distribution</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `studentized_range` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">         f(x; k, \nu) = \frac{k(k-1)\nu^{\nu/2}}{\Gamma(\nu/2)</span>
<span class="sd">                        2^{\nu/2-1}} \int_{0}^{\infty} \int_{-\infty}^{\infty}</span>
<span class="sd">                        s^{\nu} e^{-\nu s^2/2} \phi(z) \phi(sx + z)</span>
<span class="sd">                        [\Phi(sx + z) - \Phi(z)]^{k-2} \,dz \,ds</span>

<span class="sd">    for :math:`x ≥ 0`, :math:`k &gt; 1`, and :math:`\nu &gt; 0`.</span>

<span class="sd">    `studentized_range` takes ``k`` for :math:`k` and ``df`` for :math:`\nu`</span>
<span class="sd">    as shape parameters.</span>

<span class="sd">    When :math:`\nu` exceeds 100,000, an asymptotic approximation (infinite</span>
<span class="sd">    degrees of freedom) is used to compute the cumulative distribution</span>
<span class="sd">    function [4]_.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>

<span class="sd">    .. [1] &quot;Studentized range distribution&quot;,</span>
<span class="sd">           https://en.wikipedia.org/wiki/Studentized_range_distribution</span>
<span class="sd">    .. [2] Batista, Ben Dêivide, et al. &quot;Externally Studentized Normal Midrange</span>
<span class="sd">           Distribution.&quot; Ciência e Agrotecnologia, vol. 41, no. 4, 2017, pp.</span>
<span class="sd">           378-389., doi:10.1590/1413-70542017414047716.</span>
<span class="sd">    .. [3] Harter, H. Leon. &quot;Tables of Range and Studentized Range.&quot; The Annals</span>
<span class="sd">           of Mathematical Statistics, vol. 31, no. 4, 1960, pp. 1122-1147.</span>
<span class="sd">           JSTOR, www.jstor.org/stable/2237810. Accessed 18 Feb. 2021.</span>
<span class="sd">    .. [4] Lund, R. E., and J. R. Lund. &quot;Algorithm AS 190: Probabilities and</span>
<span class="sd">           Upper Quantiles for the Studentized Range.&quot; Journal of the Royal</span>
<span class="sd">           Statistical Society. Series C (Applied Statistics), vol. 32, no. 2,</span>
<span class="sd">           1983, pp. 204-210. JSTOR, www.jstor.org/stable/2347300. Accessed 18</span>
<span class="sd">           Feb. 2021.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from scipy.stats import studentized_range</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(1, 1)</span>

<span class="sd">    Calculate the first four moments:</span>

<span class="sd">    &gt;&gt;&gt; k, df = 3, 10</span>
<span class="sd">    &gt;&gt;&gt; mean, var, skew, kurt = studentized_range.stats(k, df, moments=&#39;mvsk&#39;)</span>

<span class="sd">    Display the probability density function (``pdf``):</span>

<span class="sd">    &gt;&gt;&gt; x = np.linspace(studentized_range.ppf(0.01, k, df),</span>
<span class="sd">    ...                 studentized_range.ppf(0.99, k, df), 100)</span>
<span class="sd">    &gt;&gt;&gt; ax.plot(x, studentized_range.pdf(x, k, df),</span>
<span class="sd">    ...         &#39;r-&#39;, lw=5, alpha=0.6, label=&#39;studentized_range pdf&#39;)</span>

<span class="sd">    Alternatively, the distribution object can be called (as a function)</span>
<span class="sd">    to fix the shape, location and scale parameters. This returns a &quot;frozen&quot;</span>
<span class="sd">    RV object holding the given parameters fixed.</span>

<span class="sd">    Freeze the distribution and display the frozen ``pdf``:</span>

<span class="sd">    &gt;&gt;&gt; rv = studentized_range(k, df)</span>
<span class="sd">    &gt;&gt;&gt; ax.plot(x, rv.pdf(x), &#39;k-&#39;, lw=2, label=&#39;frozen pdf&#39;)</span>

<span class="sd">    Check accuracy of ``cdf`` and ``ppf``:</span>

<span class="sd">    &gt;&gt;&gt; vals = studentized_range.ppf([0.001, 0.5, 0.999], k, df)</span>
<span class="sd">    &gt;&gt;&gt; np.allclose([0.001, 0.5, 0.999], studentized_range.cdf(vals, k, df))</span>
<span class="sd">    True</span>

<span class="sd">    Rather than using (``studentized_range.rvs``) to generate random variates,</span>
<span class="sd">    which is very slow for this distribution, we can approximate the inverse</span>
<span class="sd">    CDF using an interpolator, and then perform inverse transform sampling</span>
<span class="sd">    with this approximate inverse CDF.</span>

<span class="sd">    This distribution has an infinite but thin right tail, so we focus our</span>
<span class="sd">    attention on the leftmost 99.9 percent.</span>

<span class="sd">    &gt;&gt;&gt; a, b = studentized_range.ppf([0, .999], k, df)</span>
<span class="sd">    &gt;&gt;&gt; a, b</span>
<span class="sd">    0, 7.41058083802274</span>

<span class="sd">    &gt;&gt;&gt; from scipy.interpolate import interp1d</span>
<span class="sd">    &gt;&gt;&gt; rng = np.random.default_rng()</span>
<span class="sd">    &gt;&gt;&gt; xs = np.linspace(a, b, 50)</span>
<span class="sd">    &gt;&gt;&gt; cdf = studentized_range.cdf(xs, k, df)</span>
<span class="sd">    # Create an interpolant of the inverse CDF</span>
<span class="sd">    &gt;&gt;&gt; ppf = interp1d(cdf, xs, fill_value=&#39;extrapolate&#39;)</span>
<span class="sd">    # Perform inverse transform sampling using the interpolant</span>
<span class="sd">    &gt;&gt;&gt; r = ppf(rng.uniform(size=1000))</span>

<span class="sd">    And compare the histogram:</span>

<span class="sd">    &gt;&gt;&gt; ax.hist(r, density=True, histtype=&#39;stepfilled&#39;, alpha=0.2)</span>
<span class="sd">    &gt;&gt;&gt; ax.legend(loc=&#39;best&#39;, frameon=False)</span>
<span class="sd">    &gt;&gt;&gt; plt.show()</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">k</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># Default is k=1, but that is not a valid value of the parameter.</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">studentized_range_gen</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_fitstart</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="n">cython_symbol</span> <span class="o">=</span> <span class="s1">&#39;_studentized_range_moment&#39;</span>
        <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_support</span><span class="p">()</span>
        <span class="c1"># all three of these are used to create a numpy array so they must</span>
        <span class="c1"># be the same shape.</span>

        <span class="k">def</span> <span class="nf">_single_moment</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
            <span class="n">log_const</span> <span class="o">=</span> <span class="n">_stats</span><span class="o">.</span><span class="n">_studentized_range_pdf_logconst</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="p">[</span><span class="n">K</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">log_const</span><span class="p">]</span>
            <span class="n">usr_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">)</span>

            <span class="n">llc</span> <span class="o">=</span> <span class="n">LowLevelCallable</span><span class="o">.</span><span class="n">from_cython</span><span class="p">(</span><span class="n">_stats</span><span class="p">,</span> <span class="n">cython_symbol</span><span class="p">,</span> <span class="n">usr_data</span><span class="p">)</span>

            <span class="n">ranges</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">)]</span>
            <span class="n">opts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">epsabs</span><span class="o">=</span><span class="mf">1e-11</span><span class="p">,</span> <span class="n">epsrel</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">integrate</span><span class="o">.</span><span class="n">nquad</span><span class="p">(</span><span class="n">llc</span><span class="p">,</span> <span class="n">ranges</span><span class="o">=</span><span class="n">ranges</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="n">opts</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ufunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frompyfunc</span><span class="p">(</span><span class="n">_single_moment</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">ufunc</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="n">cython_symbol</span> <span class="o">=</span> <span class="s1">&#39;_studentized_range_pdf&#39;</span>

        <span class="k">def</span> <span class="nf">_single_pdf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
            <span class="n">log_const</span> <span class="o">=</span> <span class="n">_stats</span><span class="o">.</span><span class="n">_studentized_range_pdf_logconst</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">log_const</span><span class="p">]</span>
            <span class="n">usr_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">)</span>

            <span class="n">llc</span> <span class="o">=</span> <span class="n">LowLevelCallable</span><span class="o">.</span><span class="n">from_cython</span><span class="p">(</span><span class="n">_stats</span><span class="p">,</span> <span class="n">cython_symbol</span><span class="p">,</span> <span class="n">usr_data</span><span class="p">)</span>

            <span class="n">ranges</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)]</span>
            <span class="n">opts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">epsabs</span><span class="o">=</span><span class="mf">1e-11</span><span class="p">,</span> <span class="n">epsrel</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">integrate</span><span class="o">.</span><span class="n">nquad</span><span class="p">(</span><span class="n">llc</span><span class="p">,</span> <span class="n">ranges</span><span class="o">=</span><span class="n">ranges</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="n">opts</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ufunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frompyfunc</span><span class="p">(</span><span class="n">_single_pdf</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">ufunc</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">_single_cdf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
            <span class="c1"># &quot;When the degrees of freedom V are infinite the probability</span>
            <span class="c1"># integral takes [on a] simpler form,&quot; and a single asymptotic</span>
            <span class="c1"># integral is evaluated rather than the standard double integral.</span>
            <span class="c1"># (Lund, Lund, page 205)</span>
            <span class="k">if</span> <span class="n">df</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">:</span>
                <span class="n">cython_symbol</span> <span class="o">=</span> <span class="s1">&#39;_studentized_range_cdf&#39;</span>
                <span class="n">log_const</span> <span class="o">=</span> <span class="n">_stats</span><span class="o">.</span><span class="n">_studentized_range_cdf_logconst</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
                <span class="n">arg</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">log_const</span><span class="p">]</span>
                <span class="n">usr_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">)</span>
                <span class="n">ranges</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cython_symbol</span> <span class="o">=</span> <span class="s1">&#39;_studentized_range_cdf_asymptotic&#39;</span>
                <span class="n">arg</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
                <span class="n">usr_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">)</span>
                <span class="n">ranges</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)]</span>

            <span class="n">llc</span> <span class="o">=</span> <span class="n">LowLevelCallable</span><span class="o">.</span><span class="n">from_cython</span><span class="p">(</span><span class="n">_stats</span><span class="p">,</span> <span class="n">cython_symbol</span><span class="p">,</span> <span class="n">usr_data</span><span class="p">)</span>
            <span class="n">opts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">epsabs</span><span class="o">=</span><span class="mf">1e-11</span><span class="p">,</span> <span class="n">epsrel</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">integrate</span><span class="o">.</span><span class="n">nquad</span><span class="p">(</span><span class="n">llc</span><span class="p">,</span> <span class="n">ranges</span><span class="o">=</span><span class="n">ranges</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="n">opts</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ufunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frompyfunc</span><span class="p">(</span><span class="n">_single_cdf</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">ufunc</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">))</span>


<span class="n">studentized_range</span> <span class="o">=</span> <span class="n">studentized_range_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;studentized_range&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                          <span class="n">b</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>


<span class="c1"># Collect names of classes and objects in this module.</span>
<span class="n">pairs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="n">_distn_names</span><span class="p">,</span> <span class="n">_distn_gen_names</span> <span class="o">=</span> <span class="n">get_distribution_names</span><span class="p">(</span><span class="n">pairs</span><span class="p">,</span> <span class="n">rv_continuous</span><span class="p">)</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="n">_distn_names</span> <span class="o">+</span> <span class="n">_distn_gen_names</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;rv_histogram&#39;</span><span class="p">]</span>
</pre></div>

              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2020, Michele Peresano.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>